;脱衣系统的相关函数
;可以敞开、半脱、着衣PLAY，一个意思
;效果是，判定角色穿着可以敞开的衣物，将这些衣物敞开，（1）脱掉上身内衣，造成上半身裸露状态，（2）并脱下裤子，撩起裙子，造成虽穿着衣物但私密处全部暴露出来的背德反差刺激
;省略参数是默认的检测机制，不省略是按需侦测任意角色
@CAN_半脱(ARG = -1)
#LOCALSIZE 1
#LOCALSSIZE 1
#FUNCTION
IF ARG == -1
	SIF !TARGET
		RETURNF 0
	ARG = TARGET
ENDIF

SIF TEQUIP:ARG:上衣脱衣完毕 == 1 || TEQUIP:ARG:上半身裸露状態 == 1 || EQUIP:ARG:0 == 0
	RETURNF 0
;穿着不能敞开的衣服
SIF EQUIP:ARG:上身衣服１
	RETURNF 0
;在这里追加可以敞开的衣服设定
SIF EQUIP:ARG:和服 || EQUIP:ARG:上身衣服２ || EQUIP:ARG:ボディースーツ || GROUPMATCH(EQUIP:ARG:レオタード,2,10,11)
	;按我的黄色知识，连体服中，连体紧身衣胯部有扣，搜查官胶衣和骑行服胯部有拉链、背后也有拉链，都可以敞开露出三点
	;紧身衣/泳衣类型都可以挪开露出三点，只有正经体操服、紧身内衣和锁子甲是需要脱下来的
	RETURNF 1
RETURNF 0

@IS_半脱(ARG,ARG:1)
#LOCALSIZE 1
#LOCALSSIZE 1
#FUNCTION

IF !ARG:1
	;狭义判定，就是执行了着衣Play之后变成半脱状态
	RETURNF TEQUIP:ARG:上半身裸露状態
ELSE
	;广义判定，用于不严格的，服装-立绘关联判定
	SIF TEQUIP:ARG:上半身裸露状態
		RETURNF 1
	;接下来应该是讨论性爱、胸爱抚和私处爱抚相关指令会导致衣物敞开，暂时简化讨论了，毛了狂气小白兔的代码；TODO
	SIF !CAN_半脱(ARG)
		RETURNF 0
	;诶嘿嘿时半脱
	SIF CFLAG:ARG:诶嘿嘿
		RETURNF 1
	;性骚扰时弄乱衣服
	SIF (GROUPMATCH(PREVCOM,313,314,315,316) && TFLAG:103 == ARG) || (GROUPMATCH(SELECTCOM,313,314,315,316) && TFLAG:104 == ARG)
		RETURNF 1
ENDIF
RETURNF 0