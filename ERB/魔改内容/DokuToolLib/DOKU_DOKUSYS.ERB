@DOKU_TIMEPASSING()
;原版的TIME_PROGRESS(TIME:1)，不适用于从INFO_TIMEPASSING到SOURCE\CALL_COM之前的内容（包括INFO_RENEW_TARGET）
;所以需要这个函数。但这个函数不适用于USERCOM的情况，所以还是不好用于FLAGSETTING
;这个函数的本质是EVENTCOM->EVENTCOM，所以适用于任何COM的情况
#FUNCTION
#LOCALSIZE 1
#LOCALSSIZE 1
LOCAL = TIME - DOKUDIM_TIME_BEFORE_MOVE()
SIF LOCAL < 0
LOCAL += 1440
RETURNF LOCAL


@DOKU_TARGET_SYSTEM(ARG,ARG:1,ARG:2 = 0)
;调用位置：FLAGSETTING
;ARG目标
;ARG:1条件变量，为1则生效
;ARG:2控制变量
;0 锁定
VARSET LOCAL
IF FINDELEMENT(TARGET,ARG,1)==-1 || !ARG:1
CALLF DOKUDIM_TARGET_SYS_NOW(1,TFLAG:104)
RETURN 0
ENDIF
;↑不满足条件不触发
SELECTCASE ARG:2
CASE 0
CALL DOKU_TARGET_SYSTEM_LOCK(ARG)
LOCAL = RESULT
CASE 1
;待定，没想到还有什么操作
ENDSELECT
RETURN LOCAL

@DOKU_TARGET_SYSTEM_LOCK(ARG)
IF ARG != TFLAG:104 && DOKUDIM_TARGET_SYS_NOW() == ARG
TFLAG:104 = ARG
CALL DOKU_KM_RENEW_AND_SET_TARGET(ARG)
IF CFLAG:ARG:口上セレクタ
TRYCALLFORM M_KOJO_K{ARG}_{CFLAG:ARG:口上セレクタ}
ELSE
TRYCALLFORM M_KOJO_K{ARG}
ENDIF
TRYCALLFORM M_KOJO%RESULTS%_DOKUTARGETSYS_K{ARG}_LOCK
RETURN 1
ENDIF
CALLF DOKUDIM_TARGET_SYS_NOW(1,TFLAG:104)
RETURN 0


@DOKU_TARGET_SYSTEM_2(ARG,ARG:1,ARG:2,ARG:3 = 0)
;ARG目标
;ARG:1控制变量，为1则启用（条件）
;ARG:2控制一回合只触发一次用的存储时间的角色TCVAR的编号，自己选一个没被占用的
;ARG:3控制变量，设置模式，同DOKU_TARGET_SYSTEM的ARG:2
IF FINDELEMENT(TARGET,ARG,1)==-1 || !ARG:1 || TCVAR:ARG:(ARG:2) == TIME || (TFLAG:103 != ARG || TFLAG:103 == 0)
RETURN 0
CALLF DOKUDIM_TARGET_SYS_NOW(1,TFLAG:104)
ENDIF
SELECTCASE ARG:3
CASE 0
CALL DOKU_TARGET_SYSTEM_LOCK(ARG)
ENDSELECT
TCVAR:ARG:(ARG:2)=TIME
CALLF DOKUDIM_TARGET_SYS_NOW(1,TFLAG:104)
RETURN 0
