@DOKU_CALC_JUEL_WILL_GOT(ARG,ARG:1)
#FUNCTION
#LOCALSIZE 1
#LOCALSSIZE 1
#DIM DYNAMIC DOKUCALC_CURRENT_GOT_JUEL
IF PALAM:ARG:(ARG:1) < PALAMLV:1
DOKUCALC_CURRENT_GOT_JUEL = 0
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:1*3
DOKUCALC_CURRENT_GOT_JUEL = 1
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:2
DOKUCALC_CURRENT_GOT_JUEL = 2
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:2*3
DOKUCALC_CURRENT_GOT_JUEL = 10
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:3
DOKUCALC_CURRENT_GOT_JUEL = 20
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:3*2
DOKUCALC_CURRENT_GOT_JUEL = 100
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:4
DOKUCALC_CURRENT_GOT_JUEL = 200
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:5
DOKUCALC_CURRENT_GOT_JUEL = 1000
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:6
DOKUCALC_CURRENT_GOT_JUEL = 2000
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:7
DOKUCALC_CURRENT_GOT_JUEL = 3000
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:8
DOKUCALC_CURRENT_GOT_JUEL = 5000
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:9
DOKUCALC_CURRENT_GOT_JUEL = 8000
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:10
DOKUCALC_CURRENT_GOT_JUEL = 12000
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:11
DOKUCALC_CURRENT_GOT_JUEL = 25000
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:12
DOKUCALC_CURRENT_GOT_JUEL = 40000
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:13
DOKUCALC_CURRENT_GOT_JUEL = 60000
ELSEIF PALAM:ARG:(ARG:1) < PALAMLV:14
DOKUCALC_CURRENT_GOT_JUEL = 100000
ELSE
DOKUCALC_CURRENT_GOT_JUEL = 150000
ENDIF
RETURNF DOKUCALC_CURRENT_GOT_JUEL

@DOKU_FAVOR_TRUST_CALC_FIX(ARG,ARG:1=0,ARG:2=0)
TFLAG:97 += ARG:1
TFLAG:98 += ARG:2
SIF ARG:1>0
TFLAG:193 = MAX(TFLAG:193,DOKU_GET_HOW_MOOD(ARG))
RETURN 1

@DOKU_COMF_FAIL
;指令强制失败，只用在m_kojo%%success系
;强制失败的同时还想操作时间的话就操作TIME:1吧
TIME = TIME:1 - 1440*DAY
TFLAG:192 = -2
TFLAG:97 = -999999
TFLAG:98 = -999999
TFLAG:99 = -1
IF CFLAG:TARGET:998
TRYCALLFORM M_KOJO_K{TARGET}_{CFLAG:TARGET:998}
ELSE
TRYCALLFORM M_KOJO_K{TARGET}
ENDIF

SELECTCOM = -1
SIF PREVCOM == SELECTCOM
SELECTCOM = -2
TFLAG:情緒上昇抑制 = 1

RETURN 1


@DOKU_COMF_FAVOR_MOOD_FIX
;指令不失败、但不加target的好感情绪，只用在m_kojo%%message系，用来防止移动/收音机/眺望天空等加好感的bug
CALL DOKU_FAVOR_TRUST_CALC_FIX(TARGET,-99999,-99999)
TFLAG:99 = -1
RETURN 1

@DOKU_SRAND_T
;把当前时间作为随机数种子
GETTIME
RANDOMIZE RESULT:0
RETURN 1

@DOKU_RAND_ARRAY_GET(VAR_USED_HERE,BIT_START,BIT_END,ARRARY_USED_HERE)
;VAR_USED_HERE-用于记录的变量
;BIT_START-从VAR_USED_HERE的第BIT_START位开始读取
;BIT_END-读取到VAR_USED_HERE的第BIT_END位
;ARRARY_USED_HERE外部工具数组，大小应为BIT_END-BIT_START+1
;它被用于缓存，但是也因此需要在外部提前定义其大小，因为era语言并不支持动态的数组定义
;return-1时说明已经全部读完
#DIM DYNAMIC VAR_USED_HERE
#DIM DYNAMIC BIT_START
#DIM DYNAMIC BIT_END
#DIM DYNAMIC CURRENT_USED_HERE
#DIM DYNAMIC RESULT_HERE
#DIM REF ARRARY_USED_HERE
CALL DOKU_SRAND_T
RESULT_HERE = -1
;INI
FOR CURRENT_USED_HERE,0,BIT_END - BIT_START + 1
ARRARY_USED_HERE:CURRENT_USED_HERE = CURRENT_USED_HERE + BIT_START
NEXT
;RAND
FOR CURRENT_USED_HERE,0,BIT_END - BIT_START
SWAP ARRARY_USED_HERE:(RAND:(BIT_END - BIT_START - CURRENT_USED_HERE + 1)) , ARRARY_USED_HERE:(BIT_END - BIT_START - CURRENT_USED_HERE)
NEXT
;CHECK
FOR CURRENT_USED_HERE,0,BIT_END - BIT_START + 1
IF !GETBIT(VAR_USED_HERE,CURRENT_USED_HERE + BIT_START)
RESULT_HERE = ARRARY_USED_HERE:CURRENT_USED_HERE
BREAK
ENDIF
NEXT
RETURN RESULT_HERE