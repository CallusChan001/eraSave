@QOL_SCOM_CHECK(ARG)
#DIM OLDSELECTCOM
#DIM OLDMASTERPOSE
#DIM OLDCHARAPOSE
#DIM OLDTFLAG194
SIF !TARGET
    RETURN 0
    
OLDMASTERPOSE = TEQUIP:MASTER:体位
OLDCHARAPOSE = TEQUIP:TARGET:体位
OLDSELECTCOM = SELECTCOM
OLDTFLAG194 = TFLAG:194
SELECTCOM = ARG
ADD_TEMPTOUCHMODE = 1
CALL ADD_TEMPTOUCH_CLEAR
CALL TOUCH_SUCCESSION(TARGET)

RESULTS =
CALL QOL_IS_SCOM_CHECK
LOCAL = RESULT
IF LOCAL == ADD_CUSTOM_SCOM
    RESULTS = %Add_Custom_SCOM_Name(RESULT:1)%
ELSEIF LOCAL > 0
    RESULTS = %STR_TR(1500 + LOCAL)%
ENDIF

;restore states
ADD_TEMPTOUCHMODE = 0
SELECTCOM = OLDSELECTCOM
TEQUIP:MASTER:体位 = OLDMASTERPOSE
TEQUIP:TARGET:体位 = OLDCHARAPOSE
TFLAG:194 = OLDTFLAG194

RETURN LOCAL

@QOL_CUSTOM_SCOM_CHECK(ARG)
#DIM OLDSELECTCOM
#DIM OLDCUSTOMSELECTCOM
#DIM OLDMASTERPOSE
#DIM OLDCHARAPOSE
#DIM OLDTFLAG194
SIF !TARGET
    RETURN 0
    
OLDMASTERPOSE = TEQUIP:MASTER:体位
OLDCHARAPOSE = TEQUIP:TARGET:体位
OLDSELECTCOM = SELECTCOM
OLDCUSTOMSELECTCOM = ADD_SELECTCUSTOMCOM
OLDTFLAG194 = TFLAG:194
SELECTCOM = ADD_CUSTOM_COM
ADD_SELECTCUSTOMCOM = ARG
ADD_TEMPTOUCHMODE = 1
CALL ADD_TEMPTOUCH_CLEAR
CALL TOUCH_SUCCESSION(TARGET)

RESULTS =
CALL QOL_IS_SCOM_CHECK
LOCAL = RESULT
IF LOCAL == ADD_CUSTOM_SCOM
    RESULTS = %Add_Custom_SCOM_Name(RESULT:1)%
ELSEIF LOCAL > 0
    RESULTS = %STR_TR(1500 + LOCAL)%
ENDIF

;restore states
ADD_TEMPTOUCHMODE = 0
SELECTCOM = OLDSELECTCOM
TEQUIP:MASTER:体位 = OLDMASTERPOSE
TEQUIP:TARGET:体位 = OLDCHARAPOSE
ADD_SELECTCUSTOMCOM = OLDCUSTOMSELECTCOM
TFLAG:194 = OLDTFLAG194

RETURN LOCAL >= 0

@QOL_IS_SCOM_CHECK
CALL Add_Custom_CALL_COM(TARGET)
IF TFLAG:50 == ADD_CUSTOM_SCOM
    LOCAL = ADD_SELECTED_SCOM
    TFLAG:50 = 0
    ADD_SELECTED_SCOM = -1
    
    RESULT = 0
    CALL QOL_SCOM_CHECK_CUSTOM_SCOM_ABLE(LOCAL)
    IF RESULT
        RESULT:1 = LOCAL
        RETURN ADD_CUSTOM_SCOM
    ENDIF
ENDIF

LOCAL = ADD_SCOM_CHECKS(TARGET)

IF LOCAL > 0
    RESULT = 0
    CALL QOL_SCOM_CHECK_SCOM_ABLE(LOCAL)
    SIF RESULT
        RETURN LOCAL
ENDIF
RETURN -1

@QOL_SCOM_CHECK_SCOM_ABLE(ARG)
RESULT = 0
TRYCALLFORM COM_ABLE{500 + ARG}
SIF !RESULT
    RETURN 0

TRYCCALLFORM CAN_SCOM{ARG}(1)
    RETURN RESULT
CATCH
    RETURN 1
ENDCATCH

@QOL_SCOM_CHECK_CUSTOM_SCOM_ABLE(ARG)
RESULT = 0
TRYCALLFORM ADD_CUSTOM_SCOM_ABLE{ARG}
SIF !RESULT
    RETURN 0
TRYCCALLFORM ADD_CUSTOM_CAN_SCOM{ARG}(1)
    RETURN RESULT
CATCH
    RETURN 1
ENDCATCH
