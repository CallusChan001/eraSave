;replaces the fall state acquisition menu with one with pages.
@SHOW_FALL_STATE_REV_REQUIREMENTS(ARG,NO_FALLS=0,EXPECTED_WIDTH)
;#DIMS DISP_NAME = "恋慕系", "炮友系", "", "肉体", "技能", "音乐"
#DIMS DISP_NAME = "恋慕系", "", "", "肉体", "技能", "音乐"
#DIM SFSR_LINECOUNT
#DIM NO_FALLS
#DIM EXPECTED_WIDTH
REDRAW 0
SFSR_LINECOUNT = LINECOUNT
SIF GROUPMATCH(LOCAL,0,1,2) && NO_FALLS
    SFSR_PAGE = 3
CALL PRINTBUTTON_EX("素质获得",915,TFLAG_HideSkillAcquisition, , , 1, EXPECTED_WIDTH)
SIF TFLAG_HideSkillAcquisition
    RETURN
PRINTL
FOR LOCAL,1,SFSR_MAX
    VARSET SFSR_NAME
    VARSET SFSR_STRING
    TRYCCALLFORM SHOW_FALL_STATE_REV_INFO_{LOCAL}(ARG)
        SIF TOLOWER(SFSR_TYPE) != TOLOWER(DISP_NAME:SFSR_PAGE)
            CONTINUE
        SIF !SFSR_CANDO
            CONTINUE
        SIF SFSR_STRING == ""
            SFSR_STRING '= @"□%SFSR_NAME%取得条件"
    CATCH
        CONTINUE
    ENDCATCH
    CALL COLORMESSAGE(SFSR_STRING,C_AQUA,1)
    PRINTFORML 
    TRYCALLFORM SHOW_FALL_STATE_REV_{LOCAL}(ARG)
    PRINTFORML %"-"*(EXPECTED_WIDTH)%
NEXT
FOR LOCAL, 0, VARSIZE("DISP_NAME")
	SIF GROUPMATCH(LOCAL,0,1,2) && NO_FALLS
        CONTINUE
	SIF GROUPMATCH(LOCAL,2); && !RAPEOPTION
		CONTINUE
	SIF !STRLENS(DISP_NAME:LOCAL)
		CONTINUE
	SIF SFSR_PAGE == LOCAL
		SETCOLOR 0x00FFFF
	;exception for player character
	PRINTBUTTON DISP_NAME:LOCAL, LOCAL + 3500
	RESETCOLOR
	PRINTFORM 　　
NEXT
PRINTL

;for handling lists of EXISTING requirements, like "Lewd"
@SFSR_LIST(ARG,SFSR_REQUIRE:0=-1,SFSR_REQUIRE:1=-1,SFSR_REQUIRE:2=-1,SFSR_REQUIRE:3=-1,SFSR_REQUIRE:4=-1,SFSR_REQUIRE:5=-1,SFSR_REQUIRE:6=-1,SFSR_REQUIRE:7=-1,SFSR_REQUIRE:8=-1,SFSR_REQUIRE:9=-1)
#DIM DYNAMIC SFSR_REQUIRE,10
FOR LOCAL,0,VARSIZE("SFSR_REQUIRE")
    SIF SFSR_REQUIRE:LOCAL <= 0
        CONTINUE
    VARSET SFSR_NAME
    VARSET SFSR_STRING
    TRYCCALLFORM SHOW_FALL_STATE_REV_INFO_{SFSR_REQUIRE:LOCAL}(ARG)
        SIF !SFSR_CANDO
            CONTINUE
    CATCH
        CONTINUE
    ENDCATCH
    CALL COLORMESSAGE(@"-　%SFSR_NAME%",C_AQUA,1)
    TRYCALLFORM SHOW_FALL_STATE_REV_{SFSR_REQUIRE:LOCAL}(ARG)
NEXT

;Lover, 恋人
@SHOW_FALL_STATE_REV_INFO_6(ARG)
SFSR_TYPE '= "恋慕系"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(7,1)

@SHOW_FALL_STATE_REV_6(ARG)
#DIM AG_NEEDED
VARSET AG_NEEDED, 350
SIF TALENT:ARG:25
    AG_NEEDED += 100
CALL CHARA_ATTITUDE()

IF TALENT:ARG:7
	PRINT 　
	CALL COLORMESSAGE(@"-　已达成",C_YELLOW,1)
ELSEIF !CAN_MAKE_恋人()
	PRINT 　
	CALL COLORMESSAGE(@"-无法达成",C_RED,1)
ELSE
	PRINT 　
	CALL COND_COLORMESSAGE(CFLAG:ARG:合意判定 >= AG_NEEDED,@"必要合意 {AG_NEEDED} (现在: {CFLAG:ARG:合意判定})")
ENDIF
[SKIPSTART]
;Deep Love
;To be enabled once JPAnon adds it
; @SHOW_FALL_STATE_REV_INFO_7(ARG)
; SFSR_TYPE '= "恋慕系"
; SFSR_CANDO = 1
; SFSR_NAME '= GET_TALENTNAME(3,1)

; @SHOW_FALL_STATE_REV_7(ARG)
; IF TALENT:ARG:恋慕
; 	PRINT 　
; 	CALL COLORMESSAGE(@"-　已获得",C_YELLOW,1)
; ELSEIF TALENT:ARG:愛欲 && !FLAG:陥落路線変化 ;qol custom code
; 	PRINT 　
; 	CALL COLORMESSAGE(@"-无法达成",C_RED,1)
; ELSE
; 	CALL KOJO_CHECK(ARG, "FALL_STATE_OVERRIDE", "LOVE") ;addition custom code
; 	IF RESULT
; 		IF RESULT < 0 ;no conditions should be set in "FALL_STATE" check
; 			PRINT 　
; 			CALL COLORMESSAGE(@"-无法达成",C_RED,1)
; 		ENDIF
; 		GOTO CUSTOM_LOVE
; 	ENDIF
; 	PRINT 　
; 	CALL COND_COLORMESSAGE(CFLAG:ARG:2 >= REQUIRED_FAVOR_恋慕,@"{REQUIRED_FAVOR_恋慕} 好感度 (Current:{CFLAG:ARG:2})")
; 	PRINT 　
; 	CALL COND_COLORMESSAGE(CFLAG:ARG:4 >= REQUIRED_TRUST_恋慕,@"{REQUIRED_TRUST_恋慕} 信赖度 (Current:{CFLAG:ARG:4})")
; 	PRINT 　
; 	CALL COND_COLORMESSAGE(ABL:ARG:親密 >= REQUIRED_AFFECTION_恋慕,@"{REQUIRED_AFFECTION_恋慕} 親密 (Current:{ABL:ARG:親密})")
; 	PRINT 　
; 	CALL COND_COLORMESSAGE(!MARK:ARG:反発刻印,@"反発刻印なし (Current:{MARK:ARG:反発刻印})")
; 	$CUSTOM_LOVE
; 	CALL ADD_PRINT_FALL_STATES("LOVE", ARG) ;addition custom code
; ENDIF

;Love, 恋慕
@SHOW_FALL_STATE_REV_INFO_8(ARG)
SFSR_TYPE '= "恋慕系"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(3,1)


@SHOW_FALL_STATE_REV_8(ARG)
IF TALENT:ARG:恋慕
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得",C_YELLOW,1)
ELSEIF TALENT:ARG:愛欲 && !FLAG:陥落路線変化 ;qol custom code
	PRINT 　
	CALL COLORMESSAGE(@"-无法达成",C_RED,1)
ELSE
	;CALL KOJO_CHECK(ARG, "FALL_STATE_OVERRIDE", "LOVE") ;addition custom code
	IF RESULT
		IF RESULT < 0 ;no conditions should be set in "FALL_STATE" check
			PRINT 　
			CALL COLORMESSAGE(@"-无法达成",C_RED,1)
		ENDIF
		GOTO CUSTOM_LOVE
	ENDIF
	PRINT 　
	CALL COND_COLORMESSAGE(CFLAG:ARG:2 >= REQUIRED_FAVOR_恋慕,@"{REQUIRED_FAVOR_恋慕} 好感度 (现在: {CFLAG:ARG:2})")
	PRINT 　
	CALL COND_COLORMESSAGE(CFLAG:ARG:4 >= REQUIRED_TRUST_恋慕,@"{REQUIRED_TRUST_恋慕} 信赖度 (现在: {CFLAG:ARG:4})")
	PRINT 　
	CALL COND_COLORMESSAGE(ABL:ARG:親密 >= REQUIRED_AFFECTION_恋慕,@"{REQUIRED_AFFECTION_恋慕} 亲密 (现在: {ABL:ARG:親密})")
	PRINT 　
	CALL COND_COLORMESSAGE(!MARK:ARG:反発刻印,@"反発刻印なし (现在: {MARK:ARG:反発刻印})")
	$CUSTOM_LOVE
	;CALL ADD_PRINT_FALL_STATES("LOVE", ARG) ;addition custom code
ENDIF

;Yearning, 思慕
@SHOW_FALL_STATE_REV_INFO_9(ARG)
SFSR_TYPE '= "恋慕系"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(8,1)

@SHOW_FALL_STATE_REV_9(ARG)
IF TALENT:ARG:恋慕 || TALENT:ARG:思慕
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得",C_YELLOW,1)
ELSE
	;CALL KOJO_CHECK(ARG, "FALL_STATE_OVERRIDE", "YEARNING") ;addition custom code
	IF RESULT
		IF RESULT < 0 ;no conditions should be set in "FALL_STATE" check
			PRINT 　
			CALL COLORMESSAGE(@"-无法达成",C_RED,1)
		ENDIF
		GOTO CUSTOM_YEARNING
	ENDIF
	PRINT 　
	CALL COND_COLORMESSAGE(CFLAG:ARG:2 >= REQUIRED_FAVOR_思慕,@"{REQUIRED_FAVOR_思慕} 好感度 (现在: {CFLAG:ARG:2})")
	PRINT 　
	CALL COND_COLORMESSAGE(CFLAG:ARG:4 >= REQUIRED_TRUST_思慕,@"{REQUIRED_TRUST_思慕} 信赖度 (现在: {CFLAG:ARG:4})")
	PRINT 　
	CALL COND_COLORMESSAGE(ABL:ARG:親密 >= REQUIRED_AFFECTION_思慕,@"{REQUIRED_AFFECTION_思慕} 親密 (现在: {ABL:ARG:親密})")
	$CUSTOM_YEARNING
	;CALL ADD_PRINT_FALL_STATES("YEARNING", ARG) ;addition custom code
ENDIF

;Lewd, 淫乱, custom code
;@SHOW_FALL_STATE_REV_INFO_10(ARG)
;SFSR_TYPE '= "炮友系"
;SFSR_CANDO = 1
;SFSR_NAME '= GET_TALENTNAME(4,1)

;@SHOW_FALL_STATE_REV_10(ARG)
;IF TALENT:ARG:4
;	PRINT 　
;	CALL COLORMESSAGE(@"-　已获得",C_YELLOW,1)
;ELSE
;    CALL SFSR_LIST(ARG,38,39,37,30,32,31,41)
;ENDIF

;Lust, 愛欲
@SHOW_FALL_STATE_REV_INFO_16(ARG)
SFSR_TYPE '= "炮友系"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(184,1)

@SHOW_FALL_STATE_REV_16(ARG)
#DIM 自覚絶頂
自覚絶頂 = EXP:ARG:絶頂経験 - EXP:ARG:無自覚絶頂経験
IF TALENT:ARG:恋慕
	PRINT 　
	CALL COLORMESSAGE(@"-无法达成",C_RED,1)
ELSEIF TALENT:ARG:愛欲
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得",C_YELLOW,1)
ELSE
	;CALL KOJO_CHECK(ARG, "FALL_STATE_OVERRIDE", "LUST")
	IF RESULT
		IF RESULT < 0 ;no conditions should be set in "FALL_STATE" check
			PRINT 　
			CALL COLORMESSAGE(@"-无法达成",C_RED,1)
		ENDIF
		GOTO CUSTOM_LUST
	ENDIF
	PRINT 　
	CALL COND_COLORMESSAGE(CFLAG:ARG:2 >= REQUIRED_FAVOR_愛欲,@"{REQUIRED_FAVOR_愛欲} 好感度 (现在: {CFLAG:ARG:2})")
	PRINT 　
	CALL COND_COLORMESSAGE(ABL:ARG:欲望 >= REQUIRED_DESIRE_愛欲,@"{REQUIRED_DESIRE_愛欲} 欲望 (现在: {ABL:ARG:欲望})")
	PRINT 　
	CALL COND_COLORMESSAGE(自覚絶頂 >= REQUIRED_ECSTACY_愛欲,@"意識のある状態で {REQUIRED_ECSTACY_愛欲} 以上絶頂 (现在: {自覚絶頂})")
	PRINT 　
	;custom code
	CALL COND_COLORMESSAGE((ABL:ARG:欲望 - ABL:ARG:親密) >= 1,@"欲望大于亲密 (现在: {ABL:ARG:欲望}vs{ABL:ARG:親密})")
	$CUSTOM_LUST
	;CALL ADD_PRINT_FALL_STATES("LUST", ARG) ;addition custom code
ENDIF


;Mistress, 愛人
@SHOW_FALL_STATE_REV_INFO_17(ARG)
SFSR_TYPE '= "炮友系"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(185,2)

@SHOW_FALL_STATE_REV_17(ARG)
IF TALENT:ARG:恋慕 || TALENT:ARG:184
	PRINT 　
	CALL COLORMESSAGE(@"-无法达成",C_RED,1)
ELSEIF TALENT:ARG:185 == 2
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得",C_YELLOW,1)
ELSE
	PRINT 　
	;this will always pass
	CALL COND_COLORMESSAGE(1,@"第二段階陥落状態なし (%GET_TALENTNAME(3,1)%/%GET_TALENTNAME(184,1)%)")
	CALL SFSR_LIST(ARG,9,19)
ENDIF

;Sexfriend, セフレ
@SHOW_FALL_STATE_REV_INFO_19(ARG)
SFSR_TYPE '= "炮友系"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(185,1)

@SHOW_FALL_STATE_REV_19(ARG)
#DIM 自覚絶頂
自覚絶頂 = EXP:ARG:絶頂経験 - EXP:ARG:無自覚絶頂経験
IF TALENT:ARG:恋慕 || TALENT:ARG:恋人
	PRINT 　
	CALL COLORMESSAGE(@"-无法达成",C_RED,1)
ELSEIF TALENT:ARG:セフレ
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得",C_YELLOW,1)
ELSE
	;CALL KOJO_CHECK(ARG, "FALL_STATE_OVERRIDE", "SEX FRIEND") ;addition custom code
	IF RESULT
		IF RESULT < 0 ;no conditions should be set in "FALL_STATE" check
			PRINT 　
			CALL COLORMESSAGE(@"-无法达成",C_RED,1)
		ENDIF
		GOTO CUSTOM_SEX_FRIEND
	ENDIF
	PRINT 　
	CALL COND_COLORMESSAGE(CFLAG:ARG:2 >= REQUIRED_FAVOR_セフレ,@"{REQUIRED_FAVOR_セフレ} 好感度 (现在: {CFLAG:ARG:2})")
	PRINT 　
	CALL COND_COLORMESSAGE(ABL:ARG:欲望 >= REQUIRED_DESIRE_セフレ,@"{REQUIRED_DESIRE_セフレ} 欲望 (现在: {ABL:ARG:欲望})")
	PRINT 　
	CALL COND_COLORMESSAGE(自覚絶頂 >= REQUIRED_ECSTACY_セフレ,@"意識のある状態で {REQUIRED_ECSTACY_愛欲} 以上絶頂 (现在: {自覚絶頂})")
	PRINT 　
	CALL COND_COLORMESSAGE((ABL:ARG:欲望 - ABL:ARG:親密) >= 0,@"欲望大于亲密 (现在: {ABL:ARG:欲望}vs{ABL:ARG:親密})")
	$CUSTOM_SEX_FRIEND
	;CALL ADD_PRINT_FALL_STATES("SEX FRIEND", ARG) ;addition custom code
ENDIF
[SKIPEND]
;Lewd Lips, キス魔
@SHOW_FALL_STATE_REV_INFO_30(ARG)
SFSR_TYPE '= "肉体"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(77,1)

@SHOW_FALL_STATE_REV_30(ARG)
IF TALENT:ARG:キス魔
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
	PRINT 　
	CALL COND_COLORMESSAGE(EXP:ARG:キス経験 > 300,@"接吻经验 300 (现在: {EXP:ARG:キス経験})")
	PRINT 　
	CALL COND_COLORMESSAGE(ABL:ARG:Ｍ感覚 > 5,@"Ｍ感觉 6 (现在: {ABL:ARG:Ｍ感覚})")
ENDIF

;Loves to Masturbate, 自慰狂い
@SHOW_FALL_STATE_REV_INFO_31(ARG)
SFSR_TYPE '= "技能"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(73,1)

@SHOW_FALL_STATE_REV_31(ARG)
IF TALENT:ARG:自慰狂い
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
	PRINT 　
	CALL COND_COLORMESSAGE(EXP:ARG:調教自慰経験 > 200,@"调教自慰经验 200 (现在: {EXP:ARG:調教自慰経験})")
	PRINT 　
	CALL COND_COLORMESSAGE(EXP:ARG:自慰経験 > 500,@"自慰经验 500 (现在: {EXP:ARG:自慰経験})")
ENDIF

;Lewd Cervix, ポルチオ性感
@SHOW_FALL_STATE_REV_INFO_32(ARG)
SFSR_TYPE '= "肉体"
SFSR_CANDO = HAS_VAGINA(ARG)
SFSR_NAME '= GET_TALENTNAME(78,1)

@SHOW_FALL_STATE_REV_32(ARG)
IF TALENT:ARG:ポルチオ性感
    PRINT 　
    CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
    PRINT 　
    CALL COND_COLORMESSAGE(EXP:ARG:子宮口開発経験 > 50,@"子宫口开发经验 50 (现在: {EXP:ARG:子宮口開発経験})")
ENDIF


;Perfect Pitch, 絶対音感, custom code
;@SHOW_FALL_STATE_REV_INFO_33(ARG)
;SFSR_TYPE '= "音乐"
;SFSR_CANDO = ARG != MASTER
;SFSR_NAME '= GET_TALENTNAME(162,2)

;@SHOW_FALL_STATE_REV_33(ARG)
;IF TALENT:ARG:音感 >= 2
;    PRINT 　
;    CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
;ELSE
;    PRINT 　
;    CALL COND_COLORMESSAGE(EXP:ARG:演奏経験 >= 10000,@"Musical Performance Exp 10000 (现在: {EXP:ARG:演奏経験})")
;ENDIF

;Sense of Sound, 相対音感
@SHOW_FALL_STATE_REV_INFO_34(ARG)
SFSR_TYPE '= "音乐"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(162,1)

@SHOW_FALL_STATE_REV_34(ARG)
IF TALENT:ARG:音感 >= 1
    PRINT 　
    CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
    PRINT 　
    CALL COND_COLORMESSAGE(EXP:ARG:演奏経験 >= 5000,@"演奏经验 5000 (现在: {EXP:ARG:演奏経験})")
ENDIF


;Musical Knowledge, 音楽知識
@SHOW_FALL_STATE_REV_INFO_45(ARG)
SFSR_TYPE '= "音乐"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(161,1)

@SHOW_FALL_STATE_REV_45(ARG)
IF TALENT:ARG:音楽知識
    PRINT 　
    CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
    PRINT 　
    CALL COND_COLORMESSAGE(EXP:ARG:演奏経験 >= 1000,@"演奏经验 1000 (现在: {EXP:ARG:演奏経験})")
    PRINT 　
    CALL COND_COLORMESSAGE(ABL:ARG:技巧 > 3 ,@"技巧 4 (现在: {ABL:ARG:技巧})")
ENDIF


;Nimble Finger, 器用な指
@SHOW_FALL_STATE_REV_INFO_35(ARG)
SFSR_TYPE '= "肉体"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(51,1)


@SHOW_FALL_STATE_REV_35(ARG)
IF TALENT:ARG:器用な指
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
	PRINT 　
	CALL COND_COLORMESSAGE(ABL:ARG:指 >= universalRank("S"),@"指技术 {universalRank("S")} (现在: {ABL:ARG:指})")
ENDIF

;Skileld Tongue, 舌使い
@SHOW_FALL_STATE_REV_INFO_36(ARG)
SFSR_TYPE '= "肉体"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(52,1)

@SHOW_FALL_STATE_REV_36(ARG)
IF TALENT:ARG:舌使い
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
	PRINT 　
	CALL COND_COLORMESSAGE(ABL:ARG:舌 >= universalRank("S"),@"舌技术 {universalRank("S")} (现在: {ABL:ARG:舌})")
ENDIF

;Lewd breasts, 淫乳
@SHOW_FALL_STATE_REV_INFO_37(ARG)
SFSR_TYPE '= "肉体"
SFSR_CANDO = IS_FEMALE(ARG)
SFSR_NAME '= GET_TALENTNAME(76,1)

@SHOW_FALL_STATE_REV_37(ARG)
IF TALENT:ARG:淫乳
    PRINT 　
    CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
    PRINT 　
    CALL COND_COLORMESSAGE(ABL:ARG:胸 >= universalRank("S"),@"胸技术 {universalRank("S")} (现在: {ABL:ARG:胸})")
ENDIF

;Lewd Vag, 淫壺
@SHOW_FALL_STATE_REV_INFO_38(ARG)
SFSR_TYPE '= "肉体"
SFSR_CANDO = HAS_VAGINA(ARG)
SFSR_NAME '= GET_TALENTNAME(74,1)


@SHOW_FALL_STATE_REV_38(ARG)
IF TALENT:ARG:淫壺
    PRINT 　
    CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
    PRINT 　
    CALL COND_COLORMESSAGE(ABL:ARG:膣 >= universalRank("S"),@"膣技术 {universalRank("S")} (现在: {ABL:ARG:膣})")
ENDIF

;Lewd Anal, 尻穴狂い
@SHOW_FALL_STATE_REV_INFO_39(ARG)
SFSR_TYPE '= "肉体"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(75,1)

@SHOW_FALL_STATE_REV_39(ARG)
IF TALENT:ARG:尻穴狂い
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
	PRINT 　
	CALL COND_COLORMESSAGE(ABL:ARG:アナル >= universalRank("S"),@"A技术 {universalRank("S")} (现在: {ABL:ARG:アナル})")
ENDIF

;Mixing Knowledge, 調合知識
@SHOW_FALL_STATE_REV_INFO_40(ARG)
SFSR_TYPE '= "技能"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(55,1)

@SHOW_FALL_STATE_REV_40(ARG)
IF TALENT:ARG:調合知識
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
	PRINT 　
	CALL COND_COLORMESSAGE(TALENT:ARG:調合Lv >= universalRank("B"),@"调合Lv {universalRank("B")} (现在: {TALENT:ARG:調合Lv})")
	PRINT 　
	CALL COND_COLORMESSAGE(ABL:ARG:教養 >= universalRank("B"),@"教养Lv {universalRank("B")} (现在: {ABL:ARG:教養})")
ENDIF

;Loves Taste of Semen, 精愛味覚
@SHOW_FALL_STATE_REV_INFO_41(ARG)
SFSR_TYPE '= "肉体"
SFSR_CANDO = 1
SFSR_NAME '= GET_TALENTNAME(122,1)

@SHOW_FALL_STATE_REV_41(ARG)
#DIM SEM_REQUIRE
SEM_REQUIRE = 10000 * (10 - 2 * TALENT:ARG:中毒しやすい) / 10

IF TALENT:ARG:122
	PRINT 　
	CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
ELSE
	PRINT 　
	CALL COND_COLORMESSAGE(CFLAG:ARG:累計精飲 > SEM_REQUIRE,@"累计精饮 {SEM_REQUIRE} (现在: {CFLAG:ARG:累計精飲})")
ENDIF

;Ignorant, 無知
@SHOW_FALL_STATE_REV_INFO_42(ARG)
SFSR_TYPE '= "技能"
SFSR_CANDO = TALENT:ARG:27
SFSR_NAME '= GET_TALENTNAME(27,1)
SFSR_STRING '= @"□%SFSR_NAME%丧失条件"


@SHOW_FALL_STATE_REV_42(ARG)
#DIM IGR_MASTURB
#DIM IGR_TIMES
IGR_TIMES = EXP:ARG:自慰経験
IGR_MASTURB = (120+EXP:ARG:調教自慰経験) - (MIN(ABL:ARG:親密,6) * 10)

IF !TALENT:ARG:27
	;this will probably never happen, but we print something saying that this character doesn't have ignorant anymore.
	;in case the game gets fucky.
	PRINT 　
	CALL COLORMESSAGE(@"-　已丧失", C_YELLOW, 1)
;ELSEIF ARG == MASTER ;custom code
	;you
	;PRINT 　
	;CALL COND_COLORMESSAGE(CFLAG:ARG:2 >= 500,@"{500} 好感度 (现在: {CFLAG:ARG:2})")
	;PRINT 　
	;CALL COND_COLORMESSAGE(CFLAG:ARG:4 >= 100,@"{100} Trust (现在: {CFLAG:ARG:4})")
	;PRINT 　
	;CALL COND_COLORMESSAGE(ABL:ARG:43 >= UniversalRank("C") ,@"{UniversalRank("C")} Knowledge (现在: {ABL:ARG:43})")
	;PRINT 　
	;CALL COND_COLORMESSAGE(ABL:MASTER:43 >= UniversalRank("C") ,@"%CALLNAME:MASTER%'s Knowledge {UniversalRank("C")} (现在: {ABL:MASTER:43})")

ELSE
	;custom code, IF case is modded
	;other touhou
	;IF ABL:ARG:43 < MaxNonHLevel
	;for some ungodly reason you managed to get an ignorant Touhou to Extra knowledge and not teach her about sex
		;PRINT 　
		;CALL COND_COLORMESSAGE(ABL:ARG:43 >= UniversalRank("C") ,@"Knowledge {UniversalRank("C")} (现在: {ABL:ARG:43})")
		;PRINT 　
		;CALL COND_COLORMESSAGE(ABL:MASTER:43 >= MAX(UniversalRank("C"),ABL:ARG:43)+1,@"%CALLNAME:MASTER%'s Knowledge {MAX(UniversalRank("C"),ABL:ARG:43)+1} (现在: {ABL:MASTER:43})")
		;PRINT 　
		;CALL COND_COLORMESSAGE(0,@"Go to a library and read an Ero book")
		;SETCOLOR C_AQUA
		;PRINTL 　OR
		;RESETCOLOR
	;ENDIF
	PRINT 　
	CALL COND_COLORMESSAGE(IGR_TIMES >= IGR_MASTURB,@"自慰经验大于{IGR_MASTURB} (现在: {IGR_TIMES})")

ENDIF

;These two are under the Spoiler Mode toggle since some aren't really fond of having these shown

;Unmatched, 絶倫， custom code
;@SHOW_FALL_STATE_REV_INFO_43(ARG)
;SFSR_TYPE '= "技能"
;SFSR_CANDO = HAS_PENIS(ARG) && nSpoilerMode
;SFSR_NAME '= GET_TALENTNAME(152,1)

;@SHOW_FALL_STATE_REV_43(ARG)
;IF TALENT:ARG:152
;	PRINT 　
;	CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
;ELSE
;	PRINT 　
;	CALL COND_COLORMESSAGE(EXP:ARG:射精経験 >= 1000,@"Ejaculation Exp greater than {1000} (现在: {EXP:ARG:射精経験})")
;ENDIF

;Fast Recovery, 回復速度, custom code
;@SHOW_FALL_STATE_REV_INFO_44(ARG)
;SFSR_TYPE '= "技能"
;SFSR_CANDO = nSpoilerMode
;SFSR_NAME '= GET_TALENTNAME(130,1)

;@SHOW_FALL_STATE_REV_44(ARG)
;IF TALENT:ARG:回復速度 >= 1
;	PRINT 　
;	CALL COLORMESSAGE(@"-　已获得", C_YELLOW, 1)
;ELSE
;	PRINT 　
;	CALL COND_COLORMESSAGE(MAXBASE:ARG:0 >= 4000,@"Max Stamina greater than {4000-500} (现在: {MAXBASE:ARG:0-500})")
;	PRINT 　
;	CALL COND_COLORMESSAGE(MAXBASE:ARG:1 >= 3000,@"Max Energy greater than {3000} (现在: {MAXBASE:ARG:1})")
;ENDIF


@universalRank(nRANK)
#FUNCTION
#DIMS nRANK
#DIMS SubStr
#DIM DYNAMIC nRerun

SubStr '= SUBSTRING(nRANK, STRLENS(nRANK)-1, STRLENS(nRANK))
A = 0

IF SubStr == "+" || SubStr == "-"
	nRank '= SUBSTRING(nRANK, 0, STRLENS(nRANK)-1)
	IF SubStr == "+"
		A = 1
	ELSEIF SubStr == "-"
		A = -1
	ENDIF
ENDIF
$REDO
SELECTCASE TOUPPER(nRANK)
	CASE "E"
		LOCAL = 0
	CASE "D"
		LOCAL = 1
	CASE "C"
		LOCAL = 2
	CASE "B"
		LOCAL = 3
	CASE "A"
		LOCAL = 4
	CASE "S"
		LOCAL = 5
	CASE "EX"
		LOCAL = 6
ENDSELECT

RETURNF LOCAL