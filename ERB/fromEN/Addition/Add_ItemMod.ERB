;first, add item name in Add_ItemModList to make it available for modding, then specify the mods in the list below, add corresponding effects in the code

@Add_ItemMod(ARG)
#LOCALSIZE 2
#LOCALSSIZE 1
#DIM nItemMod
#DIM nCostSum
SELECTCASE ARG
CASE GETNUM(ITEM, "保温壺")
	SIF !ITEM:保温壺
		RETURN
	LOCAL:1 = LINECOUNT
	DO
		SIF LINECOUNT - LOCAL:1 > 0
			CLEARLINE LINECOUNT - LOCAL:1
		
		nItemMod = GETBIT(nThermalJarMods, ThermalJar_FreshDisplay) && GETBIT(nThermalJarMods, ThermalJar_FreshUpgrade) && GETBIT(nThermalJarMods, ThermalJar_MoreFreshUpgrade) && GETBIT(nThermalJarMods, ThermalJar_StealProtectionUpgrade)
		;set initial sum
		nCostSum = nThermalJarModsCost:0 + nThermalJarModsCost:1 + nThermalJarModsCost:2 + nThermalJarModsCost:3
		;see if other upgrades purchased
		nCostSum -= GETBIT(nThermalJarMods, ThermalJar_FreshDisplay) * nThermalJarModsCost:0
		nCostSum -= GETBIT(nThermalJarMods, ThermalJar_FreshUpgrade) * nThermalJarModsCost:1
		nCostSum -= GETBIT(nThermalJarMods, ThermalJar_MoreFreshUpgrade) * nThermalJarModsCost:2
		nCostSum -= GETBIT(nThermalJarMods, ThermalJar_StealProtectionUpgrade) * nThermalJarModsCost:3
		DRAWLINE
		CALL SPTALK, [[にとり]], "笑顔", 0, @"「你想怎么改造？」", 1
		PRINTD 当前状态：
		CALL Add_ItemModList_保温壺
		PRINTL
		DRAWLINE
		
		IF !GETBIT(nThermalJarMods, ThermalJar_FreshDisplay)
			PRINTFORML [  1] - 食物新鲜度显示 %金額表示(nThermalJarModsCost:0)%：显示食物当前新鲜度
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 食物新鲜度显示：显示食物当前新鲜度
			RESETCOLOR
		ENDIF
		IF !GETBIT(nThermalJarMods, ThermalJar_FreshUpgrade)
			PRINTFORML [  2] - 新鲜度升级Mk1：%金額表示(nThermalJarModsCost:1)%：采用稀有材料的时尚涂装，食物变质过程延迟x5
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 新鲜度升级Mk1：食物变质过程延迟x5
			RESETCOLOR
		ENDIF
		IF GETBIT(nThermalJarMods, ThermalJar_FreshUpgrade)
			IF !GETBIT(nThermalJarMods, ThermalJar_MoreFreshUpgrade)
				PRINTFORML [  3] - 新鲜度升级Mk2 %金額表示(nThermalJarModsCost:2)%：用稀有保温合金彻底重制保温壶（含涂装），食物变质过程延迟x10
			ELSE
				SETCOLOR C_GRAY
				PRINTL [ X ] - 新鲜度升级Mk2：食物变质过程延迟x10
				RESETCOLOR
			ENDIF
		ENDIF
		IF !GETBIT(nThermalJarMods, ThermalJar_StealProtectionUpgrade)
			PRINTFORML [  4] - 密码锁：%金額表示(nThermalJarModsCost:3)%：防止未经允许的开启
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 密码锁：防止未经允许的开启
			RESETCOLOR
		ENDIF
		IF nItemMod == 0
			PRINTFORML [  5] - 全部安装（总计%金額表示(nCostSum)%）
		ELSE
			PRINTL 　　　　无法再进行改造了。
		ENDIF
		
		PRINTL [999] - 算了
		INPUT
		SELECTCASE RESULT
		CASE 999
			RETURN
		CASE 1
			IF !GETBIT(nThermalJarMods, ThermalJar_FreshDisplay) && MONEY >= nThermalJarModsCost:0
				PRINTL 你现在将能看到保温壶中食物的新鲜度！（0表示变质）
				SETBIT nThermalJarMods, ThermalJar_FreshDisplay, 0
				TIME += 5
				CALL PAY_MONEY_YEN(nThermalJarModsCost:0, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 2
			IF !GETBIT(nThermalJarMods, ThermalJar_FreshUpgrade) && MONEY >= nThermalJarModsCost:1
				PRINTL 保温壶中的食物将变质得更慢！
				PRINTL （请注意，如果保温壶中已有食物，则此效果要等你制作新菜肴后才会生效）
				SETBIT nThermalJarMods, ThermalJar_FreshUpgrade
				TIME += 10
				CALL PAY_MONEY_YEN(nThermalJarModsCost:1, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 3
			IF GETBIT(nThermalJarMods, ThermalJar_FreshUpgrade)
				IF !GETBIT(nThermalJarMods, ThermalJar_MoreFreshUpgrade) && MONEY >= nThermalJarModsCost:2
					PRINTL 保温壶中的食物将变质得更更慢！
					SETBIT nThermalJarMods, ThermalJar_MoreFreshUpgrade
					TIME += 30
					CALL PAY_MONEY_YEN(nThermalJarModsCost:2, 2)
				ELSE
					CONTINUE
				ENDIF
			ENDIF
		CASE 4
			IF !GETBIT(nThermalJarMods, ThermalJar_StealProtectionUpgrade) && MONEY >= nThermalJarModsCost:3
				PRINTL 人们现在偷你的食物会三思而后行了！
				PRINTL 这会让他们更难偷走你的食物，但并非不可能。
				PRINTL （从物品菜单中使用保温壶来启用/禁用密码锁）
				SETBIT nThermalJarMods, ThermalJar_StealProtectionUpgrade
				TIME += 60
				CALL PAY_MONEY_YEN(nThermalJarModsCost:3, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 5
			IF nItemMod == 0
				IF !GETBIT(nThermalJarMods, ThermalJar_FreshDisplay) && MONEY >= nThermalJarModsCost:0
					PRINTL 食物新鲜度显示已安装！
					PRINTL 你现在将能看到保温壶中食物的新鲜度！（0表示变质）
					SETBIT nThermalJarMods, ThermalJar_FreshDisplay, 0
					TIME += 5
					CALL PAY_MONEY_YEN(nThermalJarModsCost:0, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nThermalJarMods, ThermalJar_FreshUpgrade) && MONEY >= nThermalJarModsCost:1
					PRINTL 新鲜度升级Mk1已安装！
					PRINTL 保温壶中的食物将变质得更慢！
					PRINTL （请注意，如果保温壶中已有食物，则此效果要等你制作新菜肴后才会生效）
					SETBIT nThermalJarMods, ThermalJar_FreshUpgrade
					TIME += 10
					CALL PAY_MONEY_YEN(nThermalJarModsCost:1, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nThermalJarMods, ThermalJar_MoreFreshUpgrade) && MONEY >= nThermalJarModsCost:2
					PRINTL 新鲜度升级Mk2已安装！
					PRINTL 保温壶中的食物将变质得更更慢！
					SETBIT nThermalJarMods, ThermalJar_MoreFreshUpgrade
					TIME += 30
					CALL PAY_MONEY_YEN(nThermalJarModsCost:2, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nThermalJarMods, ThermalJar_StealProtectionUpgrade) && MONEY >= nThermalJarModsCost:3
					PRINTL 密码锁已安装！
					PRINTL 人们现在偷你的食物会三思而后行了！
					PRINTL 这会让他们更难偷走你的食物，但并非不可能。
					PRINTL （从物品菜单中使用保温壶来启用/禁用密码锁）
					SETBIT nThermalJarMods, ThermalJar_StealProtectionUpgrade
					TIME += 60
					CALL PAY_MONEY_YEN(nThermalJarModsCost:3, 2)
					PRINTL
				ENDIF
			ELSE
				RETURN
			ENDIF
		ENDSELECT
	LOOP 1
CASE GETNUM(ITEM, "折畳傘")
	SIF !ITEM:折畳傘
		RETURN
	LOCAL:1 = LINECOUNT
	DO
		SIF LINECOUNT - LOCAL:1 > 0
			CLEARLINE LINECOUNT - LOCAL:1
		
		nItemMod = GETBIT(nUmbrellaMods, Umbrella_MoreHealth) && GETBIT(nThermalJarMods, Umbrella_EvenMoreHealth) && GETBIT(nThermalJarMods, Umbrella_Resistance) && GETBIT(nThermalJarMods, Umbrella_Regen) && GETBIT(nThermalJarMods, Umbrella_HPDisplay) && GETBIT(nThermalJarMods, Umbrella_Reconstruction)
		DRAWLINE
		;set initial sum
		nCostSum = nUmbrellaModsCost:0 + nUmbrellaModsCost:1 + nUmbrellaModsCost:2 + nUmbrellaModsCost:3 + nUmbrellaModsCost:4 + nUmbrellaModsCost:5
		;see if other upgrades purchased
		nCostSum -= GETBIT(nUmbrellaMods, Umbrella_MoreHealth) * nUmbrellaModsCost:0
		nCostSum -= GETBIT(nUmbrellaMods, Umbrella_EvenMoreHealth) * nUmbrellaModsCost:1
		nCostSum -= GETBIT(nUmbrellaMods, Umbrella_Resistance) * nUmbrellaModsCost:2
		nCostSum -= GETBIT(nUmbrellaMods, Umbrella_Regen) * nUmbrellaModsCost:3
		nCostSum -= GETBIT(nUmbrellaMods, Umbrella_HPDisplay) * nUmbrellaModsCost:4
		nCostSum -= GETBIT(nUmbrellaMods, Umbrella_Reconstruction) * nUmbrellaModsCost:5
		CALL SPTALK, [[にとり]], "笑顔", 0, @"「不用担心你的伞坏掉会怎样，所有的改造都会保留下来！」/「那么，你想怎么改造它？」", 1
		PRINTD 当前状态：
		CALL Add_ItemModList_折畳傘
		PRINTL
		DRAWLINE
		
		IF !GETBIT(nUmbrellaMods, Umbrella_MoreHealth)
			PRINTFORML [  1] - 耐久度升级Mk1 %金額表示(nUmbrellaModsCost:0)%：伞用特殊材料重制，使其能承受更多损伤
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 耐久度升级Mk1：使伞的耐久度提高x3
			RESETCOLOR
		ENDIF
		IF GETBIT(nUmbrellaMods, Umbrella_MoreHealth)
			IF !GETBIT(nUmbrellaMods, Umbrella_EvenMoreHealth)
				PRINTFORML [  2] - 耐久度升级Mk2 %金額表示(nUmbrellaModsCost:1)%：伞用外星材料重制，提供最佳耐久度
			ELSE
				SETCOLOR C_GRAY
				PRINTL [ X ] - 耐久度升级Mk2：使伞的耐久度提高x5
				RESETCOLOR
			ENDIF
		ENDIF
		IF !GETBIT(nUmbrellaMods, Umbrella_Resistance)
			PRINTFORML [  3] - 避雷针：%金額表示(nUmbrellaModsCost:2)%：安装智能避雷针，吸收元素，使伞更能抵抗恶劣天气
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 避雷针：提高对恶劣因素的抵抗力
			RESETCOLOR
		ENDIF
		IF !GETBIT(nUmbrellaMods, Umbrella_Regen)
			PRINTFORML [  4] - 再生：%金額表示(nUmbrellaModsCost:3)%：用自修复喷雾涂覆伞面，自动维护保养
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 再生：使伞能够自我修复
			RESETCOLOR
		ENDIF
		IF !GETBIT(nUmbrellaMods, Umbrella_HPDisplay)
			PRINTFORML [  5] - 耐久度显示：%金額表示(nUmbrellaModsCost:4)%：精确追踪伞的当前状态
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 耐久度显示：精确追踪伞的当前状态
			RESETCOLOR
		ENDIF
		IF !GETBIT(nUmbrellaMods, Umbrella_Reconstruction)
			PRINTFORML [  6] - 重构：%金額表示(nUmbrellaModsCost:5)%：全新的熵减科技！可以永续地从损坏状态中回复原状，恢复重构能力需要一个幻想乡日
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 重构：可以永续地从损坏状态中回复原状，恢复重构能力需要一个幻想乡日
			RESETCOLOR
		ENDIF
		IF nItemMod == 0
			PRINTFORML [  7] - 全部安装（总计%金額表示(nCostSum)%）
		ELSE
			PRINTL 　　　　无法再进行改造了。
		ENDIF
		
		PRINTL [999] - 算了
		INPUT
		SELECTCASE RESULT
		CASE 999
			RETURN
		CASE 1
			IF !GETBIT(nUmbrellaMods, Umbrella_MoreHealth) && MONEY >= nUmbrellaModsCost:0
				PRINTL 这把伞现在更耐用了！
				SETBIT nUmbrellaMods, Umbrella_MoreHealth, 0
				TIME += 10
				CALL PAY_MONEY_YEN(nUmbrellaModsCost:0, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 2
			IF GETBIT(nUmbrellaMods, Umbrella_MoreHealth)
				IF !GETBIT(nUmbrellaMods, Umbrella_EvenMoreHealth) && MONEY >= nUmbrellaModsCost:1
					PRINTL 这把伞现在更加耐用了！
					SETBIT nUmbrellaMods, Umbrella_EvenMoreHealth
					TIME += 30
					CALL PAY_MONEY_YEN(nUmbrellaModsCost:1, 2)
				ELSE
					CONTINUE
				ENDIF
			ENDIF
		CASE 3
			IF !GETBIT(nUmbrellaMods, Umbrella_Resistance) && MONEY >= nUmbrellaModsCost:2
				PRINTL 这把伞现在对恶劣因素的抵抗力更强了！
				SETBIT nUmbrellaMods, Umbrella_Resistance
				TIME += 20
				CALL PAY_MONEY_YEN(nUmbrellaModsCost:2, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 4
			IF !GETBIT(nUmbrellaMods, Umbrella_Regen) && MONEY >= nUmbrellaModsCost:3
				PRINTL 自我修复的伞，太棒了！
				SETBIT nUmbrellaMods, Umbrella_Regen
				TIME += 10
				CALL PAY_MONEY_YEN(nUmbrellaModsCost:3, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 5
			IF !GETBIT(nUmbrellaMods, Umbrella_HPDisplay) && MONEY >= nUmbrellaModsCost:4
				PRINTL 你现在将能看到你的伞有多少耐久度了！
				SETBIT nUmbrellaMods, Umbrella_HPDisplay
				TIME += 5
				CALL PAY_MONEY_YEN(nUmbrellaModsCost:4, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 6
			IF !GETBIT(nUmbrellaMods, Umbrella_Reconstruction) && MONEY >= nUmbrellaModsCost:5
				PRINTL 你的伞现在可以自动恢复原状了！……每天一次。
				SETBIT nUmbrellaMods, Umbrella_Reconstruction
				TIME += 60
				CALL PAY_MONEY_YEN(nUmbrellaModsCost:5, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 7
			IF nItemMod == 0
				IF !GETBIT(nUmbrellaMods, Umbrella_MoreHealth) && MONEY >= nUmbrellaModsCost:0
					PRINTL 耐久度升级Mk1已安装！
					PRINTL 这把伞现在更耐用了！
					SETBIT nUmbrellaMods, Umbrella_MoreHealth, 0
					TIME += 10
					CALL PAY_MONEY_YEN(nUmbrellaModsCost:0, 2)
					PRINTL
				ENDIF
				
				IF GETBIT(nUmbrellaMods, Umbrella_MoreHealth)
					IF !GETBIT(nUmbrellaMods, Umbrella_EvenMoreHealth) && MONEY >= nUmbrellaModsCost:1
						PRINTL 耐久度升级Mk2已安装！
						PRINTL 这把伞现在更加耐用了！
						SETBIT nUmbrellaMods, Umbrella_EvenMoreHealth
						TIME += 30
						CALL PAY_MONEY_YEN(nUmbrellaModsCost:1, 2)
						PRINTL
					ENDIF
				ENDIF
				
				IF !GETBIT(nUmbrellaMods, Umbrella_Resistance) && MONEY >= nUmbrellaModsCost:2
					PRINTL [避雷针]已安装！
					PRINTL 这把伞现在对恶劣因素的抵抗力更强了！
					SETBIT nUmbrellaMods, Umbrella_Resistance
					TIME += 20
					CALL PAY_MONEY_YEN(nUmbrellaModsCost:2, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nUmbrellaMods, Umbrella_Regen) && MONEY >= nUmbrellaModsCost:3
					PRINTL [再生]已安装！
					PRINTL 自我修复的伞，太棒了！
					SETBIT nUmbrellaMods, Umbrella_Regen
					TIME += 10
					CALL PAY_MONEY_YEN(nUmbrellaModsCost:3, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nUmbrellaMods, Umbrella_HPDisplay) && MONEY >= nUmbrellaModsCost:4
					PRINTL [耐久度显示]已安装！
					PRINTL 你现在将能看到你的伞有多少耐久度了！
					SETBIT nUmbrellaMods, Umbrella_HPDisplay
					TIME += 5
					CALL PAY_MONEY_YEN(nUmbrellaModsCost:4, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nUmbrellaMods, Umbrella_Reconstruction) && MONEY >= nUmbrellaModsCost:5
					PRINTL [重构]已安装！
					PRINTL 你的伞现在可以自动恢复原状了！……每天一次。
					SETBIT nUmbrellaMods, Umbrella_Reconstruction
					TIME += 60
					CALL PAY_MONEY_YEN(nUmbrellaModsCost:5, 2)
					PRINTL
				ENDIF
			ELSE
				RETURN
			ENDIF
		ENDSELECT
	LOOP 1
CASE GETNUM(ITEM, "電鋸")
	SIF !ITEM:電鋸
		RETURN
	LOCAL:1 = LINECOUNT
	DO
		SIF LINECOUNT - LOCAL:1 > 0
			CLEARLINE LINECOUNT - LOCAL:1
		
		nItemMod = GETBIT(nChainSawMods, ChainSaw_MiniFanDispenser) && GETBIT(nChainSawMods, ChainSaw_DualSaw) && GETBIT(nChainSawMods, ChainSaw_KickBack) && GETBIT(nChainSawMods, ChainSaw_TreeSeeker) && GETBIT(nChainSawMods, ChainSaw_Flashlight)
		DRAWLINE
		;set initial sum
		nCostSum = nChainSawModsCost:0 + nChainSawModsCost:1 + nChainSawModsCost:2 + nChainSawModsCost:3 + nChainSawModsCost:4
		;see if other upgrades purchased
		nCostSum -= GETBIT(nChainSawMods, ChainSaw_MiniFanDispenser) * nChainSawModsCost:0
		nCostSum -= GETBIT(nChainSawMods, ChainSaw_DualSaw) * nChainSawModsCost:1
		nCostSum -= GETBIT(nChainSawMods, ChainSaw_KickBack) * nChainSawModsCost:2
		nCostSum -= GETBIT(nChainSawMods, ChainSaw_TreeSeeker) * nChainSawModsCost:3
		nCostSum -= GETBIT(nChainSawMods, ChainSaw_Flashlight) * nChainSawModsCost:4
		CALL SPTALK, [[にとり]], "笑顔", 0, @"「你想怎么改造它？」", 1
		PRINTD 当前状态：
		CALL Add_ItemModList_電鋸
		PRINTL
		DRAWLINE
		
		IF !GETBIT(nChainSawMods, ChainSaw_MiniFanDispenser)
			PRINTFORML [  1] - 迷你风扇&饮水机 %金額表示(nChainSawModsCost:0)%：为电锯配备移动式饮水机以解渴，并配备迷你风扇以对抗疲劳
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 迷你风扇&饮水机：减少疲劳
			RESETCOLOR
		ENDIF
		IF !GETBIT(nChainSawMods, ChainSaw_DualSaw)
			PRINTFORML [  2] - 双锯片：%金額表示(nChainSawModsCost:1)%：乐趣加倍！让砍伐任何树木都变得轻而易举
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 双锯片：提升电锯效率
			RESETCOLOR
		ENDIF
		IF !GETBIT(nChainSawMods, ChainSaw_KickBack)
			PRINTFORML [  3] - 后座力减震器：%金額表示(nChainSawModsCost:2)%：厌倦了留意后座力？安装它，即使是最大的树木也不会带来任何麻烦！
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 后座力减震器：降低砍伐大型树木的难度
			RESETCOLOR
		ENDIF
		IF !GETBIT(nChainSawMods, ChainSaw_TreeSeeker)
			PRINTFORML [  4] - 寻树器：%金額表示(nChainSawModsCost:3)%：一个巧妙的雷达，无论身处何地都能帮你找到更有价值的树木！
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 寻树器：增加找到更有价值树木的几率
			RESETCOLOR
		ENDIF
		IF !GETBIT(nChainSawMods, ChainSaw_Flashlight)
			PRINTFORML [  5] - 手电筒：%金額表示(nChainSawModsCost:4)%：强大的自充电手电筒，让你即使在完全黑暗中也能砍树！
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 手电筒：即使在黑暗中也能伐木
			RESETCOLOR
		ENDIF
		IF nItemMod == 0
			PRINTFORML [  6] - 全部安装 (%金額表示(nCostSum)% 总计)
		ELSE
			PRINTL 　　　　无法再进行改造了。
		ENDIF
		
		PRINTL [999] - 算了
		INPUT
		SELECTCASE RESULT
		CASE 999
			RETURN
		CASE 1
			IF !GETBIT(nChainSawMods, ChainSaw_MiniFanDispenser) && MONEY >= nChainSawModsCost:0
				PRINTL 操作电锯时，你将更不容易疲劳！
				SETBIT nChainSawMods, ChainSaw_MiniFanDispenser, 0
				TIME += 15
				CALL PAY_MONEY_YEN(nChainSawModsCost:0, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 2
			IF !GETBIT(nChainSawMods, ChainSaw_DualSaw) && MONEY >= nChainSawModsCost:1
				PRINTL 现在砍伐树木将花费更少的时间和精力！
				SETBIT nChainSawMods, ChainSaw_DualSaw
				TIME += 10
				CALL PAY_MONEY_YEN(nChainSawModsCost:1, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 3
			IF !GETBIT(nChainSawMods, ChainSaw_KickBack) && MONEY >= nChainSawModsCost:2
				PRINTL 砍伐大型树木时的难度降低了！
				SETBIT nChainSawMods, ChainSaw_KickBack
				TIME += 30
				CALL PAY_MONEY_YEN(nChainSawModsCost:2, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 4
			IF !GETBIT(nChainSawMods, ChainSaw_TreeSeeker) && MONEY >= nChainSawModsCost:3
				PRINTL 你将更容易找到更好的树木！
				PRINTL 找到的树会更大
				PRINTL 有人说它甚至可以帮助你强化肉体……
				SETBIT nChainSawMods, ChainSaw_TreeSeeker
				TIME += 60
				CALL PAY_MONEY_YEN(nChainSawModsCost:3, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 5
			IF !GETBIT(nChainSawMods, ChainSaw_Flashlight) && MONEY >= nChainSawModsCost:4
				PRINTL 你现在将能够在夜间砍伐树木！
				SETBIT nChainSawMods, ChainSaw_Flashlight
				TIME += 10
				CALL PAY_MONEY_YEN(nChainSawModsCost:4, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 6
			IF nItemMod == 0
				IF !GETBIT(nChainSawMods, ChainSaw_MiniFanDispenser) && MONEY >= nChainSawModsCost:0
					PRINTL 迷你风扇&饮水机已安装！
					PRINTL 操作电锯时，你将更不容易疲劳！
					SETBIT nChainSawMods, ChainSaw_MiniFanDispenser, 0
					TIME += 15
					CALL PAY_MONEY_YEN(nChainSawModsCost:0, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nChainSawMods, ChainSaw_DualSaw) && MONEY >= nChainSawModsCost:1
					PRINTL 双锯片已安装！
					PRINTL 现在砍伐树木将花费更少的时间和精力！
					SETBIT nChainSawMods, ChainSaw_DualSaw
					TIME += 10
					CALL PAY_MONEY_YEN(nChainSawModsCost:1, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nChainSawMods, ChainSaw_KickBack) && MONEY >= nChainSawModsCost:2
					PRINTL 后座力减震器已安装！
					PRINTL 砍伐大型树木时的难度降低了！
					SETBIT nChainSawMods, ChainSaw_KickBack
					TIME += 30
					CALL PAY_MONEY_YEN(nChainSawModsCost:2, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nChainSawMods, ChainSaw_TreeSeeker) && MONEY >= nChainSawModsCost:3
					PRINTL 寻树器已安装！
					PRINTL 找到的树会更大
					PRINTL 有人说它甚至可以帮助你强化肉体……
					SETBIT nChainSawMods, ChainSaw_TreeSeeker
					TIME += 60
					CALL PAY_MONEY_YEN(nChainSawModsCost:3, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT(nChainSawMods, ChainSaw_Flashlight) && MONEY >= nChainSawModsCost:4
					PRINTL 手电筒已安装！
					PRINTL 你现在将能够在夜间砍伐树木！
					SETBIT nChainSawMods, ChainSaw_Flashlight
					TIME += 10
					CALL PAY_MONEY_YEN(nChainSawModsCost:4, 2)
					PRINTL
				ENDIF
			ELSE
				RETURN
			ENDIF
		ENDSELECT
	LOOP 1
CASE GETNUM(ITEM, "釣魚竿") ;fishing rod, from Korean version
	SIF !ITEM:釣魚竿
		RETURN
	LOCAL:1 = LINECOUNT
	DO
		SIF LINECOUNT - LOCAL:1 > 0
			CLEARLINE LINECOUNT - LOCAL:1
		
		nItemMod = GETBIT(nFishingRodMods, FishingRod_Vibration) && GETBIT(nFishingRodMods, FishingRod_Multihook) && GETBIT(nFishingRodMods, FishingRod_Sonar) && GETBIT(nFishingRodMods, FishingRod_Harness)
		;set initial sum
		nCostSum = nFishingRodModsCost:0 + nFishingRodModsCost:1 + nFishingRodModsCost:2 + nFishingRodModsCost:3
		;see if other upgrades purchased
		nCostSum -= GETBIT(nFishingRodMods, FishingRod_Vibration) * nFishingRodModsCost:0
		nCostSum -= GETBIT(nFishingRodMods, FishingRod_Multihook) * nFishingRodModsCost:1
		nCostSum -= GETBIT(nFishingRodMods, FishingRod_Sonar) * nFishingRodModsCost:2
		nCostSum -= GETBIT(nFishingRodMods, FishingRod_Harness) * nFishingRodModsCost:3
		DRAWLINE
		CALL SPTALK, [[にとり]], "笑顔", 0, @"「你想怎么改造它？」", 1
		PRINTD 当前状态：
		CALL Add_ItemModList_釣魚竿
		PRINTL
		DRAWLINE
		IF !GETBIT (nFishingRodMods, FishingRod_Vibration)
			PRINTFORML [  1] - 震动组件 %金額表示(nFishingRodModsCost:0)%：自动引导路亚的拟态晃动，增加捕获几率
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 震动组件：略微提高钓鱼效率
			RESETCOLOR
		ENDIF
		IF !GETBIT (nFishingRodMods, FishingRod_Multihook)
			PRINTFORML [  2] - 多钩钓组 %金額表示(nFishingRodModsCost:1)%：通过增加鱼钩数量来提高钓鱼几率
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 多钩钓组：适度提高钓鱼效率
			RESETCOLOR
		ENDIF
		IF !GETBIT (nFishingRodMods, FishingRod_Sonar)
			PRINTFORML [  3] - 声纳组件 %金額表示(nFishingRodModsCost:2)%：探测远方鱼类的声音，并自动移动鱼竿捕获
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 声纳组件：显著提高钓鱼效率
			RESETCOLOR
		ENDIF
		IF CFLAG:[[わかさぎ姫]]:2 >= 3000 ;3000 favor check for wakasagihime
			IF !GETBIT (nFishingRodMods, FishingRod_Harness)
				PRINTFORML [  4] - 美人鱼钓组 %金額表示(nFishingRodModsCost:3)%：由若鹭姬提供的材料定制而成的爆护线组
			ELSE
				SETCOLOR C_GRAY
				PRINTL [ X ] - 美人鱼钓组：大幅提高钓鱼效率
				RESETCOLOR
			ENDIF
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - ？？？？？：或许如果你能获得某位人鱼的好感，那么……
			RESETCOLOR
		ENDIF
		IF nItemMod == 0
			PRINTFORML [  5] - 全部安装（总计%金額表示(nCostSum)%）
		ELSE
			PRINTL 　　　　无法再进行改造了。
		ENDIF
		PRINTL [999]算了
		INPUT
		SELECTCASE RESULT
		CASE 999
			RETURN
		CASE 1
			IF !GETBIT (nFishingRodMods, FishingRod_Vibration) && MONEY >= nFishingRodModsCost:0
				PRINTL 已安装[震动组件]！
				SETBIT nFishingRodMods, 0
				TIME += 5
				CALL PAY_MONEY_YEN(nFishingRodModsCost:0, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 2
			IF !GETBIT (nFishingRodMods, FishingRod_Multihook) && MONEY >= nFishingRodModsCost:1
				PRINTL 已添加[多钩钓组]！
				SETBIT nFishingRodMods, 1
				TIME += 10
				CALL PAY_MONEY_YEN(nFishingRodModsCost:1, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 3
			IF !GETBIT (nFishingRodMods, FishingRod_Sonar) && MONEY >= nFishingRodModsCost:2
				PRINTL 已安装[声纳组件]！
				SETBIT nFishingRodMods, 2
				TIME += 15
				CALL PAY_MONEY_YEN(nFishingRodModsCost:2, 2)
			ELSE
				CONTINUE
			ENDIF
		CASE 4
			IF CFLAG:[[わかさぎ姫]]:2 >= 3000 ;favor check
				IF !GETBIT (nFishingRodMods, FishingRod_Harness) && MONEY >= nFishingRodModsCost:3
					CALL KOJO_MESSAGE_SEND("EVENT", 0, 93, 0, 0, "FISHINGHARNESS_BUY") ;custom code waggy
					PRINTL 已配备定制[美人鱼钓组]！
					SETBIT nFishingRodMods, 3
					TIME += 20
					CALL PAY_MONEY_YEN(nFishingRodModsCost:3, 2)
				ELSE
					CONTINUE
				ENDIF
			ENDIF
		CASE 5
			IF nItemMod == 0
				IF !GETBIT (nFishingRodMods, FishingRod_Vibration) && MONEY >= nFishingRodModsCost:0
					PRINTL 已安装[震动组件]！
					SETBIT nFishingRodMods, 0
					TIME += 5
					CALL PAY_MONEY_YEN(nFishingRodModsCost:0, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT (nFishingRodMods, FishingRod_Multihook) && MONEY >= nFishingRodModsCost:1
					PRINTL 已添加[多钩钓组]！
					SETBIT nFishingRodMods, 1
					TIME += 10
					CALL PAY_MONEY_YEN(nFishingRodModsCost:1, 2)
					PRINTL
				ENDIF
				
				IF !GETBIT (nFishingRodMods, FishingRod_Sonar) && MONEY >= nFishingRodModsCost:2
					PRINTL 已安装[声纳组件]！
					SETBIT nFishingRodMods, 2
					TIME += 15
					CALL PAY_MONEY_YEN(nFishingRodModsCost:2, 2)
					PRINTL
				ENDIF
				
				IF CFLAG:[[わかさぎ姫]]:2 >= 3000 ;favor check
					IF !GETBIT (nFishingRodMods, FishingRod_Harness) && MONEY >= nFishingRodModsCost:3
						CALL KOJO_MESSAGE_SEND("EVENT", 0, 93, 0, 0, "FISHINGHARNESS_BUY") ;custom code waggy
						PRINTL 已配备定制[美人鱼钓组]！
						SETBIT nFishingRodMods, 3
						TIME += 20
						CALL PAY_MONEY_YEN(nFishingRodModsCost:3, 2)
						PRINTL
					ENDIF
				ENDIF
			ENDIF
		ENDSELECT
	LOOP 1
CASE GETNUM(ITEM, "飛機杯") ;fishing rod, from Korean version
	SIF !ITEM:オナホール
		RETURN
	LOCAL:1 = LINECOUNT
	DO
		LOCAL = 0
		SIF LINECOUNT - LOCAL:1 > 0
			CLEARLINE LINECOUNT - LOCAL:1
		
		DRAWLINE
		IF GETBIT (J飞机杯Mods, 2)
			CALL SPTALK, [[にとり]], "笑顔", 0, @"「你想怎么改造它？」/「咦…？这是我做的吗…？呜哇～…即便喝醉了也…」/「嗯～，但是这已经没法再改造了呢……」", 1
			PRINTL 
			PRINTL 看来即使是荷取自己，对她亲手魔改的飞机杯感到震惊……
		ELSEIF !(ABL:51:親密 > 5)
			CALL SPTALK, [[にとり]], "憤怒", 0, @"「你想改……」/「咦…咦？那…那种东西，我怎么可能改造呢！」", 1
			PRINTL ……如果关系更亲密些，荷取会答应吗？
		ELSEIF BASE:51:酒気 < (MAXBASE:51:酒気 / 10) * 4
			CALL SPTALK, [[にとり]], "発情", 0, @"「你想改……」/「咦…咦？那…那种东西，我怎么可能改造呢！」", 1
			PRINTL ……如果让她喝点酒的话，她会趁着酒劲答应吗？
		ELSEIF !TCVAR:51:泥酔 && BASE:51:酒気 > (MAXBASE:51:酒気 / 10) * 4 && ABL:51:親密 > 5
			CALL SPTALK, [[にとり]], "笑顔", 0, @"「咿嘻嘻@HPH@…嗝～」/「看起来很有趣呢，让我来改造它吧@HPH@」", 1
			PRINTL 竟然成了！她好像还会免费帮忙改造呢！
			LOCAL = 1
		ENDIF
		PRINTD 当前状态：
		CALL Add_ItemModList_飛機杯
		PRINTL
		DRAWLINE
		IF !GETBIT (J飞机杯Mods, 0)
			PRINTFORML [  1] - 腔室再优化 %金額表示(9999)%：以仿生材料改造内部结构，自慰时可以射爆
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 腔室再优化：提高飞机杯快感
			RESETCOLOR
		ENDIF
		IF !GETBIT (J飞机杯Mods, 0)
			SETCOLOR C_GRAY
			PRINTFORML [ X ] - 增设储精槽 %金額表示(29999)%：可以储存自慰后的精液……但用途不明
			RESETCOLOR
		ELSEIF !GETBIT (J飞机杯Mods, 1)
			PRINTFORML [  2] - 增设储精槽 %金額表示(29999)%：可以储存自慰后的精液……但用途不明
		ELSE
			SETCOLOR C_GRAY
			PRINTL [ X ] - 储精槽：可以储存自慰后的精液……但用途不明
			RESETCOLOR
		ENDIF
		IF !GETBIT (J飞机杯Mods, 1)
			SETCOLOR C_GRAY
			PRINTFORML [ X ] - 魔法飞机杯 %金額表示(9999999)%：飞机杯会与脑电波进行链接，幻化成活生生的小穴，自慰时可以大射爆
			RESETCOLOR
		ELSEIF !GETBIT (J飞机杯Mods, 2)
			PRINTFORML [  3] - 魔法飞机杯 %金額表示(9999999)%：飞机杯会与脑电波进行链接，幻化成活生生的小穴，自慰时可以大射爆
		ELSEIF !GETBIT (J飞机杯Mods, 3)
			SETCOLOR C_GRAY
			PRINTL [ X ] - 魔法飞机杯：可以幻化成意淫对象活生生的小穴，河童科技出品的大射爆道具
			RESETCOLOR
		ELSE
			SETCOLOR C_H_PINK
			PRINTL [ X ] - 奇迹飞机杯：与意淫对象建立奇迹链接，虽然没有真的做爱，但是和真的做爱快感相同。
			RESETCOLOR
		ENDIF
		SIF GETBIT (J飞机杯Mods, 2)
			PRINTL 　　　　无法再进行改造了。
		PRINTL [999]算了
		IF LOCAL
			INPUT
		ELSE
			PRINTL 999
			RESULT = 999
			WAIT
		ENDIF
		SELECTCASE RESULT
			CASE 999
				IF LOCAL
					CALL SPTALK, [[にとり]], "発情", 0, @"「是吗？嗝…不用客气的啊……」", 1
					WAIT
				ENDIF
				RETURN
			CASE 1
				CALL SPTALK, [[にとり]], "発情", 0, @"「呼～，搞定咯」", 1
				PRINTW 在改造的过程中，荷取的醉意醒了……
				BASE:51:酒気 = 0
				SETBIT J飞机杯Mods, 0
				TIME += 5
			CASE 2
				IF GETBIT (J飞机杯Mods, 0)
					CALL SPTALK, [[にとり]], "発情", 0, @"「呼～，搞定咯」", 1
					PRINTW 在改造的过程中，荷取的醉意醒了……
					BASE:51:酒気 = 0
					SETBIT J飞机杯Mods, 1
					TIME += 5
				ENDIF
			CASE 3
				IF GETBIT (J飞机杯Mods, 1)
					CALL SPTALK, [[にとり]], "発情", 0, @"「呼～，搞定咯」/「妮嘻嘻@HPH@就算是我也不能再改造了呢」/「盟-盟友啊，好好感激天下第一的河童科技吧」", 1
					PRINTW 在改造的过程中，荷取的醉意醒了……
					BASE:51:酒気 = 0
					SETBIT J飞机杯Mods, 2
					TIME += 5
				ENDIF
		ENDSELECT
	LOOP 1
ENDSELECT

;show modded items for item list
@Add_ShowItemMods
FOR LOCAL, 0, 1000
	CALL ITEMDATA(LOCAL, "TYPE:改造可能")
	IF RESULT && ITEM:LOCAL
		PRINTFORML [{LOCAL, 3}]%ITEMNAME_TR(LOCAL)%: 
		TRYCALLFORM Add_ItemModList_%ITEMNAME:LOCAL%
		PRINTFORML
	ENDIF
NEXT

@Add_ItemModList_簡易泳池
SIF GETBIT (FLAG:泳池, 0)
	PRINT [自走马达]
SIF GETBIT (FLAG:泳池, 1)
	PRINT [温水机能]
SIF GETBIT (FLAG:泳池, 2)
	PRINT [喷淋装置]
SIF GETBIT (FLAG:泳池, 3)
	PRINT [不思议的泡]
PRINTL

@Add_ItemModList_保温壺
SIF GETBIT(nThermalJarMods, ThermalJar_FreshDisplay)
	PRINT [食物新鲜度显示] 
SIF GETBIT(nThermalJarMods, ThermalJar_FreshUpgrade)
	PRINT [新鲜度升级Mk1] 
SIF GETBIT(nThermalJarMods, ThermalJar_MoreFreshUpgrade)
	PRINT [新鲜度升级Mk2] 
SIF GETBIT(nThermalJarMods, ThermalJar_StealProtectionUpgrade)
	PRINT [密码锁] 
	
@Add_ItemModList_折畳傘
SIF GETBIT(nUmbrellaMods, Umbrella_MoreHealth)
	PRINT [耐久度升级Mk1] 
SIF GETBIT(nUmbrellaMods, Umbrella_EvenMoreHealth)
	PRINT [耐久度升级Mk2] 
SIF GETBIT(nUmbrellaMods, Umbrella_Resistance)
	PRINT [避雷针] 
SIF GETBIT(nUmbrellaMods, Umbrella_Regen)
	PRINT [再生] 
SIF GETBIT(nUmbrellaMods, Umbrella_HPDisplay)
	PRINT [耐久度显示] 
SIF GETBIT(nUmbrellaMods, Umbrella_Reconstruction)
	PRINT [重构] 
	
@Add_ItemModList_電鋸
SIF GETBIT(nChainSawMods, ChainSaw_MiniFanDispenser)
	PRINT [迷你风扇和饮水机] 
SIF GETBIT(nChainSawMods, ChainSaw_DualSaw)
	PRINT [双锯片] 
SIF GETBIT(nChainSawMods, ChainSaw_KickBack)
	PRINT [后座力减震器] 
SIF GETBIT(nChainSawMods, ChainSaw_TreeSeeker)
	PRINT [寻树器] 
SIF GETBIT(nChainSawMods, ChainSaw_Flashlight)
	PRINT [手电筒] 

@Add_ItemModList_釣魚竿
SIF GETBIT(nFishingRodMods, FishingRod_Vibration)
	PRINT [震动组件]
SIF GETBIT(nFishingRodMods, FishingRod_Multihook)
	PRINT [多钩钓组]
SIF GETBIT(nFishingRodMods, FishingRod_Sonar)
	PRINT [声呐组件]
SIF GETBIT(nFishingRodMods, FishingRod_Harness)
	PRINT [美人鱼钓组]

@Add_ItemModList_飛機杯
SIF GETBIT(J飞机杯Mods, 0)
	PRINT [腔室再优化]
SIF GETBIT(J飞机杯Mods, 1)
	PRINT [增设储精槽]
IF GETBIT(J飞机杯Mods, 2)
	PRINT [魔法飞机杯]
ELSEIF GETBIT(J飞机杯Mods, 3)
	PRINT [奇迹飞机杯]
ENDIF

@Add_ThermalJarCodePad
IF RAND:100 > ABL:教養*10
	PRINTFORML %CALLNAME:TARGET%在手中翻来覆去地摆弄着保温壶，试图绕过密码锁，但无论怎么努力都没用。
	PRINTFORMW 沮丧地发出一声抱怨，然后气鼓鼓地离开了……
	CALL KOJO_MESSAGE_SEND("EVENT",14,TARGET,9,0) ;addition custom code
	RETURN 1
ELSE
	PRINTFORML 尽管+++对自己的密码锁很有信心，但%CALLNAME:TARGET%却毫不费力地绕过了它！
	PRINTFORMW 这怎么可能？！
	CALL KOJO_MESSAGE_SEND("EVENT",14,TARGET,8,0) ;addition custom code
ENDIF

@Add_UmbrellaMaxHealth ;return max health
#FUNCTION
LOCAL = 10000
IF GETBIT(nUmbrellaMods, Umbrella_EvenMoreHealth)
	LOCAL = 60000
ELSEIF GETBIT(nUmbrellaMods, Umbrella_MoreHealth)
	LOCAL = 30000
ENDIF
RETURNF LOCAL

@EVENTTRAIN ;reset umbrella broke status at the start of the day
Umbrella_Broke = 0
