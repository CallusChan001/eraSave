;V插入并指交两人
@ADD_CUSTOM_SCOM8
CALL ADD_CUSTOM_SCOM_MODULE8
CALL ADD_SEX_MODULE_EXECUTE

RETURN 1

@ADD_CUSTOM_SCOM_ABLE8
CALL ADD_CUSTOM_SCOM_MODULE8
CALL ADD_SEX_MODULE_COM_ABLE
SIF !RESULT
	RETURN 0
	
;need to be skilled in both aspects
SIF ABL:MASTER:指 < 5
	RETURN 0
SIF ABL:MASTER:腰 < 4
	RETURN 0

RETURN 1

@ADD_CUSTOM_CAN_SCOM8(ARG)
SKIPDISP ARG
LOCAL = ADD_LAST_V_POSE()
IF LOCAL
	PRINTFORML %ADD_SEX_MODULE_POSE(LOCAL)%并指交两人
ELSE
	PRINTFORML V插入并指交两人
ENDIF
SKIPDISP 0

CALL ADD_CUSTOM_SCOM_MODULE8
CALL ADD_SEX_MODULE_CAN_COM(ARG)
RETURN RESULT

@ADD_CUSTOM_MESSAGE_SCOM8
#DIM DYNAMIC V_INDEX = -1
#DIM DYNAMIC FINGERING_INDEX1 = -1
#DIM DYNAMIC FINGERING_INDEX2 = -1

FOR LOCAL, 0, ADD_SEX_MODULE_ACTION_COUNT
	IF ADD_SEX_MODULE_IS_ACTION(LOCAL, SET_YUBI, SET_V)
		IF FINGERING_INDEX1 == -1
			FINGERING_INDEX1 = LOCAL
		ELSE
			FINGERING_INDEX2 = LOCAL
		ENDIF
	ELSEIF ADD_SEX_MODULE_IS_ACTION(LOCAL, SET_P, SET_V)
		V_INDEX = LOCAL
	ENDIF
NEXT

IF FINGERING_INDEX1 < 0 || FINGERING_INDEX2 < 0 || V_INDEX < 0
	PRINTFORMDL ERROR: Targets not valid for @ADD_CUSTOM_MESSAGE_SCOM8
	RETURN
ENDIF

PRINTFORMD %CALLNAME:MASTER%一边同时爱抚着%CALLNAME:(ADD_SEX_MODULE_CHARA:FINGERING_INDEX1)%和%CALLNAME:(ADD_SEX_MODULE_CHARA:FINGERING_INDEX2)%的小穴，一边
SELECTCASE ADD_SEX_MODULE_POSE:V_INDEX
	CASE 1, 2
		PRINTFORMD 抽插着%CALLNAME:(ADD_SEX_MODULE_CHARA:V_INDEX)%。
	CASE 3, 4, 5
		PRINTFORMD 挺腰顶弄着%CALLNAME:(ADD_SEX_MODULE_CHARA:V_INDEX)%。
ENDSELECT
PRINTFORMDL

@ASSISTANT_KOJO_CUSTOM_SCOM8
FOR LOCAL, 0, ADD_SEX_MODULE_ACTION_COUNT
	SIF ADD_SEX_MODULE_CHARA:LOCAL == TARGET
		CONTINUE
	CALL KOJO_MESSAGE_SEND("COMMAND_ASSISTANT",-1,ADD_SEX_MODULE_CHARA:LOCAL,-1,-1)
NEXT

@ADD_CUSTOM_SCOM_SET8
#DIM DYNAMIC P0
#DIM DYNAMIC F0
#DIM DYNAMIC F1

SIF !IS_COM_SEX("v") && SELECTCOM != 3
	RETURN 0

P0 = ADD_MASTER_POSE_TR(PLAYER, SET_V,SET_P)
F0 = ADD_MASTER_POSE_TR(PLAYER, SET_V,SET_YUBI)

SIF P0 <= 0 && F1 <= 0 ;nothing valid in the current turn
	RETURN 0

IF !P0
	FOR LOCAL, 1, 3
		P0 = ADD_MASTER_POSE_TR(PLAYER, SET_V,SET_P,LOCAL)
		SIF P0
			BREAK
	NEXT
ENDIF

FOR LOCAL, 1, 3
	LOCAL:1 = ADD_MASTER_POSE_TR(PLAYER, SET_V,SET_YUBI,LOCAL)

	SIF !LOCAL:1
		CONTINUE
	IF !F0
		F0 = LOCAL:1
	ELSEIF !F1 && LOCAL:1 != F0
		F1 = LOCAL:1
		BREAK
	ENDIF
NEXT

SIF !P0 || !F0 || !F1
	RETURN 0

SIF P0 == F0 || P0 == F1 || F0 == F1
	RETURN 0

IF (F0 == TARGET || F1 == TARGET) && SELECTCOM != 3
	RETURN 0
ELSEIF P0 == TARGET && !IS_COM_SEX("v")
	RETURN 0
ENDIF

ADD_SEX_MODULE_ACTOR:0 = PLAYER
ADD_SEX_MODULE_CHARA:0 = F0
ADD_SEX_MODULE_CHARA:1 = F1
ADD_SEX_MODULE_CHARA:2 = P0
ADD_SEX_MODULE_POSE:2 = ADD_TOUCH_CURRENT_POSE(PLAYER, P0)

RETURN 1

@ADD_CUSTOM_SCOM_MODULE8
CALL ADD_SEX_MODULE_START(8)
CALL ADD_SEX_MODULE_ADD_ACTION(SET_YUBI, SET_V,, 0)
CALL ADD_SEX_MODULE_ADD_ACTION(SET_YUBI, SET_V,, 1)
CALL ADD_SEX_MODULE_ADD_ACTION(SET_P, SET_V,, 2)
CALL ADD_SEX_MODULE_FINISH
