;FileName_USERCOM.ERB ------------------------------ Rev1.00
;指令表示処理
;CALL		SYSTEM
;ARG		VOID
;RETURN		VOID
;COMMENT	
;-----------------------------------------------------------
@SHOW_USERCOM
#DIM DYNAMIC printKojoCom
#DIM HIGHLIGHT_SCOM ;qol custom code
#DIMS DYNAMIC CustomComList
#DIMS DYNAMIC CustomComs, 1000
VARSET CustomComList

TFLAG:100 = !TFLAG:101
VARSET LOCAL
;前ターンのMASTERが射精した相手をLOCAL:1へセット
IF TCVAR:MASTER:112 == 1
	;V
	LOCAL:1 = MASTER_POSE(SET_V,SET_P,1)
ELSEIF TCVAR:MASTER:112 == 2
	;A
	LOCAL:1 = MASTER_POSE(SET_A,SET_P,1)
ENDIF

;---------------------------------------
;魔改内容：增加对象剩余工作量查看
;---------------------------------------

IF BASE:TARGET:工作量 && WORKING(TARGET) && (TARGET != 0)
	SETCOLOR 0xFFA488
	PRINTFORML %CALLNAME:TARGET%还剩下大概{BASE:TARGET:工作量}的工作量
	RESETCOLOR
ENDIF
CALL LOOK_AT
PRINTL

CALL 过滤器表示
;预处理自定义指令
;FOR LOCAL,0,ADD_CUSTOM_MAX_COM + 1
;	SIF STRCOUNT(SAVESTR:0,@"{ADD_CUSTOM_COM}") ;custom commands disabled
;		BREAK
;	SIF !ADD_CUSTOM_COM_SWITCH
;		BREAK
;	RESULT = 0
;	TRYCALLFORM ADD_CUSTOM_COM_ABLE{LOCAL}
;	IF RESULT
;		SIF !Quickfilter_Custom(LOCAL+9000)
;			CONTINUE
;		CustomComList += @"{LOCAL+9000}/"
;	ENDIF
;NEXT

;指令表示
FOR LOCAL,0,800
	;SIF QOL_BLOCKED_COM_HIDDEN_SEX(LOCAL) ;qol custom code
	;	CONTINUE
	;qol custom code
	IF TARGET
		CALL KOJO_CHECK(TARGET, "COM_BLOCKED",,LOCAL)
		SIF RESULT
			CONTINUE
	ENDIF
	SIF LOCAL == 355 && (!FLAG:70 || CFLAG:TARGET:344 == 1)
		CONTINUE
	SIF LOCAL == 200 && TFLAG:102 == 2
		PRINTL
	SIF LOCAL == 300 && printKojoCom
		PRINTL
	SIF LOCAL == 350 && TFLAG:102 != 2
		PRINTL
	SIF LOCAL == 400 && TFLAG:102 != 2
		PRINTL
	SIF GLOBAL_COMABLE2(LOCAL)
		CONTINUE
	SIF GROUPMATCH(LOCAL,400,405,604)
		CONTINUE
	SIF TRAINNAME:LOCAL == "" && !IS_COM_KOJO(LOCAL)
		CONTINUE
	SIF LOCAL == ADD_CUSTOM_COM ;addition custom code, don't display general custom com command, handled elsewhere
		CONTINUE
	RESULT = 0
	;現状で対象指令が使用可能かどうか判定
	TRYCALLFORM COM_ABLE{LOCAL}
	IF RESULT
		SIF !QUICKFILTER(LOCAL)
			CONTINUE
		;qol custom code
		RESULT = 0
		CALL QOL_SCOM_CHECK(LOCAL)
		HIGHLIGHT_SCOM = RESULT
		
		IF HIGHLIGHT_SCOM > 0
			SETCOLOR C_HEARTPINK
			IF HIGHLIGHT_SCOM == 13
				LOCAL:10 = ADD_TOUCH_CURRENT_POSE(PLAYER, ADD_MASTER_POSE_TR(PLAYER, SET_V, SET_P))
				IF (LOCAL == 60 && LOCAL:10 == 2) || (LOCAL == 61 && LOCAL:10 == 1)
					PRINTFORMC 双人叠塔[{LOCAL,3}]
				ELSE
					PRINTFORMC %RESULTS%[{LOCAL,3}]
				ENDIF
			ELSE
				PRINTFORMC %RESULTS%[{LOCAL,3}]
			ENDIF
			RESETCOLOR
		ELSEIF (LOCAL == 42 && TEQUIP:11) || (LOCAL == 43 && TEQUIP:12) || (LOCAL == 44 && TEQUIP:13) || (LOCAL == 45 && TEQUIP:14) || (LOCAL == 46 && TEQUIP:15) || (LOCAL == 47 && TEQUIP:16) || (LOCAL == 48 && TEQUIP:17)
			PRINTFORMC 解除%TRAINNAME_TR(LOCAL)%[{LOCAL,3}]
		ELSEIF LOCAL == 15
			IF CFLAG:MASTER:恶作剧
				PRINTFORMC 爱抚私处[{LOCAL,3}]
			ELSE
				PRINTFORMC 阴蒂爱抚[{LOCAL,3}]
			ENDIF
		ELSEIF LOCAL == 19 && TEQUIP:継続キス
			PRINTFORMC 结束接吻[{LOCAL,3}]
		ELSEIF LOCAL == 50 && (TEQUIP:PLAYER:避孕套 || TEQUIP:避孕套)
			PRINTFORMC 摘掉避孕套[{LOCAL,3}]
		ELSEIF LOCAL == 302 && PREVCOM == 305
			PRINTFORMC 掏耳朵[{LOCAL,3}]
		ELSEIF LOCAL == 311 && CFLAG:MASTER:添い寝中
			PRINTFORMC 相拥入眠[{LOCAL,3}]
		ELSEIF LOCAL == 81 && LOCAL:1
			PRINTFORMC 清扫口交[{LOCAL,3}]
		ELSEIF LOCAL == 82 && (TALENT:105 == -2 || TALENT:105 == -1)
			PRINTFORMC 乳交[{LOCAL,3}]
		ELSEIF LOCAL == 60 && IS_STANDING_SEX(SELECTCOM) ;addition custom code
			PRINTFORMC 对面立位[{LOCAL,3}]
		ELSEIF LOCAL == 61 && IS_STANDING_SEX(SELECTCOM) ;addition custom code
			PRINTFORMC 背面立位[{LOCAL,3}]
		ELSEIF LOCAL == 62 && IS_STANDING_SEX(SELECTCOM) ;addition custom code
			PRINTFORMC 对面立位肛交[{LOCAL,3}]
		ELSEIF LOCAL == 63 && IS_STANDING_SEX(SELECTCOM) ;addition custom code
			PRINTFORMC 背面立位肛交[{LOCAL,3}]
		ELSEIF LOCAL == 67 && IS_STANDING_SEX(LOCAL)
			PRINTFORMC 火车便当式[{LOCAL,3}]
		ELSEIF LOCAL == 68 && IS_STANDING_SEX(LOCAL)
			PRINTFORMC 抱起后入[{LOCAL,3}]
		ELSEIF LOCAL == 69 && IS_STANDING_SEX(LOCAL)
			PRINTFORMC 火车便当肛交[{LOCAL,3}]
		ELSEIF LOCAL == 70 && IS_STANDING_SEX(LOCAL)
			PRINTFORMC 抱起后入肛交[{LOCAL,3}]
		ELSEIF LOCAL == 73 && TCVAR:PLAYER:要去了
			IF TEQUIP:TARGET:体位 == 1 && (BEDROOM(CFLAG:PLAYER:現在位置) || (BATHROOM() && ITEM:20))
				IF CFLAG:TARGET:生理周期 == 7
					PRINTFORMC 菊一文字[{LOCAL,3}]
				ELSE
					PRINTFORMC 松叶立[{LOCAL,3}]
				ENDIF
			ELSEIF TEQUIP:TARGET:体位 == 2
				IF CFLAG:TARGET:生理周期 == 7
					PRINTFORMC 燕返[{LOCAL,3}]
				ELSE
					PRINTFORMC 望月式[{LOCAL,3}]
				ENDIF
			ELSEIF TEQUIP:TARGET:体位 == 3
				IF CFLAG:TARGET:生理周期 == 7
					PRINTFORMC 撞木反[{LOCAL,3}]
				ELSE
					PRINTFORMC 时雨茶臼[{LOCAL,3}]
				ENDIF
			ELSEIF TEQUIP:TARGET:体位 == 4
				IF CFLAG:TARGET:生理周期 == 7
					PRINTFORMC 百闭[{LOCAL,3}]
				ELSE
					PRINTFORMC 抱地藏[{LOCAL,3}]
				ENDIF
			ELSEIF TEQUIP:TARGET:体位 == 5
				IF CFLAG:TARGET:生理周期 == 7
					PRINTFORMC 鸣门[{LOCAL,3}]
				ELSE
					PRINTFORMC 牡丹乱[{LOCAL,3}]
				ENDIF
			ELSE
				PRINTFORMC %TRAINNAME_TR(LOCAL)%[{LOCAL,3}]
			ENDIF
		ELSEIF LOCAL == 92 && IS_STANDING_SEX(SELECTCOM) ;addition custom code
			PRINTFORMC 被Ａ对面立位[{LOCAL,3}]
		ELSEIF LOCAL == 93 && IS_STANDING_SEX(SELECTCOM) ;addition custom code
			PRINTFORMC 被Ａ背面立位[{LOCAL,3}]
		ELSEIF LOCAL == 100 && TALENT:TARGET:幼稚
			PRINTFORMC 打屁股[{LOCAL,3}]
		ELSEIF LOCAL == 130 && IS_STANDING_SEX(SELECTCOM) ;addition custom code
			PRINTFORMC 被对面立位[{LOCAL,3}]
		ELSEIF LOCAL == 131 && IS_STANDING_SEX(SELECTCOM) ;addition custom code
			PRINTFORMC 被背面立位[{LOCAL,3}]
		ELSEIF LOCAL == 186 && TEQUIP:羞恥プレイ ;qol custom code
			PRINTFORMC 结束羞耻PLAY[{LOCAL,3}]
		ELSEIF LOCAL == 300 && TCVAR:TARGET:302 && ABL:MASTER:教養 >= 3 && ABL:MASTER:話術技能 >= 4
			SETCOLOR C_GRAY
			PRINTFORMC 会话[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 301 && CFLAG:TARGET:行動 == 5
			PRINTFORMC 敬茶[{LOCAL,3}]
		ELSEIF LOCAL == 301 && GETBIT(TCVAR:MASTER:特別的茶水, 0)
			PRINTFORMC 泡红茶[{LOCAL,3}]
		ELSEIF LOCAL == 334 && CFLAG:TARGET:350 == 49 && (TALENT:TARGET:酒耐性 == -2 || CFLAG:TARGET:妊娠自覚状態 == 1)
			PRINTFORMC 请吃料理[{LOCAL,3}]
		ELSEIF LOCAL == 304 && CFLAG:TARGET:350 == 46
			PRINTFORMC 参加游戏[{LOCAL,3}]
		ELSEIF LOCAL == 315
			IF GETBIT(TALENT:TARGET:性別,1)
				PRINTFORMC 竿爱抚[{LOCAL,3}]
			ELSEIF CFLAG:MASTER:恶作剧
				PRINTFORMC 爱抚私处[{LOCAL,3}]
			ELSE
				PRINTFORMC 阴蒂爱抚[{LOCAL,3}]
			ENDIF
		ELSEIF LOCAL == 350
			IF FLAG:70 == 1 && CFLAG:TARGET:344 == 0
				LOCALS = 猥亵
			ELSEIF FLAG:70 == 1 && CFLAG:TARGET:344 == 1
				LOCALS = 时停爱爱
			ELSEIF (CFLAG:現在位置 == 情人用宿屋 || CFLAG:現在位置 == 情人旅館) && !CFLAG:诶嘿嘿
				LOCALS = 抱到身边
			ELSEIF CFLAG:現在位置 == GET_MAP_REPLACEMENT(P222寺子屋) && TARGET == [[麟]]
				CALL SET_KOJO_COLOR
				LOCALS = 大人的保健体育
			ELSEIF CFLAG:現在位置 == GET_MAP_REPLACEMENT(P222寺子屋)
				SETCOLOR C_PINK
				LOCALS = ★辅导
			ELSEIF (CFLAG:現在位置 == OMANEKIBEYA() || PRIVATEROOM:(CFLAG:現在位置 % 100) == TARGET) && GET_TARGETNUM() == 1 && TARGET == 43
				CALL SET_KOJO_COLOR
				LOCALS = 房中术的修行
			ELSEIF (GROUPMATCH(CFLAG:現在位置 ,OMANEKIBEYA(),GET_MAP_REPLACEMENT(717) ,GET_MAP_REPLACEMENT(719)) || PRIVATEROOM:(CFLAG:現在位置 % 100) == TARGET) && GET_TARGETNUM() == 1 && (TARGET == 78 || TARGET == 77)
				CALL SET_KOJO_COLOR
				LOCALS = 信仰❤注入
			ELSEIF CFLAG:現在位置 == GET_MAP_REPLACEMENT(P812本殿) && GET_TARGETNUM() == 1 && TARGET == 31
				CALL SET_KOJO_COLOR
				LOCALS = 巫女的子宝奉仕
			ELSEIF GROUPMATCH(CFLAG:現在位置 , GET_MAP_REPLACEMENT(P812本殿), GET_MAP_REPLACEMENT(P4本堂), GET_MAP_REPLACEMENT(P24温泉), GET_MAP_REPLACEMENT(P806瀑布背面)) && GET_TARGETNUM() == 1 && TALENT:TARGET:197 == 1
				CALL SET_KOJO_COLOR
				LOCALS = 祓魔仪式
			;室外
			ELSEIF !INROOM(CFLAG:PLAYER:現在位置)
				LOCALS = 抱到身边
			ELSE
				LOCALS = 推倒
			ENDIF
			IF GET_TARGETNUM() > 1
				IF FLAG:70 == 1 && CFLAG:TARGET:344 == 1
					SETCOLOR 0x5090FF
					LOCALS = 人前时停爱爱
				ELSEIF FLAG:99
					LOCALS = 夺回主动
				ELSEIF (!FLAG:70 || CFLAG:TARGET:344 == 1) && CFLAG:現在位置 == GET_MAP_REPLACEMENT(P222寺子屋)
					IF TARGET == [[麟]]
						CALL SET_KOJO_COLOR
						LOCALS = 大人的保健体育
					ELSE
						SETCOLOR C_PINK
						LOCALS = 多学科★辅导
					ENDIF
				ELSEIF GROUPMATCH(CFLAG:現在位置 , GET_MAP_REPLACEMENT(P812本殿), GET_MAP_REPLACEMENT(P4本堂), GET_MAP_REPLACEMENT(P24温泉), GET_MAP_REPLACEMENT(P806瀑布背面))
					LOCAL:3 = 0
					FOR LOCAL:2, 1, GET_TARGETNUM() + 1
						IF TALENT:(TARGET:(LOCAL:2)):197 != 1 || (FLAG:70 && CFLAG:(TARGET:(LOCAL:2)):344 == 0)
							LOCAL:3 = 1
							BREAK
						ENDIF
					NEXT
					IF LOCAL:3
						LOCALS = 一并%LOCALS%
					ELSE
						CALL SET_KOJO_COLOR
						LOCALS = 祓魔例大祭
					ENDIF
				ELSEIF (GROUPMATCH(CFLAG:現在位置 ,OMANEKIBEYA(),GET_MAP_REPLACEMENT(717) ,GET_MAP_REPLACEMENT(719)) || PRIVATEROOM:(CFLAG:現在位置 % 100) == TARGET) && GET_TARGETNUM() == 2 && ((TARGET:1 == 78 && TARGET:2 == 77) || (TARGET:2 == 78 && TARGET:1 == 77)) && (!FLAG:70 || (CFLAG:78:344 == 1 && CFLAG:77:344 == 1))
					CALL SET_KOJO_COLOR
					LOCALS = 秋姊妹信仰❤注入
				ELSE
					LOCALS = 一并%LOCALS%
				ENDIF
			ENDIF
			PRINTFORMC %LOCALS%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 351
			IF CFLAG:TARGET:同行
			ELSEIF COM_351_CONDITION(TARGET) == 1
				SETCOLOR 100, 100, 100
			ELSEIF CAN_IRAI_CHARA_GO_TOGATHER(TARGET)
				SETCOLOR C_GREEN
			ELSE
				SETCOLOR C_AQUA
			ENDIF
			PRINTFORMC %TRAINNAME_TR(LOCAL)%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 491
			IF DAY:3 != 14 || !CFLAG:TARGET:バレンタイン 
				SETCOLOR C_ROYAL_BLUE
			ELSE
				SELECTCASE CFLAG:TARGET:バレンタイン % 100
					CASE 1
						SETCOLOR C_AQUA
					CASE 2
						SETCOLOR C_GREEN
					CASE 3
						SETCOLOR C_YELLOW
					CASE 4
						SETCOLOR C_PINK
				ENDSELECT
			ENDIF
			PRINTFORMC %TRAINNAME_TR(LOCAL)%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 360 && BASE:MASTER:気力 <= 0
			PRINTFORMC 任凭摆布[{LOCAL,3}]
		;魔改功能，诱导逆推
		ELSEIF LOCAL == 366 && (GROUPMATCH(IRAI_CHARA_TO_PROGRESS(TARGET), "依頼達成", "依頼失敗") || (CFLAG:TARGET:依頼状況 == 0 && GETBIT(诱导逆推_进程:TARGET:0, 10) && 诱导逆推_目前不可进行(TARGET) && 诱导逆推_开关))
			SETCOLOR C_GREEN
			PRINTFORMC 报告委托[{LOCAL,3}]
			RESETCOLOR
		;魔改功能，诱导逆推
		ELSEIF LOCAL == 366 && (GROUPMATCH(IRAI_CHARA_TO_PROGRESS(TARGET), "依頼未受託") || (CFLAG:TARGET:依頼状況 == 0 && GETBIT(诱导逆推_进程:TARGET:0, 0) && 诱导逆推_开关))
			SETCOLOR C_GREEN
			PRINTFORMC 听取委托[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 367
			SETCOLOR C_GREEN
			PRINTFORMC %NAME_IRAI_ACT()%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 368
			;PRINTFORMC %陪同行動_名称(TARGET)%[{LOCAL,3}]
			PRINTFORMC %FreeAct_Name(TARGET)%[{LOCAL,3}]
		ELSEIF LOCAL == 337
			;qol custom code
			IF QOL_INTERACTABLE_CHILDREN() == 1
			PRINTFORMC %兒童ふれあい名称(nChildrenPresent:0)%[{LOCAL,3}]
			ELSE
				PRINTFORMC %TRAINNAME_TR(LOCAL)%[{LOCAL,3}]
			ENDIF
		ELSEIF LOCAL == 417 && TIME >= 660 && TIME <= 900
			PRINTFORMC 午睡[{LOCAL,3}]
		ELSEIF LOCAL == 417
			PRINTFORMC 假寐[{LOCAL,3}]
		ELSEIF LOCAL == 420
			SELECTCASE MAIN_MAP
				CASE 0
					LOCALS = 留琴
				CASE 3
					LOCALS = 妖精女仆
				CASE 9
					LOCALS = 僵尸妖精
			ENDSELECT
			PRINTFORMC 和%LOCALS%对话[{LOCAL,3}]
		ELSEIF LOCAL == 422 && CFLAG:MASTER:現在位置 == 103
			PRINTFORMC 聆听佛音[{LOCAL,3}]
		ELSEIF LOCAL == 431 && (CFLAG:MASTER:現在位置 == 24 || CFLAG:MASTER:現在位置 == 441)
			PRINTFORMC 在温泉里放松[{LOCAL,3}]
		ELSEIF LOCAL == 431 && (CFLAG:MASTER:現在位置 == 大衆浴場 || CFLAG:MASTER:現在位置 == 940)
			PRINTFORMC 入浴[{LOCAL,3}]
		ELSEIF LOCAL == 431 && OPENPLACE(CFLAG:MASTER:現在位置) && ITEM:簡易泳池 && !BATHCHECK(CFLAG:MASTER:現在位置)
			PRINTFORMC 泳池里放松[{LOCAL,3}]
		;ELSEIF LOCAL == 405 && CFLAG:TARGET:同行 && TARGET
		;	PRINTFORMC 約會[{LOCAL,3}]
		ELSEIF LOCAL == 410 && OUTROOF(CFLAG:MASTER:現在位置) && DAY:2 == 4
			PRINTFORMC 扫雪[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 300 && TIME <= 540 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 吃早餐[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 660 && TIME <= 900 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 吃午餐[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 1020 && TIME <= 1200 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 吃下午茶[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 1200 && TIME <= 1440 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 吃晩餐[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 0 && TIME <= 180 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 吃夜宵[{LOCAL,3}]
		ELSEIF LOCAL == 414 && CFLAG:TARGET:行動 == 5 && (!FLAG:70 || CFLAG:TARGET:344 == 1)
			PRINTFORMC 吃饭休憩[{LOCAL,3}]
		ELSEIF LOCAL == 443
			PRINTFORMC %NAME_UNIQUE_COM(TARGET)%[{LOCAL,3}]
		ELSEIF LOCAL == 448
			IF HUNTING_SPOT(CFLAG:MASTER:現在位置) && MUSHITORI_SPOT(CFLAG:MASTER:現在位置)
				IF GET_MUSHIDATA(MUSHI_TRAP, "場所") && GROUPMATCH(GET_MUSHIDATA(MUSHI_TRAP, "場所"), TRAP_POINT:1, TRAP_POINT:2, TRAP_POINT:3)
					PRINTFORMC 检查陷阱的状态[{LOCAL,3}]
				ELSE
					PRINTFORMC %TRAINNAME_TR(LOCAL)%[{LOCAL,3}]
				ENDIF
			ELSEIF GROUPMATCH(CFLAG:MASTER:現在位置, TRAP_POINT:1, TRAP_POINT:2, TRAP_POINT:3)
				PRINTFORMC 检查陷阱的状态[{LOCAL,3}]
			ELSEIF GROUPMATCH(CFLAG:MASTER:現在位置, GET_MUSHIDATA(MUSHI_TRAP, "場所"))
				PRINTFORMC 确认昆虫诱捕装置[{LOCAL,3}]
			ELSEIF MUSHITORI_SPOT(CFLAG:MASTER:現在位置)
				PRINTFORMC 昆虫诱捕[{LOCAL,3}]
			ELSE
				PRINTFORMC %TRAINNAME_TR(LOCAL)%[{LOCAL,3}]
			ENDIF
		ELSEIF LOCAL == 464
			LOCALS = %GET_PLACENAME(SPECIAL_AREAMOVE(),1)%
			IF SPECIAL_AREAMOVE_TIME() == 1
				SETCOLOR C_AQUA
				PRINTFORMC 传送至%LOCALS%[{LOCAL,3}]
				RESETCOLOR
			ELSE
				SETCOLOR C_GREEN
				PRINTFORMC 前往%LOCALS%[{LOCAL,3}]
				RESETCOLOR
			ENDIF
		ELSEIF LOCAL == 482
			PRINTFORMC 追踪%CALLNAME:STALKED%[{LOCAL,3}]
		ELSEIF LOCAL == 626
			SIF FLAG:市場の神 == 10
				SETCOLOR 100, 250, 140
			PRINTFORMC %GIFTSHOP_NAME(CFLAG:MASTER:约会中, 1)%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 603 && PREVCOM == 603
			PRINTFORMC 拉手[{LOCAL,3}]
		ELSEIF LOCAL == 698
			PRINTFORMC 去%OMANEKI_PLACE()%[{LOCAL,3}]
		ELSEIF LOCAL >= 270 && LOCAL < 300
			CALL KOJO_MESSAGE_SEND("COM", 0, TARGET, LOCAL - 270)
			PRINTFORMC %RESULTS%[{LOCAL,3}]
			printKojoCom = 1
		ELSEIF STRLENS(TRAINNAME:LOCAL)
			PRINTFORMC %TRAINNAME_TR(LOCAL)%[{LOCAL,3}]
		ENDIF
	ENDIF
NEXT
;addition custom code
SIF ADD_CUSTOM_COM_SWITCH
	CALL Add_Custom_List_COMS
CALL ADD_TOUCH_SET_OLD_FIELDS(1)
RESULT = 0
SIF SWEEPGOD
	PRINTC 一键扫除[778]
;;打印自定义指令
;SPLIT CustomComList, "/", CustomComs
;FOR LOCAL,0,1000
;	SIF !ADD_CUSTOM_COM_SWITCH
;		BREAK
;	SIF !STRLENS(CustomComs:LOCAL)
;		BREAK
;	LOCAL:1 = TOINT(CustomComs:LOCAL)
;	TRYCCALLFORM ADD_CUSTOM_COM_PRINT{LOCAL:1-9000}
;	CATCH
;		;CALL MAKE_HARMFUL_COMMAND_COLOR(TARGET,LOCAL:1)
;		PRINTFORMC %Add_Custom_COM_Name(LOCAL:1-9000)%[{LOCAL:1}]
;		RESETCOLOR
;	ENDCATCH
;NEXT
;自动实行中なら下记表示をスキップ
SIF !TFLAG:100
	GOTO SKIP
PRINTL
;CALL PRINTBUTTON_EX(TFLAG:USERCOM非表示 ? "▽[＋][Ex_COM]" # "▼[－][Ex_COM]", 3002, TFLAG:USERCOM非表;示)
;PRINTFORML %"=" * 100%
CALL PRINTBUTTON_EX(TFLAG:USERCOM非表示 ? "▽[＋] Ex_COM" # "▼[－] Ex_COM", 3002, TFLAG:USERCOM非表示)
PRINTPLAIN  == 
CALL PRINTBUTTON_EX("[CONFIG]",809)
PRINTPLAIN =
SELECTCASE FLAG:推倒
	CASE 0
		LOCALS = 逆推：不会拒绝
	CASE 1
		LOCALS = 逆推：会进行力量比较
	CASE 2
		LOCALS = 逆推：不会发生
	CASEELSE
		LOCALS = 逆推助手：参数错误
ENDSELECT
CALL PRINTBUTTON_EX(@"[%LOCALS%]", -9200, !FLAG:推倒)
PRINTPLAIN =
IF TARGET != MASTER
	SELECTCASE CFLAG:自動喘息
		CASE 0
			LOCALS = 自动喘息：关闭
		CASE 1
			LOCALS = 自动喘息：开启
		CASE 2
			LOCALS = 自动喘息：仅有拟声词
		CASEELSE
			LOCALS = 自动喘息：参数错误
	ENDSELECT
	CALL PRINTBUTTON_EX("[自动装备避孕套]",838,!CFLAG:自動ゴム)
	PRINTPLAIN =
	CALL PRINTBUTTON_EX(@"[%LOCALS%]",4000,!CFLAG:自動喘息)
	PRINTPLAIN =
	IF CFLAG:诶嘿嘿
		CALL PRINTBUTTON_EX("[站立式]",-9118,!CFLAG:STANDING_TOGGLE)
		PRINTPLAIN =
	ENDIF
ENDIF
;addition custom code, from KR version
IF CFLAG:MASTER:初期位置 == CFLAG:MASTER:現在位置 || (CFLAG:MASTER:現在位置 == CFLAG:TARGET:初期位置 && (IS_FALLEN(TARGET) || !SHIRAHU(TARGET)))
	IF !FLAG:自室施錠
		LOCALS = 锁门
	ELSE
		LOCALS = 解锁
	ENDIF
	CALL PRINTBUTTON_EX(@"[%LOCALS%]",991,!FLAG:自室施錠)
ENDIF
HTML_POPPRINTINGSTR
HTML_PRINT RESULTS + @"%"=" * MAX(MAXWIDTH() - HTML_STRINGLEN(RESULTS), 0)%"
SIF TFLAG:USERCOM非表示
	GOTO SKIP
;SIF !GETBIT (FLAG:USERCOM開关, 12)
;	PRINTC 履历表示[800]
IF GETBIT(FLAG:瞬間移動, 1) && !CFLAG:MASTER:同行
	SETCOLOR 0x5090FF
ELSE
	SETCOLOR C_GREEN
ENDIF
RESULT = 0
CALL COM_ABLE400
SIF RESULT
	PRINTC 移动[400]
RESULT = 0
RESETCOLOR
CALL COM_ABLE405
IF RESULT
	IF CFLAG:TARGET:同行 && TARGET
		PRINTC 约会[405]
	ELSE 
		PRINTC 外出[405]
	ENDIF
ENDIF
RESULT = 0

IF GETBIT(FLAG:瞬間移動, 0) && !FLAG:约会的对象
	SETCOLOR 0x5090FF
ELSE
	SETCOLOR C_GREEN
ENDIF
RESULT = 0
CALL COM_ABLE604
SIF RESULT
	PRINTC 散步[604]
RESETCOLOR
IF DEBUGGER
        SETCOLOR 241,158,194
        PRINTC 幻想乡之主[777]
        RESETCOLOR
ENDIF
SIF 摄影系统开关 && 射影机
	PRINTC 摄像[770]
SIF 摄影系统开关 && 射影机
	PRINTC 查看相册[771]

; --- 魔改内容 - 双重play
IF !FLAG:潜伏 && GET_TARGETNUM() > 1 && CFLAG:MASTER:诶嘿嘿 && Double_Play == 1
	SETCOLOR 0xEE60EE
	SIF PREVCOM == 81 || PREVCOM == 88
		PRINTC 双重口交[921]
	SIF PREVCOM == 82
		PRINTC 双重乳交[922]
	SIF PREVCOM == 83
		PRINTC 双重素股[923]
	SIF TEQUIP:TARGET:Ｖ性交 == 0
		PRINTC 交互插入[924]
	RESETCOLOR
ENDIF
SIF !GETBIT (FLAG:USERCOM開关, 0)
	PRINTC 污渍显示[801]
SIF !CFLAG:陪睡中 && GET_TARGETNUM() > 1 && !GETBIT (FLAG:USERCOM開关, 1)
	PRINTC 变更对象[802]
SIF !GETBIT (FLAG:USERCOM開关, 2)
	PRINTC 能力显示[803]
SIF !GETBIT (FLAG:USERCOM開关, 3)
	PRINTC 能力显示(主角)[804]
SIF !GETBIT (FLAG:USERCOM開关, 4)
	PRINTC 道具确认[805]
;SIF !GETBIT(FLAG:USERCOM開关, 11)
;	PRINTC 指令过滤器[809]
SIF FLAG:1005
	PRINTC CONFIG[810]
SIF TALENT:MASTER:居場所察知 && (GETBIT(TALENT:MASTER:居場所察知, 1) || !(CFLAG:诶嘿嘿 || CFLAG:恶作剧 || CFLAG:陪睡中));at_home check removed
	PRINTC 所在地察觉[811]
SIF TALENT:MASTER:汚部屋察知 && AT_HOME(MASTER) && !(CFLAG:诶嘿嘿 || CFLAG:恶作剧 || CFLAG:陪睡中)
	PRINTC 脏房间察觉[812]
SIF GETBIT(TALENT:MASTER:劣情察知, 1) && !CFLAG:诶嘿嘿 && !CFLAG:添い寝中 && !CFLAG:MASTER:イタズラ
	PRINTC 色欲探知[813]
IF FLAG:70 && CFLAG:TARGET:344 == 0 && !CFLAG:TARGET:睡眠 && AT_HOME(MASTER) == 1 && TARGET > 0 && !CFLAG:诶嘿嘿 && CFLAG:行動 != 5 ;disallow while they're working
	IF TFLAG:運搬 == 0 || TFLAG:運搬 != TARGET
		PRINTC 搬起[815]
	ELSE 
		PRINTC 放下[815]
	ENDIF
ENDIF
SIF FLAG:70 && TALENT:MASTER:集合 && AT_HOME(MASTER) == 1 && !CFLAG:诶嘿嘿
	PRINTC 集合[817]
SIF GATHERING_SPOT(CFLAG:MASTER:現在位置) != 0
	PRINTC 采集列表[818]
;custom code
SIF FISHING_SPOT(CFLAG:MASTER:現在位置) != 0 && ABL:MASTER:教養 >= 3
	PRINTC 钓鱼列表[890]
;魔改内容，显示接触，DEBUG功能
[IF_DEBUG]
	PRINTC 接触显示[901]
[ENDIF]
;魔改完毕
IF CAN_DATE(TARGET)
	LOCAL = QOL_RETURN_HOME_TIME_REQUIRED() ;qol custom code
	SIF LOCAL < 10
		SETCOLOR 100, 250, 140
	PRINTFORMC 邀请去%GET_MAPNAME(MAIN_MAP, 1)%({LOCAL}分)[990]
	RESETCOLOR
ENDIF

SIF CAN_DATE(TARGET)
	PRINTC 邀请去约会[992]
;SIF CFLAG:MASTER:現在位置 == CFLAG:MASTER:初期位置
	PRINTC 日历[993]
SIF FLAG:胖次輸送
	PRINTC 确认手上的胖次[994]
IF AT_HOME(MASTER) && GETBIT(FLAG:瞬間移動, 1)
	SETCOLOR 0x5090FF
ELSEIF !AT_HOME(MASTER) && GETBIT(FLAG:瞬間移動, 0)
	SETCOLOR 0x5090FF
ENDIF
SIF !GETBIT(FLAG:USERCOM開关, 13)
	PRINTC 自动时停移动[995]
RESETCOLOR

;自动扫除
IF AT_HOME(MASTER) && GETBIT(FLAG:自動掃除, 1)
	SETCOLOR 0x5090FF
ELSEIF !AT_HOME(MASTER) && GETBIT(FLAG:自動掃除, 0)
	SETCOLOR 0x5090FF
ENDIF
SIF !GETBIT(FLAG:USERCOM開关, 14) & AT_HOME(MASTER) && !CFLAG:诶嘿嘿 && !CFLAG:陪睡中
	PRINTC 自动扫除[996]
RESETCOLOR

PRINTL
IF FLAG:70 == 1 && CFLAG:TARGET:344 == 0
	SIF EQUIP:0 && TARGET && CFLAG:诶嘿嘿
		PRINTC 脱衣服[820]
	IF EQUIP:0 && TARGET && EQUIP:TARGET:下半身内衣２ != 0 && GET_INT(TARGET, "下半身内衣_ずらし可能", EQUIP:TARGET:下半身下着２, "收藏表示可能") ;addition custom code, only if collectable
		IF !PANTS_ALREADY_COLLECTED()
			SETCOLOR COLOR("PINK")
		ENDIF
			PRINTC 偷走胖次[821]
			RESETCOLOR
	ENDIF
	IF (TEQUIP:5 == 0 || EQUIP:TARGET:上半身内衣１) && CFLAG:诶嘿嘿
		SIF EQUIP:0 && TARGET && EQUIP:TARGET:上半身内衣１ != 0 && (EQUIP:TARGET:和服 != 0 || EQUIP:TARGET:上身衣服２ != 0 || EQUIP:TARGET:ボディースーツ == 3)
			PRINTC 解开胸罩[822]
	ENDIF
	IF TEQUIP:5 == 0 && CFLAG:诶嘿嘿
		SIF EQUIP:0 && TARGET && (EQUIP:TARGET:上半身内衣１ || EQUIP:TARGET:上半身内衣２ || EQUIP:TARGET:下半身内衣１ || EQUIP:TARGET:下半身内衣２ || EQUIP:TARGET:レオタード || EQUIP:TARGET:ボディースーツ) && (EQUIP:TARGET:上身衣服１ || EQUIP:TARGET:上身衣服２ || EQUIP:TARGET:連衣裙 || EQUIP:TARGET:和服 || EQUIP:TARGET:外搭)
			PRINTC 脱到只剩内衣[823]
	ENDIF
	IF MEASUREMENTCHECK(CFLAG:TARGET:現在位置)
		IF CFLAG:TARGET:身体測定 != 2
			PRINTC 身体测定[824]
		ELSE
			PRINTC 结束身体测定[824]
		ENDIF
	ENDIF
	SIF TFLAG:胖次収奪
		PRINTC 夺取胖次[825]
	IF TARGET
		IF TEQUIP:挑逗モード
			PRINTC 结束挑逗[826]
		ELSE
			PRINTC 挑逗[826]
		ENDIF
	ENDIF
	IF CFLAG:诶嘿嘿
		PRINTC 停止猥亵[999]
	ELSE
		PRINTC 时间停止解除[999]
	ENDIF
ELSEIF FLAG:70 == 1 && CFLAG:TARGET:344 == 1
		PRINTC 时间停止解除[999]
	IF CFLAG:诶嘿嘿
		SIF EQUIP:0 && TARGET
			PRINTC 脱衣服[820]

		IF CFLAG:诶嘿嘿 == 2
			IF TFLAG:抱住模式
				PRINTC 甩开[850]
			ELSE
				PRINTC 挣脱[850]
			ENDIF
			IF TEQUIP:挑逗モード
				PRINTC 结束挑逗[826]
			ELSE
				PRINTC 挑逗[826]
			ENDIF
		ELSE
			PRINTC 结束幽会[999]
		ENDIF
	ENDIF
ELSEIF CFLAG:诶嘿嘿 && !CFLAG:恶作剧
	SIF EQUIP:0 && TARGET && !(TFLAG:102 == 3 && TFLAG:抱住模式)
		PRINTC 脱衣服[820]
		IF TARGET
			IF TEQUIP:挑逗モード
				PRINTC 结束挑逗[826]
			ELSE
				PRINTC 挑逗[826]
			ENDIF
		ENDIF
	IF FLAG:70 == 1 && CFLAG:TARGET:344 == 0
		PRINTC 时间停止解除[999]
	ELSEIF CFLAG:诶嘿嘿 == 2
		IF TFLAG:抱住模式
			PRINTC 甩开[850]
		ELSE
			PRINTC 挣脱[850]
		ENDIF
	ELSE
		PRINTC 结束幽会[999]
	ENDIF
ENDIF

IF CFLAG:恶作剧
	SIF CFLAG:恶作剧 < 2 && (EXP:TARGET:睡眠姦経験 > 100 || TCVAR:睡眠薬強度 || TCVAR:睡眠深度 > 2000)
		PRINTC 敞开衣服[830]
	IF CFLAG:恶作剧 < 2
		PRINTC 结束猥亵[999]
		IF EQUIP:TARGET:下半身内衣２
			IF !PANTS_ALREADY_COLLECTED()
				SETCOLOR COLOR("PINK")
			ENDIF
			PRINTC 偷走胖次[821]
			RESETCOLOR
		ENDIF
	ENDIF
	SIF CFLAG:恶作剧 > 1
	PRINTC 结束睡眠奸[999]
ENDIF
IF CFLAG:陪睡中
	PRINTC 结束陪睡[999]
ENDIF
IF CHK_DATENOW(CFLAG:MASTER:约会中) && (!FLAG:70 || CFLAG:TARGET:344 == 1) && !CFLAG:MASTER:诶嘿嘿 && CFLAG:MASTER:現在位置 != OMANEKIBEYA() && TFLAG:妄想中 != 1
	SIF TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:约会中) < 10
		SETCOLOR 100, 250, 140
	PRINTFORMC 踏上归途({TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:约会中)}分)[999]
	RESETCOLOR
ENDIF

;魔改添加非就寝时段存档显示开关
IF Real_Time_Save == 1
PRINTL
SETCOLOR C_L_GREEN
PRINTC 存档[10000]
PRINTC 读档[10001]
PRINTC 删档[10002]
RESETCOLOR
ENDIF

$SKIP
IF PREVCOM >= 0
	IF TFLAG:151
		STR:0 = %STR_TR(1500 + TFLAG:151)%
	ELSE
		STR:0 = %TRAINNAME_TR(PREVCOM)%
	ENDIF
	;addition custom code, custom commands
	IF TFLAG:151 == ADD_CUSTOM_SCOM
		STR:0 '= Add_Custom_SCOM_Name(ADD_PREV_SELECTED_SCOM)
	ELSEIF PREVCOM == ADD_CUSTOM_COM
		STR:0 '= Add_Custom_COM_Name(ADD_PREVCUSTOMCOM)
	ENDIF
ENDIF
SIF PREVCOM == 304 && CFLAG:TARGET:350 == 49 && TALENT:TARGET:酒耐性 != -2
	STR:0 = 碰杯
SIF PREVCOM == 304 && CFLAG:TARGET:350 == 49 && (TALENT:TARGET:酒耐性 == -2 || CFLAG:TARGET:妊娠自覚状態 == 1)
	STR:0 = 请吃料理
SIF PREVCOM == 304 && CFLAG:TARGET:350 == 51
	STR:0 = 照料
;口上自定义
IF INRANGE(PREVCOM, 270, 299)
	CALL KOJO_MESSAGE_SEND("COM", 0, TARGET, PREVCOM - 270)
	STR:0 '= RESULTS
ENDIF
IF !TFLAG:USERCOM非表示
	IF PREVCOM >= 0 && PREVCOM < 300
		PRINTL 
		;PRINT ＜前回调教指令:
		;PRINTS STR:0
		;SIF TFLAG:150
		;	PRINT (助手)
		;PRINTL ＞
		PRINTFORML ＜上回指令:%STR:0%%COND_STR("(助手)", TFLAG:150)%＞
	ELSE
		PRINTL 
		;PRINT ＜上回指令:
		;PRINTS STR:0
		;PRINTL ＞
		PRINTFORML ＜上回指令:%STR:0%＞
	ENDIF
ENDIF
