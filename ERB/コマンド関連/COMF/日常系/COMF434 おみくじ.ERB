;-------------------------------------------------
;神簽
;日常系指令、レベル1
;-------------------------------------------------
;LOCAL
@COM434
VARSET LOCAL

IF !GETBIT(FLAG:999, 0)

	PRINTFORML 赛钱箱的一角贴着告示
	PRINTFORML ┌─────────┐
	PRINTFORML ｜　　　　　　　　　｜
	PRINTFORML ｜幻想御神签　　　　｜
	PRINTFORML ｜　　为了幻想存续　｜
	PRINTFORML ｜　　　　　　　　　｜
	PRINTFORML ｜　　　　　　　　　｜
	PRINTFORML ｜　1日1回 200日元　｜
	PRINTFORML ｜　　请把钱放这里　｜
	PRINTFORML ｜　　　　　　　　　｜
	PRINTFORML └─────────┘
	PRINTFORML 
	PRINTFORML ……
	PRINTFORMW 只要把钱投进赛钱箱里就行了吧,所以说那个“为了幻想存续”是啥意思？
	PRINTFORML 
	CALL PRINT_AA(27)
	PRINTFORML 	
	PRINTFORML 至于神签本身好像是要从旁边的小台拿取……

	SETBIT FLAG:999, 0

ENDIF

IF GETBIT(FLAG:999, 1)
	PRINTFORML 抽御神签是1天1次。
	RETURN -1
ENDIF

IF MONEY < 200
	PRINTFORML 望了望钱包可是没带够钱。
	PRINTFORML 如果不付钱的话……算了那样肯定不灵验的。
	RETURN -1
ENDIF

PRINTFORML 抽御神签一次￥200、要怎么做呢？
PRINTFORML [1] 抽一抽试试
PRINTFORML [0] 还是算了
PRINTFORML 
INPUT
SIF !RESULT
	RETURN -1

MONEY -= 200
TIME += 2
SETBIT FLAG:999, 1

SELECTCASE RAND:18
	CASE 0
		PRINTFORML 在把钱投入赛钱箱后，%CALLNAME:MASTER%将手探向了一旁放御神签的台子……
		PRINTFORML 盒内的签塞得满满当当。
		PRINTFORMW %CALLNAME:MASTER%闭上眼睛，凭借着直觉从神签堆里拿了一张……
	CASE 1
		PRINTFORML 在把钱投入赛钱箱后，%CALLNAME:MASTER%将手探向了一旁放御神签的台子……
		PRINTFORML 盒内的签塞得满满当当。
		PRINTFORMW 由于懒得思考，%CALLNAME:MASTER%随手拿起了签堆最上方的那一张神签……
	CASE 2 TO 3
		PRINTFORML 在把钱投入赛钱箱后，%CALLNAME:MASTER%将手探向了一旁放御神签的台子……
		PRINTFORML 盒内的签零零散散地摆放着。
		PRINTFORMW %CALLNAME:MASTER%闭上眼睛，凭借着直觉从神签堆里拿了一张……
	CASE 4 TO 5
		PRINTFORML 在把钱投入赛钱箱后，%CALLNAME:MASTER%将手探向了一旁放御神签的台子……
		PRINTFORML 盒内的签零零散散地摆放着。
		PRINTFORMW 由于懒得思考，%CALLNAME:MASTER%随手拿起了签堆最上方的那一张神签……
	CASE 6 TO 14
		PRINTFORML 在把钱投入赛钱箱后，%CALLNAME:MASTER%将手探向了一旁放御神签的台子……
		PRINTFORML 盒内只剩下了零星一两张神签
		PRINTFORMW %CALLNAME:MASTER%犹豫不决地从这仅剩的签里拿了一张……
	CASEELSE
		PRINTFORML 在把钱投入赛钱箱后，%CALLNAME:MASTER%将手探向了一旁放御神签的台子……
		PRINTFORML 盒内只剩下了最后一张神签
		PRINTFORMW %CALLNAME:MASTER%……好吧%CALLNAME:MASTER%好像没得选
ENDSELECT

PRINTFORML 看了看拿到的幻存神签的内容。
PRINTFORML …
CALL FORTUNE

;当たり、キャッシュバックによる返金処理
IF GETBIT(FLAG:999, 10)
	PRINTFORML
	PRINTFORML ……
	PRINTFORMW …

	SELECTCASE RAND:15
		CASE 0 TO 4
			PRINTFORML 神签的最后写着奇怪的字：
			PRINTFORML ┌─・─剪切线─・─┐
			PRINTFORML ｜　　　　　　　　　｜
			PRINTFORML ｜　幻想乡共通　　　｜
			PRINTFORML ｜　　　　　商品券　｜
			PRINTFORML ｜　　　　　　　　　｜
			PRINTFORML ｜　　　　　 200日元｜
			PRINTFORML ｜　　　　　　　　　｜
			PRINTFORML ｜　可以找零　　　　｜
			PRINTFORML ｜　　　无使用期限　｜
			PRINTFORML └─────────┘
			PRINTFORMW 仔细想想这东西就是所谓的代金券吧？
		CASE 5 TO 6
			PRINTFORML 仔细一看，神签的下面似乎还粘着什么……
			PRINTFORML %CALLNAME:MASTER%小心翼翼地将它揭了下来……
			PRINTFORML ……
			PRINTFORML 是昭和年间发行的“里白”200日元纸币。
			PRINTFORMW 说实话，这东西也是早该幻想入了。
		CASE 7 TO 11
			PRINTFORML 叮铃铛啷♪    ○彡
			PRINTFORMW 转身望去，赛钱箱里飞出了应该是刚才投进入的钱。
		CASE 12 TO 13
			PRINTFORML 说起来放神签的台子上是不是有什么怪东西的样子？
			PRINTFORML ……
			PRINTFORML %CALLNAME:MASTER%低头一看，里面还有一张和神签一样叠放得板板正正的200日元纸钞。
			PRINTFORML 『这想必是神明大人赐予我的赠品』
			PRINTFORML 这样想着，%CALLNAME:MASTER%双手合十，虔诚地鞠了一躬。
			PRINTFORMW 随后满怀感激地将纸币拿走了。
		CASE 14
			PRINTFORML %CALLNAME:MASTER%刚阅读完神签，某种物品突然从天而降……
			PRINTFORML 咚！刚好砸到了%CALLNAME:MASTER%头上，
			PRINTFORML 低头一看，是刚才投入赛钱箱的钱掉了下来。
			PRINTFORMW 意思是明天也要过来把这钱投进去么？
	ENDSELECT
	
	MONEY += 200
	CLEARBIT FLAG:999, 10
ENDIF


RETURN 1

;-------------------------------------------------
;実行判定
;-------------------------------------------------
;神簽
@COM_ABLE434
;一括管理
SIF GLOBAL_COMABLE(434)
	RETURN RESULT
SIF !TFLAG:100
	RETURN 0
;気力0では不可
SIF BASE:MASTER:気力 <= 0
	RETURN 0
;賽銭箱（神簽の代金入れも兼ねている）でないと引けない
SIF !OMIKUJI_SPOT(CFLAG:MASTER:現在位置)
	RETURN 0
;停止中は不可
SIF FLAG:70 == 1
	RETURN 0
RETURN 1

@OMIKUJI_SPOT(ARG)
#FUNCTION
;博麗神社の賽銭箱
SIF ARG == GET_MAP_REPLACEMENT(3)
	RETURNF 1
RETURNF 0
