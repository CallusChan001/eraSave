;-------------------------------------------------
;陪睡
;日常系指令、レベル2
;-------------------------------------------------
@COM354
;陪睡
;明知道只应该对目标对象进行操作，却写了个循环把所有对象拖入陪睡状态
;FOR LOCAL, 1, GET_TARGETNUM() + 1
;	CALL SET_TOGETHER(1, TARGET:LOCAL, 1)
;	SIF !CFLAG:(TARGET:LOCAL):衰弱 && !CFLAG:(TARGET:LOCAL):招待
;		CALL SET_SLEEP(0, TARGET:LOCAL, 0)
;	CALL SET_DERAY(4, TARGET:LOCAL)
;NEXT
CALL SET_TOGETHER(1, TARGET, 1)
SIF !CFLAG:(TARGET):衰弱 && !CFLAG:(TARGET):招待
	CALL SET_SLEEP(0, TARGET, 0)
CALL SET_DERAY(4, TARGET)

RETURN 1

;-------------------------------------------------
;实行判定
;-------------------------------------------------
@COM_ABLE354
;停止中は不可
SIF FLAG:70
	RETURN 0
;添い寝实行判定
SIF !TFLAG:100
	RETURN 0
;批量管理
SIF GLOBAL_COMABLE(354)
	RETURN RESULT
;睡眠中のみ
SIF CFLAG:睡眠 == 0
	RETURN 0
;持有[恋慕]改为通用的寝室许可判定
SIF !寝室許可(TARGET)
	RETURN 0
;すでに添い寝モード
SIF CFLAG:陪睡中
	RETURN 0
;恶作剧モード中は出来ない
SIF CFLAG:恶作剧
	RETURN 0
;潜伏模式不行
SIF FLAG:潜伏
	RETURN 0
;约会中
SIF CHK_DATENOW(CFLAG:约会中)
	RETURN 0
;有他人在场
;但排除同居者的情况。即使以后有空间折叠技术，有复数角色共用一处地点作为寝室，也通用这一判断，互不干涉
LOCAL:1 = GET_TARGETNUM()
IF LOCAL:1 > 1
	FOR LOCAL,1,LOCAL:1 + 1
		SIF CFLAG:(TARGET:LOCAL):初期位置 != CFLAG:TARGET:初期位置
			RETURN 0
	NEXT
ENDIF
RETURN 1

