;flagsetting
;TCVAR:0:351,污渍标志
;TCVAR:0:352,人数标志
;TCVAR:0:353,陷落度标志
;TCVAR:0:354,TARGET:1
;TCVAR:0:355,余韵2小时
;TCVAR:0:356,UFUFU_START_TIME
;TCVAR:0:357,TARGET:2
@自室描写
#LOCALSIZE 1
#LOCALSSIZE 1
#DIM SPENT_TIME
#DIM 占用手的对象
#DIM 占用嘴的对象
#DIM 占用阴茎的对象
#DIMS 呻吟声
#DIMS 行动声响

;传递出去的行数控制参数
RESULT = 0

IF CFLAG:MASTER:300 == CFLAG:MASTER:311
	PRINTFORMD ◆
	;诶嘿嘿中
	;272スレ>>607さんの構文アイデアお借りしました
	IF SHIRAHU(TARGET) && CFLAG:诶嘿嘿 && TIME == UFUFU_START_TIME
		IF TCVAR:0:357
			PRINTFORMDL 走在最后的\@ TCVAR:0:357 == TARGET ? %CALLNAME:(TCVAR:0:354)% # %CALLNAME:(TCVAR:0:357)% \@关上房门，将%CALLNAME:MASTER%与%CALLNAME:TARGET%窸窣的衣物摩擦声和粗重的喘息声、连同接下来的香艳遮掩在内
		ELSE 
			PRINTFORMDL 房门咔嚓一声关上，%CALLNAME:TARGET%如兰的撒娇求爱和粗重喘息渐渐听不见了…
		ENDIF
	ELSEIF SHIRAHU(TARGET) && CFLAG:诶嘿嘿 && TIME != UFUFU_START_TIME
		占用阴茎的对象 = MASTER_POSE(0, 1)
		占用嘴的对象 = MASTER_POSE(0, 4)
		占用手的对象 = MASTER_POSE(0, 3)
		LOCAL = 0
		呻吟声 =
		行动声响 =
		IF (MASTER_POSE(6, 1) || MASTER_POSE(7, 1)) && PALAM:占用阴茎的对象:潤滑 >= PALAMLV:3
			行动声响 += @"臀肉撞击的啪啪声、\@ TEQUIP:占用阴茎的对象:50 == PLAYER ? 蜜壶 # 尻穴 \@内的%TEXTR("蜜液/淫水/春水爱液")%被搅动的%TEXTR("咕叽/噗哧/滋滋")%声/"
			LOCAL = 1
		ENDIF
		SIF 占用阴茎的对象 && INRANGEARRAY(NOWEX:占用阴茎的对象:0, 1, 50, 0 ,4) && TEQUIP:占用阴茎的对象:口接触部位 == 0
			呻吟声 += @"%CALLNAME:占用阴茎的对象%在高潮中%TEXTR("喘息/陶醉/颤抖")%的甜蜜呻吟音/"
		SIF 占用手的对象 && INRANGEARRAY(NOWEX:占用手的对象:0, 1, 50, 0 ,4) && TEQUIP:占用手的对象:口接触部位 == 0
			呻吟声 += @"%CALLNAME:占用手的对象%在爱抚中%TEXTR("高潮/陶醉/颤抖")%的甜蜜呻吟音/"
		SIF 占用嘴的对象 && INRANGEARRAY(NOWEX:占用嘴的对象:0, 1, 50, 0 ,4) && TEQUIP:占用嘴的对象:口接触部位 == 0
			呻吟声 += @"%CALLNAME:占用嘴的对象%在口交高潮中%TEXTR("喘息/陶醉/颤抖")%的甜蜜呻吟音/"

		SIF PALAM:TARGET:欲情 > PALAMLV:5 && TEQUIP:TARGET:口接触部位 == 0 && TIME != UFUFU_START_TIME
			呻吟声 += @"%CALLNAME:TARGET%粗重的喘息声/"
		SIF ((TEQUIP:占用阴茎的对象:50 == PLAYER && ABL:占用阴茎的对象:Ｖ感覚 > 2)|| (TEQUIP:占用阴茎的对象:51 == PLAYER && ABL:占用阴茎的对象:Ａ感覚 > 2)) && PALAM:占用阴茎的对象:欲情 > PALAMLV:3
			呻吟声 += @"%CALLNAME:占用阴茎的对象%%TEXTR("放荡/失态/妖媚")%的%TEXTR("浪叫/呻吟/娇吟")%声/"
		SIF TEQUIP:TARGET:振動棒 || TEQUIP:TARGET:肛用振動棒 || TEQUIP:TARGET:陰蒂夾 || TEQUIP:TARGET:乳頭夾
			行动声响 += "机械的低沉振动声/"
		IF MASTER_POSE(4, 1) && INRANGEARRAY(NOWEX:占用阴茎的对象:0, 1, 50, 0 ,4)
			呻吟声 += @"%CALLNAME:占用阴茎的对象%吸吮肉棒的啾噜声和高潮中颤抖的娇喘声/"
		ELSEIF MASTER_POSE(4, 1)
			呻吟声 += @"%CALLNAME:占用阴茎的对象%吸吮肉棒的啾噜声/"
		ENDIF
		SIF (MASTER_POSE(6, 3) || MASTER_POSE(7, 3))
			行动声响 += @"搅动%CALLNAME:占用手的对象%\@ TEQUIP:占用手的对象:106 == 3 ? 蜜穴 # 嫩菊 \@的%TEXTR("蜜液/淫水/春水爱液")%咕啾声/"
		IF (占用阴茎的对象 && 占用嘴的对象 && 占用阴茎的对象 != 占用嘴的对象 && PALAM:占用阴茎的对象:欲情 > PALAMLV:3 && PALAM:占用嘴的对象:欲情 > PALAMLV:3) || (占用阴茎的对象 && 占用手的对象 && 占用阴茎的对象 != 占用手的对象 && PALAM:占用阴茎的对象:欲情 > PALAMLV:3 && PALAM:占用手的对象:欲情 > PALAMLV:3)
			呻吟声 += @"美少女们意乱情迷、此起彼伏的%TEXTR("放浪娇吟/呻吟浪叫/莺声燕语")%/"
		ENDIF
		IF 呻吟声 != ""
			SELECTCASE RAND:4
				CASE 1
				PRINTFORMD \@行动声响 != ""? %TEXTR(行动声响)%、#\@%TEXTR(呻吟声)%在
					SELECTCASE TIME:2
					;朝
					CASE 1
						PRINTFORMD 清晨
					;昼
					CASE 2
						PRINTFORMD 早晨
					;昼
					CASE 3
						PRINTFORMD 白天
					;昼
					CASE 4
						PRINTFORMD 夕阳下
					CASE 5
						PRINTFORMD 暗下来
					;夜
					CASE 6,7
						PRINTFORMD 深夜
					ENDSELECT
					PRINTFORMDL 的房间响成一片、构成了十足的天国艳景……
				CASE 2
					PRINTFORMDL \@行动声响 != ""? %TEXTR(行动声响)%、#\@%TEXTR(呻吟声)%透过薄薄的墙壁传到房间外面……
				CASE 3
					PRINTFORMDL \@行动声响 != ""? %TEXTR(行动声响)%、#\@%TEXTR(呻吟声)%就是在门外也能听得清清楚楚……
				CASEELSE
					PRINTFORMDL \@行动声响 != ""? %TEXTR(行动声响)%、#\@%TEXTR(呻吟声)%回荡在屋内…没人在意会不会被外人听见…
			ENDSELECT
			RETURN
		ELSE
			PRINTFORMDL 掩上的房门内、只能隐约听到%TEXTR("窸窣的爱抚声和粗重的喘息声/窸窣的脱衣声和亲昵调笑")%
		ENDIF
	;做爱之后
	ELSEIF !CFLAG:诶嘿嘿 && TCVAR:0:351
		SPENT_TIME = (TIME - TCVAR:0:356) / 60 
		IF SPENT_TIME < 0
			SPENT_TIME += 24
		ENDIF
		IF TCVAR:0:352 > 2
			PRINTFORMD 与%TOKANJIT(TCVAR:0:352)%位少女
		ELSEIF TCVAR:0:352 == 2 && TCVAR:0:357 > 0
			PRINTFORMD 与%CALLNAME:(TCVAR:0:354)%、%CALLNAME:(TCVAR:0:357)%二人
		ELSE
			PRINTFORMD 与%CALLNAME:(TCVAR:0:354)%
		ENDIF
		TCVAR:0:355 = TIME
		IF SPENT_TIME
			PRINTFORMD 长达{SPENT_TIME}小时
			IF TCVAR:0:353 == 2
				PRINTFORMD 身心交融充满爱意的黏腻性爱
			ELSEIF TCVAR:0:353 == 1 && TCVAR:0:352 == 1
				PRINTFORMD 爱意萌动的交合
			ELSE
				PRINTFORMD 贪恋肉欲的交媾
			ENDIF
			PRINTFORMD 结束、
			SELECTCASE YOGORE:(CFLAG:MASTER:300)
				CASE IS < 300
					TCVAR:0:351 = 0
					RESULT = 1
					PRINTFORMDL
					GOTO 回味
				CASE IS < 1000
					PRINTFORMDL 纸巾团和濡湿的服被堆在一角……
				CASE IS < 2000
					PRINTFORMDL 房间各处飞溅的污浊和濡湿的床单和被套都暗示着房间里发生的一切……
				CASEELSE
					PRINTFORMDL 飞溅的爱液和白浊，再加上浓烈的性爱气息，整个房间淫靡无比……
			ENDSELECT
			RETURN
		ELSE
			PRINTFORMDL 的爱爱不情不愿地草草中断……
		ENDIF
	;回味，并且至少射了
	ELSEIF !CFLAG:诶嘿嘿 && TIME - TCVAR:0:355 < 120 && EX:PLAYER:11 > 0
	$回味
		CLEARLINE RESULT
		PRINTFORMD \@RESULT ?◆# \@房间整洁如初，只有隐隐作痛的\@TALENT:0:2&2 ?肉棒# \@和腰子可以证明一场
		IF TCVAR:0:352 > 1
			PRINTFORMD 淫荡无比的%TOKANJIT(TCVAR:0:352 + 1)%人性爱
		ELSEIF TCVAR:0:353 == 2
			PRINTFORMD 充满爱意的缠绵
		ELSEIF TCVAR:0:353 == 1 && TCVAR:0:352 == 1
			PRINTFORMD 爱意萌动的交合
		ELSE
			PRINTFORMD 贪恋肉欲的交媾
		ENDIF
		PRINTFORMDL 发生在这里
		RETURN
	;通常描写
	ELSE
		RESULT = 0
		SELECTCASE 默认初期位置
			;P58大主卧
			CASE 58
			PRINTFORMDL 幻想乡主人的主卧，宽敞而明亮
			;仓库偏僻，角色不太会向仓库移动
			CASE 53
			PRINTFORMDL 将不怎么用的储物间收拾出来，虽然并不逼仄，但隔音不怎么好
			;P119别馆非常特殊，命莲寺住人绝对不会闯入
			CASE 119
			PRINTFORMDL 供香客借宿的简朴宿屋，寺众不会擅自进入
			CASE 230
			PRINTFORMDL 长屋里允许开伙，但没有浴室，墙壁也相当薄
			CASE 304
			PRINTFORMDL 馆内角落的西式客房，用餐请到馆内
			;P442空的小屋,P734小屋,P810山小屋,P943茅屋
			CASE 442,734,810,943
			PRINTFORMDL 勉强可以开伙做饭的一间小屋，浴室就别想了
			PRINTFORMDL	由于附近都是私宅，经常有人闯进来自己炒两个菜
			RESULT = 1
			;P515魔理沙宅・仓库没有私人属性，但除了魔理沙也不太有人会来
			CASE 515
			PRINTFORMDL 魔理沙家旁边的杂物间，路过的不知情者都想不到里面住着人
			;P35三妖精之家・地下室
			CASE 35
			PRINTFORMDL 大树屋下层最宽敞的地方，话说树屋的空间比外面看着大多了这不是错觉吧
			;P51梦幻遗迹・仓库
			CASE 51
			PRINTFORMDL 充满科技感的船舱，像住在飞船上
			;P531人偶洋馆・空的房间	= 
			CASE 531
			PRINTFORMDL 人偶洋馆的西式客房，温馨而明亮，有股好闻的味道
			;P625空房间	= 
			CASE 625
			PRINTFORMDL 白玉楼的和式客房，有很清新淡雅的气息，被妖梦打理得井井有条
			;P634空房间	= 
			CASE 634
			PRINTFORMDL 八云邸的和式客房，有好闻的木头香气，而且一进房间就变得宽敞
			;P618空的房间	= 
			CASE 618
			PRINTFORMDL 是非曲直厅的宿屋，虽然老旧，但映姬小町她们的房间也是相同的设计
			;P823空室	= 
			CASE 823
			PRINTFORMDL 内庭的一间空房，虽然不大但令人心情平静
			;P842比那名居邸库房	= 
			CASE 842
			PRINTFORMDL 比那名居邸角落的库房，相当宽敞，缺少采光但空气一点也不浑浊
			;P728仙人的宅邸・空的房间	= 
			CASE 728
			PRINTFORMDL 华扇家的客房，有着檀香和动物气味
			;P536艾伦宅・仓库	= 
			CASE 536
			PRINTFORMDL 艾伦家的仓库，很窄小，能闻到各种花香
			;P916库房	= 
			CASE 916
			PRINTFORMDL 地灵殿二层的小仓库，是主人们的居所所以动物们不会随意进入
			;P134藏	= 
			CASE 134
			PRINTFORMDL 庙里藏经阁的空库房，有着书卷气息
			;P412空的房间	= 
			CASE 412
			PRINTFORMDL 永远亭内的和室客房，虽然周围兔子不少，却有着让人感觉时间停滞的宁静感
			;P460空的房间	= 
			CASE 460
			PRINTFORMDL 梦幻馆的空客房，装饰优雅精致，充满各种花香
			;P719秋姊妹的家・和室	= 
			CASE 719
			PRINTFORMDL 秋神家的和室，有着幸福的甜氛，采光很好，能看到庭院的田地
			;P1033绵月亭・空的房间	= 
			CASE 1033
			PRINTFORMDL 内庭的空房间，装饰几乎没有，也没有一丝异味，但不如说是无味…
			;P1052哆来咪宅・仓库	= 
			CASE 1052
			PRINTFORMDL 哆来咪家原本的仓库，收拾成了与哆来咪卧室差不多的风格，非常安神Zzz
			;P1063纯狐邸・空的房间
			CASE 1063
			PRINTFORMDL 纯狐邸一层的空房间，和皮丝的房间是一样的哟
		ENDSELECT
		CALL 完全变成炮房了呢
	ENDIF
ENDIF
;可以扩展成履历数据，但目前仅记录地点是私室、日期在七日内的数据
@诶嘿嘿记录
#DIM NUM_TARGET
#LOCALSIZE 1
#LOCALSSIZE 1
NUM_TARGET = GET_TARGETNUM()
SIF CFLAG:MASTER:300 != CFLAG:MASTER:311
	RETURN
;UFUFU_START_TIME将在诶嘿嘿结束时清空
TCVAR:0:356 = UFUFU_START_TIME
SIF !UFUFU_私室地点
	UFUFU_私室地点 = CFLAG:MASTER:初期位置
IF UFUFU_私室地点 != CFLAG:MASTER:初期位置
	FOR LOCAL,0, CHARANUM
		VARSET UFUFU_记录标志:LOCAL:0
	NEXT
	VARSET UFUFU_日期记录
	UFUFU_私室地点 = CFLAG:MASTER:初期位置
ENDIF
UFUFU_日期记录:(DAY%7) = DAY
TCVAR:0:354 = TARGET:1
SIF NUM_TARGET > 1
	TCVAR:0:357 = TARGET:2
;类似态度处理，取在场女生陷落程度的最低值作为这场诶嘿嘿的恩爱程度
TCVAR:0:353 = 2
FOR LOCAL,1, NUM_TARGET + 1
	UFUFU_记录标志:(TARGET:LOCAL):(DAY%7) = 1
	IF TCVAR:0:353 == 2 && (TALENT:(TARGET:LOCAL):恋慕 || TALENT:(TARGET:LOCAL):恋人)
	ELSEIF TCVAR:0:353 > 0 && TALENT:(TARGET:LOCAL):思慕
		TCVAR:0:353 = 1
	ELSE 
		TCVAR:0:353 = 0
		BREAK
	ENDIF
NEXT
TCVAR:0:351 = 1
TCVAR:0:352 = NUM_TARGET

@完全变成炮房了呢
#DIM UFUFU_对象,10
#DIM UFUFU_日期,10
#DIM CONST 炮房值 = 2
#DIM 计数
#LOCALSIZE 6
#LOCALSSIZE 1

SIF !UFUFU_私室地点
	UFUFU_私室地点 = CFLAG:MASTER:初期位置
IF UFUFU_私室地点 != CFLAG:MASTER:初期位置
	FOR LOCAL,0, CHARANUM
		VARSET UFUFU_记录标志:LOCAL:0
	NEXT
	VARSET UFUFU_日期记录
	UFUFU_私室地点 = CFLAG:MASTER:初期位置
ENDIF
;接收要删除的行数
LOCAL:5 = RESULT
计数 = 0
FOR LOCAL,0, 7
LOCAL:4 = 0
IF DAY - UFUFU_日期记录:LOCAL < 7
	CALL FISHER_YATES_SHAFFLE(CHARANUM - 1)
	FOR LOCAL:1 , 0 , CHARANUM - 1
		LOCAL:2 = SHAFFLE_ARRAY:(LOCAL:1) + 1
		IF UFUFU_记录标志:(LOCAL:2):(LOCAL)
			IF 计数
				FOR LOCAL:3 , 0 , 计数
					IF UFUFU_对象:(LOCAL:3) == LOCAL:2
						LOCAL:4 = 1
						BREAK
					ENDIF
				NEXT
				IF !LOCAL:4
					UFUFU_对象:计数 = LOCAL:2
					UFUFU_日期:计数 = UFUFU_日期记录:LOCAL
					计数++
					BREAK
				ENDIF
			ELSE
				UFUFU_对象:计数 = LOCAL:2
				UFUFU_日期:计数 = UFUFU_日期记录:LOCAL
				计数++
				BREAK
			ENDIF
		ENDIF
	NEXT
ENDIF
NEXT
IF 计数 > 炮房值
CLEARLINE LOCAL:5
CALL HPH_PRINT,@"HPH但最近…好像完全变成炮房了呢","L"
PRINTFORM 周%GET_DAY_CN(UFUFU_日期:0)%是%CALLNAME:(UFUFU_对象:0)%、
PRINTFORM 周%GET_DAY_CN(UFUFU_日期:1)%是%CALLNAME:(UFUFU_对象:1)%、
PRINTFORML 周%GET_DAY_CN(UFUFU_日期:2)%是%CALLNAME:(UFUFU_对象:2)%…
ENDIF

