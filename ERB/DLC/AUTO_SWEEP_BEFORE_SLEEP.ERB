@AUTO_SWEEP_BEFORE_SLEEP_ASK
#LOCALSIZE 1
#LOCALSSIZE 1

;气力过低或TPS不足跳过，参考内职需求。
SIF BASE:MASTER:気力 < 300 || BASE:MASTER:TSP < 50
	RETURN

IF AUTO_SWEEP_BEFORE_SLEEP_DIM == 1
	PRINTFORML 是否要进行睡前自动扫除？
	PRINTL
	PRINTFORML [1]是
	PRINTFORML [0]否
	INPUT
	SIF RESULT == 1
		CALL AUTO_SWEEP_BEFORE_SLEEP
ELSEIF AUTO_SWEEP_BEFORE_SLEEP_DIM == 2
	CALL AUTO_SWEEP_BEFORE_SLEEP
ENDIF

@AUTO_SWEEP_BEFORE_SLEEP
#LOCALSIZE 1
#LOCALSSIZE 1
;#DIM AUTOSWEEP_ROOM_ID
;#DIM AUTOSWEEP_ENDROOM_ID
#DIM SWEEP_POWER
#DIM SWEEP_YOGORE

;赋值房间ID
;AUTOSWEEP_ROOM_ID = MINROOM()
;AUTOSWEEP_ENDROOM_ID = MAXROOM

;清扫力
SWEEP_POWER = SWEEP_POWER_CALC(0)
FOR LOCAL, MINROOM(), MAXROOM
	IF LOCAL == P54小人的虫籠 && TALENT:MASTER:体型 > -5
		SWEEP_YOGORE = YOGORE:P54小人的虫籠 / 5
		YOGORE:P54小人的虫籠 = 0
		EX:MASTER:今日的掃除回数 += SWEEP_YOGORE
		EXP:MASTER:清掃経験 ++
		CONTINUE
	ENDIF
	WHILE YOGORE:LOCAL >= OSOUJI_LIMIT(MASTER) && BASE:MASTER:TSP >= 50
		SWEEP_YOGORE = YOGORE:LOCAL - YOGORE:LOCAL / (SWEEP_POWER * (LOCAL == P54小人的虫籠 ? 5 # 1))
		YOGORE:LOCAL -= SWEEP_YOGORE
		EX:MASTER:今日的掃除回数 += SWEEP_YOGORE
		EXP:MASTER:清掃経験 ++
		BASE:MASTER:TSP -= 50
	WEND
NEXT
[SKIPSTART]
WHILE AUTOSWEEP_ROOM_ID <= AUTOSWEEP_ENDROOM_ID && BASE:MASTER:TSP >= 50
	WHILE YOGORE:AUTOSWEEP_ROOM_ID > 100 && BASE:MASTER:TSP >= 50
	;先赋值当前房间垃圾总量，然后进行清扫结算。
	SWEEP_YOGORE = YOGORE:AUTOSWEEP_ROOM_ID
	YOGORE:AUTOSWEEP_ROOM_ID = YOGORE:AUTOSWEEP_ROOM_ID / SWEEP_POWER
	EX:MASTER:今日的掃除回数 = EX:MASTER:今日的掃除回数 + SWEEP_YOGORE - YOGORE:AUTOSWEEP_ROOM_ID
	EXP:MASTER:清掃経験 ++
	BASE:MASTER:TSP -= 50
	WEND
AUTOSWEEP_ROOM_ID ++
WEND
[SKIPEND]
PRINTFORML %CALLNAME:MASTER%在睡觉之前使用剩余的TSP进行了清扫。
