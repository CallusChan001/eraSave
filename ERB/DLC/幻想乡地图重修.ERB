;外出大地图房间设定
@GMF_ODEKAKE_MAIN_MAP_ROOMSETTING(ARG)
#DIM HOME_MAP

HOME_MAP = MAIN_MAP
MAIN_MAP = ARG
CALL ROOMSETTING
CURRENT_MAIN_MAP = MAIN_MAP
CURRENT_MAXROOM = MAXROOM
CURRENT_避難处 = 避難处
CURRENT_默认初期位置 = 默认初期位置
CURRENT_ENTRANCE = ENTRANCE
CURRENT_拠点_家主 = 拠点_家主
CURRENT_拠点_酒虫 = 拠点_酒虫
CURRENT_PRIVATEROOM = PRIVATEROOM
CURRENT_ROOMDATA = ROOMDATA
CURRENT_MAP_PAGES = MAP_PAGES
CURRENT_MAPNAME = MAPNAME
CURRENT_SUMIKOMI_ROOM = SUMIKOMI_ROOM

MAIN_MAP = HOME_MAP
CALL ROOMSETTING
CLEARLINE 1

;GENSOKYO_MAP_FIX位操作：
@GMF_GETBIT(ARGS)
#FUNCTION
SELECTCASE ARGS
	CASE "幻想乡大地图"
		RETURNF GETBIT(GENSOKYO_MAP_FIX, 0)
	CASE "人里菜园"
		RETURNF GETBIT(GENSOKYO_MAP_FIX, 1)
	CASE "人里地图优化"
		RETURNF GETBIT(GENSOKYO_MAP_FIX, 2)
	CASEELSE
		THROW 未设置正确的获取内容。
ENDSELECT

@GMF_SETBIT(ARGS)
SELECTCASE ARGS
	CASE "幻想乡大地图"
		SETBIT GENSOKYO_MAP_FIX, 0
	CASE "人里菜园"
		SETBIT GENSOKYO_MAP_FIX, 1
	CASE "人里地图优化"
		SETBIT GENSOKYO_MAP_FIX, 2
	CASEELSE
		THROW 未设置正确的获取内容。
ENDSELECT

@GMF_CLEARBIT(ARGS)
SELECTCASE ARGS
	CASE "幻想乡大地图"
		CLEARBIT GENSOKYO_MAP_FIX, 0
	CASE "人里菜园"
		CLEARBIT GENSOKYO_MAP_FIX, 1
	CASE "人里地图优化"
		CLEARBIT GENSOKYO_MAP_FIX, 2
	CASEELSE
		THROW 未设置正确的获取内容。
ENDSELECT

@GMF_INVERTBIT(ARGS)
SELECTCASE ARGS
	CASE "幻想乡大地图"
		INVERTBIT GENSOKYO_MAP_FIX, 0
	CASE "人里菜园"
		INVERTBIT GENSOKYO_MAP_FIX, 1
	CASE "人里地图优化"
		INVERTBIT GENSOKYO_MAP_FIX, 2
	CASEELSE
		THROW 未设置正确的获取内容。
ENDSELECT

;设置菜单
@GMF_SETTING_MENU
#DIM DYNAMIC STARTLINECOUNT
STARTLINECOUNT = LINECOUNT
$GMF_MAIN_LOOP
SIF LINECOUNT - STARTLINECOUNT > 0
	CLEARLINE LINECOUNT - STARTLINECOUNT
CALL PRINTBUTTON_EX, @"[0] 大地图开关　状态：%\@ GMF_GETBIT("幻想乡大地图") ? 开启 # 关闭 \@%", 0, 0, GMF_GETBIT("幻想乡大地图")
PRINTFORML
PRINTFORML [1] 地图优化设置
;PRINTFORML [2] 手动继承低版本设置
PRINTFORML [99] 返回
$GMF_MAIN_INPUT_LOOP
INPUT
SELECTCASE RESULT
	CASE 0
		;CALL GMF_INVERTBIT("幻想乡大地图")
		CALL GMF_CLEARBIT("幻想乡大地图")
		PRINTFORMW 当前功能尚未实装，敬请期待（呜呜这个版本先把天气改了）
		GOTO GMF_MAIN_LOOP
	CASE 1
		A:1 = LINECOUNT
		$GMF_SETTING_LOOP
		CLEARLINE LINECOUNT - A:1
		CALL PRINTBUTTON_EX, @"[0] 人里菜园开关　状态：%\@ GMF_GETBIT("人里菜园") ? 开启 # 关闭 \@%", 0, 0, GMF_GETBIT("人里菜园")
		PRINTFORML
		CALL PRINTBUTTON_EX, @"[1] 人里地图优化开关　状态：%\@ GMF_GETBIT("人里地图优化") ? 开启 # 关闭 \@%", 1, 0, GMF_GETBIT("人里地图优化")
		PRINTFORML
		PRINTFORML [2] 返回
		$GMF_SETTING_INPUT_LOOP
		INPUT
		SELECTCASE RESULT
			CASE 0
				CALL GMF_INVERTBIT("人里菜园")
				PRINTL
				PRINTFORML 该选项在人里设置了家庭菜园，位置在201人里的门，是在人里门外附近不远处找到一块小菜园。
				PRINTFORML 这样一来，访问人里的少女们也能欣赏到你先生你小姐在田间辛劳的美景了。
				PRINTFORML 开启该选项后，需要从搬家界面退出一次才能刷新。（搬家中止也可）
				CALL 有色二择提示,"人里的家庭菜园","不可用","现在在人里门外附近",GMF_GETBIT("人里菜园")
				WAIT
				GOTO GMF_SETTING_LOOP
			CASE 1
				CALL GMF_INVERTBIT("人里地图优化")
				PRINTL
				PRINTFORML 该选项重修了人里的部分地图和坐标，使之和基础据点地图的结构保持一致。（推荐使用颜色地图）
				PRINTFORML 原版外出地图为了保持整合性将各地点的位置做了很大变动，使得许多店铺的位置发生了错位。
				PRINTFORML 重修的主要目的是保证空间上的一致性，外出地点现在只用作功能性分类而并不代表实际空间位置。
				PRINTFORML 如果你已经习惯了之前的地图结构，也可以只选择开启菜园。功能性角度来说原版地图确实更方便一些。
				CALL 有色二择提示,"甜品店现在归属于","广场","吞屋小道",GMF_GETBIT("人里地图优化")
				CALL 有色二择提示,"人里各区域在外出地图中的距离","没有变化","相距更近了",GMF_GETBIT("人里地图优化")
				CALL 有色二择提示,"人里各地点的寻路","没有变化","经过优化了",GMF_GETBIT("人里地图优化")
				CALL 初始化邻接表(1)
				WAIT
				GOTO GMF_SETTING_LOOP
			CASE 2
				GOTO GMF_MAIN_LOOP
			CASEELSE
				CLEARLINE 1
				GOTO GMF_SETTING_INPUT_LOOP
		ENDSELECT
	;CASE 2
	;	CALL GMF_VERSION_UP
	;	PRINTL
	;	PRINTFORML 低版本设置继承完成。
	;	PRINTFORML 人里菜园开关　状态：\@ GMF_GETBIT("人里菜园") ? 开启 # 关闭 \@
	;	PRINTFORML 人里地图优化开关　状态：\@ GMF_GETBIT("人里地图优化") ? 开启 # 关闭 \@
	;	WAIT
	;	GOTO GMF_SETTING_LOOP
	CASE 99
		RETURN
	CASEELSE
		CLEARLINE 1
		GOTO GMF_MAIN_INPUT_LOOP
ENDSELECT

;;低版本升级（人里小修）
;@GMF_VERSION_UP
;IF GETBIT(SATO_Little_Fix, 0)
;	CALL GMF_SETBIT("人里菜园")
;ELSE
;	CALL GMF_CLEARBIT("人里菜园")
;ENDIF
;IF GETBIT(SATO_Little_Fix, 1)
;	CALL GMF_SETBIT("人里地图优化")
;ELSE
;	CALL GMF_CLEARBIT("人里地图优化")
;ENDIF
