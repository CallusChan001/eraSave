; @WEATHERDLC_EV15()
; #FUNCTIONS
; FLAG:異常気象 = 6 + RAND:9

; WHILE FLAG:異常気象 == 9 || FLAG:異常気象 == 10
; 	FLAG:異常気象 = 6 + RAND:9
; WEND
; TIME:5 = 0

; SELECTCASE FLAG:異常気象
; 	CASE 6
; 		RETURNF "変得喜歡真空出門"
; 	CASE 7
; 		RETURNF "内裤被风吹的到处跑"
; 	CASE 8
; 		RETURNF "桃色之風吹起来了"
; 	CASE 11
; 		RETURNF "亮晶晶的钻石尘在空中闪耀着"
; 	CASE 12
; 		RETURNF "沙尘暴吹起来了"
; 	CASE 13
; 		RETURNF "阳光变得比平时要刺眼"
; 	CASE 14
; 		RETURNF "极光在高空闪耀着"
; ENDSELECT
@WEATHERSTAUSSHOW(ARG = -1, ARG:1 = -1, ARG:2 = -1, ARG:3 = -1)
SIF ARG == -1
	ARG = MASTER
SIF ARG:1 == -1
	ARG:1 = TIME:2
SIF ARG:2 == -1
	ARG:2 = TIME:5
SIF ARG:3 == -1
	ARG:3 = TIME:7
SELECTCASE ARG:2
	CASE 0,1,17,19
		IF ARG:1 >= 2 && ARG:1 <= 4
			;06時から18時までは昼間
			SETCOLOR 0xFF9640
			PRINTFORM %UNICODE(0x2600)%
		ELSE
			;19時から06時までは夜間
			SETCOLOR 0xFFFF40
			PRINTFORM %UNICODE(0x262A)%
		ENDIF
	CASE 2,3
		SETCOLOR 0x9C9C9C
		PRINTFORM %UNICODE(0x2601)%
	CASE 4 TO 6,14 TO 16,20
		IF TEQUIP:TARGET:201 && OUTROOF(CFLAG:ARG:現在位置)
			SETCOLOR 0xFF99CC
			PRINTFORM %UNICODE(0x2602)%
			SETCOLOR 0xFFCCFF
			CALL HEART
			PRINTFORM 相合伞
			CALL HEART
		ELSE
			SETCOLOR 0x0000FF
			PRINTFORM %UNICODE(0x2602)%
		ENDIF
	CASE 8 TO 13
	CASEELSE
		IF TEQUIP:TARGET:201 && OUTROOF(CFLAG:ARG:現在位置)
			SETCOLOR 0xFFCCFF
			PRINTFORM %UNICODE(0x2603)%
			SETCOLOR 0xFF99CC
			CALL HEART
			PRINTFORM 相合伞
			CALL HEART
		ELSE
			SETCOLOR 0xFFFFFF
			PRINTFORM %UNICODE(0x2603)%
		ENDIF
ENDSELECT

@WEATHERCHECK(WEATARGET,ARG, Lapse)
#DIM WEATARGET
#DIM Lapse
#DIM 傘ダメージ
SIF ARG
	RETURN
IF !ITEM:折畳傘 && Lapse && !TFLAG:195 && !CFLAG:0:诶嘿嘿 && !CFLAG:0:睡眠
	SELECTCASE TIME:5
		;雨・霧雨
		CASE 4, 6, 15, 16, 20
			;余計なタイミングでメッセージが出ないように
			PRINTW 被雨淋得皮肤发寒
		;大雨
		CASE 5
			PRINTW 冰冷的雨刺激着皮肤
		;雪・細雪・霧雪・みぞれ
		CASE 8, 10, 11, 12, 13
			PRINTW 被雪弄得皮肤发寒
		;吹雪
		CASE 9
			PRINTW 暴风雪快把身体凍僵了
	ENDSELECT
;あなたが折りたたみ傘を持っていると体力の代わりに傘耐久度が減る
ELSE
	SELECTCASE TIME:5
		;霧雨、霧雪
		CASE 6, 11, 15
			傘ダメージ = 1
		;みぞれ
		CASE 13
			傘ダメージ = 5
		;雨・雪・細雪
		CASE 4, 8, 10, 12, 14, 15, 16, 20
			傘ダメージ = 2
		;大雨・吹雪
		CASE 5, 9
			傘ダメージ = 50
		CASEELSE
			傘ダメージ = 0
	ENDSELECT
	FLAG:傘耐久度 += 傘ダメージ * Lapse
	IF FLAG:傘耐久度 > 10000
		IF MONEY >= 1200 && Automatic_umbrella_repair == 1;1==花钱自动维修
			FLAG:傘耐久度 = 0
			MONEY -= 1200
			CALL COLORMESSAGE(@"伞坏了！%CALLNAME:0%花费1200¥从间隙商店重新购买一把新的。",C_YELLOW,2)
		ELSEIF BASE:0:TSP >= 600 &&Automatic_umbrella_repair == 2;2==花TSP自动维修
			FLAG:傘耐久度 = 0
			BASE:0:TSP -= 600
			CALL COLORMESSAGE(@"伞坏了！%CALLNAME:0%暂停时间将其修好。（TSP -600）",C_YELLOW,2)
		ELSEIF Automatic_umbrella_repair == 3;3==作弊自动维修
			FLAG:傘耐久度 = 0
			CALL COLORMESSAGE(@"伞坏了！%CALLNAME:0%瞬间将其重新修好。",C_YELLOW,2)
		ELSE
			ITEM:折畳傘 = 0
			ITEMSALES:36 ++
			FLAG:傘耐久度 = 0
			ITEM:壊掉的傘 = 1
			SIF EQUIP:TARGET:飾品 != 6
				TEQUIP:TARGET:相合伞 = 0
			PRINTW 伞坏掉了！
		ENDIF
	ELSEIF FLAG:傘耐久度 > 8000 && 傘ダメージ
		SIF Lapse && !TFLAG:195 && !CFLAG:ARG:诶嘿嘿 && !CFLAG:ARG:睡眠
			PRINTW 伞好像坏掉了…
	ENDIF
ENDIF


@WEATHERCHANGESTAUS
IF INRANGE(FLAG:異常気象,9,14)&&FLAG:異常気象!=11
	CALL WeatherBCg(FLAG:異常気象-9)
ELSEIF TIME:5 == 19
	CALL WeatherBCg(-1)
ENDIF
@WeatherBCg(ARG)
#DIM bID=11,6,0,1,0;理性、精气体
IF INRANGE(ARG,0,4)&&ARG!=2
	FOR LOCAL, !ARG, CHARANUM
		SIF ARG==1&&TALENT:LOCAL:2==1;女无精
			CONTINUE
		SIF OUTROOF(CFLAG:LOCAL:現在位置)&&BASE:LOCAL:(bID:ARG)>=300*(1-!ARG)
			BASE:LOCAL:(bID:ARG)=MAX(1,BASE:LOCAL:(bID:ARG)-MAXBASE:LOCAL:(bID:ARG)/100)
	NEXT
ELSEIF ARG==5&&OUTROOF(CFLAG:0:現在位置)&&BASE:0:TSP >= 100
	BASE:0:TSP = MAX(0,BASE:0:TSP-MAXBASE:0:TSP/100)
ELSEIF ARG==-1
	TIMES BASE:0:TSP,1.01
	FOR LOCAL, 0, CHARANUM
		SIF BASE:LOCAL:体力 <= MAXBASE:LOCAL:体力*4/5
			TIMES BASE:LOCAL:体力,1.01
	NEXT
ENDIF
@CHECKWEATHERLISTINFO
PRINTFORML 恶劣天气：
PRINTFORML 台风：在室外，理智之壁随时间不断降低
PRINTFORML 钻石尘：入睡无法恢复体力
PRINTFORML 黄沙：在室外，气力随时间流逝不断减少
PRINTFORML 烈日：在室外，体力随时间流逝不断减少
PRINTFORML 极光：在室外，TSP随时间流逝不断减少
PRINTFORML 猛吹雪：在室外，精力会随时间不断减少
PRINTFORML
PRINTFORML
PRINTFORML 普通天气：
PRINTFORML 阴天：外出回家时，袭击的几率提高
PRINTFORML 雾：H的时候，主角的体力会被对方吸走
PRINTFORML 吹雪：行动消耗的体力变多
PRINTFORML 冰雹：临时增加所有角色精力上限
PRINTFORML 太阳雨：行动消耗的体力变少
PRINTFORML 无风：体力随时间缓慢恢复
PRINTFORML 梅雨：理智之壁难以突破
PRINTFORML 晴岚：理智之壁更容易突破
PRINTFORMW
