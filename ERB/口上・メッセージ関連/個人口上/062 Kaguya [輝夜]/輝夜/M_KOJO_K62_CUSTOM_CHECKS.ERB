@M_KOJO_CHECK_K62_DAYEVENT_COND(ARGS, ARG, ARG:1)
#DIM DYNAMIC MOONVIEWING_POSSIBLE
;moonviewing (during an actual full moon) is allowed if she's either at love or at yearning while living in the Bamboo Forest
SIF (MOON_WATCH(DAY:3, 1) == 9 && MAIN_MAP != MAP月 && TIME:5 < 4 && ((TALENT:思慕 && MAIN_MAP == MAP竹林) || TALENT:恋慕))
	MOONVIEWING_POSSIBLE = 1

;all other events are prevented if an actual moonviewing is possible
SIF MOONVIEWING_POSSIBLE && INRANGE(ARG, DAYEVENT_ORAL, NIGHTEVENT_SLEEPOVER) && ARG != NIGHTEVENT_MOONVIEWING
	RETURN -1

SELECTCASE ARG
	CASE DAYEVENT_GENERAL ;initial, if the function is allowed to run at all, -1 is disallowed, 1 is allowed, 0 acts like a character without dialogue
		SIF CFLAG:1190 ;not allowed by dialogue
			RETURN -1
		SIF !TALENT:思慕 && !TALENT:恋慕 && !TALENT:愛欲 ;neither yearning, nor love, nor lust
			RETURN -1
		SIF MOONVIEWING_POSSIBLE ;moonviewing is always possible regardless of last visitation time if conditions apply
			RETURN 2
		; SIF ARGS == "day" && CFLAG:初期位置 == CFLAG:MASTER:初期位置 && RAND:4 ;kaguya already has morning events in EVENT_2, so don't trigger these always if those can trigger
		; 	RETURN -1
		RETURN 1
	
	;per event
	;RETURN -1 - means disallowed, 0 - fall back to original condition, 1 - allowed
	;see DAYEVENTS.ERH for options
	CASE DAYEVENT_ORAL, DAYEVENT_PAIZURI, DAYEVENT_COWGIRL, NIGHTEVENT_YOBAI
		SIF !HAS_PENIS(MASTER)
			RETURN -1
		SIF !TALENT:恋慕 && !TALENT:愛欲
			RETURN -1
		RETURN 0
	CASE DAYEVENT_KISS, DAYEVENT_WAKEUP, DAYEVENT_PRANK, NIGHTEVENT_SLEEPOVER
		SIF !TALENT:恋慕
			RETURN -1
		RETURN 0
	CASE DAYEVENT_COSLEEPING
		SIF !TALENT:恋慕
			RETURN -1
		SIF CFLAG:初期位置 == CFLAG:MASTER:初期位置 ;only while visiting
			RETURN -1
		RETURN 0
	CASE DAYEVENT_STARE
		SIF TALENT:思慕 || TALENT:恋慕
			RETURN 1
		RETURN -1
	CASE NIGHTEVENT_KISS, NIGHTEVENT_DRINK
		SIF !TALENT:恋慕 && !TALENT:愛欲
			RETURN -1
		RETURN 0
	CASE NIGHTEVENT_MOONVIEWING
		SIF MOONVIEWING_POSSIBLE
			RETURN 1
		SIF !TALENT:恋慕
			RETURN -1
		RETURN 0
ENDSELECT
RETURN 0
