@COMF_K43_TPP_332
;机制所限，只能通过改COMF来实现改地文了
#DIM 酒ID
VARSET LOCALS

DRAWLINE
PRINTFORML %CALLNAME:MASTER%掏出了——
CALL 酒一覧表示(1)
IF RESULT
	TFLAG:194 = RESULT
	ITEM:RESULT --
ELSE
	RETURN -1
ENDIF
COM_STR = %ITEMNAME:(TFLAG:194)%
酒ID = ALC_ID(COM_STR)
PRINTFORML ，往%CALLNAME:TARGET%的酒杯里斟了满满一杯
TFLAG:193 = 0

IF !TALENT:TARGET:恋慕 && CFLAG:TARGET:烂酔奸 == 2
;被醉姦过所以有所忌惮
	PRINTFORML 但%CALLNAME:TARGET%已经不想再与%CALLNAME:MASTER%喝酒了…
	SOURCE:反感 += 3000
	BASE:情緒 = 0
	BASE:憤怒 = 1500
	RETURN -1
ELSEIF TCVAR:烂醉
;实在喝不动了
	PRINTFORML 但哪怕是强如%CALLNAME:TARGET%也已经没了对酒的能力了…
	TFLAG:193 = -1
	RETURN -1
 ;下述为不会喝酒/强制失败的情况，如果需要用的话记得把分号给删了
 ;ELSEIF (TALENT:TARGET:酒耐性 == -2 && CFLAG:TARGET:不會喝酒 < 5) || TFLAG:192 == -1
 ;	SELECTCASE CFLAG:TARGET:不會喝酒
 ;		CASE IS < -10
 ;			LOCALS = %CALLNAME:TARGET%露出不高兴的样子
 ;		CASE IS <= -3
 ;			LOCALS = 曾经经历过讨厌感觉的%CALLNAME:TARGET%不想再喝酒的样子…
 ;		CASEELSE
 ;		IF TARGET == 55 || TFLAG:192 == -1
 ;			LOCALS = %CALLNAME:TARGET%推托说自己不能喝酒
 ;		ELSE
 ;			LOCALS = 不会喝酒的%CALLNAME:TARGET%似乎不想再喝了的样子…
 ;		ENDIF
 ;	ENDSELECT
 ;	PRINTFORML %LOCALS%
 ;	PRINTFORML [0] 放弃
 ;	PRINTFORML [1] 説服
 ;	$LOOP
 ;	INPUT
 ;	IF RESULT == 0 || TARGET == 55 || TFLAG:192 == -1
 ;ひじりんは宗教的信条なので絶対飲まない。口上側で制御した場合もここ
 ;		PRINTFORML 因为%CALLNAME:TARGET%完全没有要喝酒的意思、所以放弃了…
 ;		TFLAG:193 = -5
 ;		RETURN 0
 ;	ELSEIF RESULT == 1
 ;		IF (ABL:親密 * 200 + ABL:MASTER:話術技能 * 100 + MIN(3,CFLAG:不會喝酒) * 300) * BASE:情緒 / MAXBASE:情緒 >= 1500
 ;			PRINTFORML 由于%CALLNAME:MASTER%的劝说%CALLNAME:TARGET%开始怯生生的喝起酒来…
 ;			CFLAG:不會喝酒 += 1
 ;			TFLAG:193 = 1
 ;		ELSEIF CFLAG:不會喝酒 < -10
 ;			PRINTFORML %CALLNAME:TARGET%终于被惹火了
 ;			SOURCE:反感 += 3000
 ;			BASE:情緒 = 0
 ;			BASE:憤怒 = 1500
 ;			TFLAG:好感度减少 = 5
 ;			TFLAG:193 = -2
 ;			RETURN 1
 ;		ELSE
 ;			PRINTFORML 不管%CALLNAME:MASTER%怎么劝说、%CALLNAME:TARGET%还是不肯喝酒…
 ;			SOURCE:反感 += 500
 ;			BASE:情緒 /= 2
 ;			TFLAG:好感度减少 = 1
 ;			TFLAG:193 = -1
 ;			RETURN 1
 ;		ENDIF
 ;	ELSE
 ;		GOTO LOOP
 ;	ENDIF
ENDIF

TRYCALLFORM EFFECT_酒データ{酒ID}(TARGET)
DOWNBASE:MASTER:気力 += 50
DOWNBASE:MASTER:体力 += 10

CALL DRUNKEN(MASTER,TFLAG:194)

CALL COM332_TPP_1

TIME += 30
RETURN 1

@COM332_TPP_1
#DIM 酒気増加量
#DIM 味補正
DOWNBASE:気力 += 10

;固定で獲得するソース
SOURCE:歓楽 = 500

CALL DRUNKEN(TARGET,TFLAG:194)

;連続実行時は反感が発生
SIF PREVCOM == SELECTCOM
	SOURCE:反感 = 100

;ABL:従順をみる
IF ABL:従順 <= 1
	SOURCE:歓楽 += (ABL:従順 * 30)
ELSEIF ABL:従順 <= 3
	SOURCE:歓楽 += 400 + (ABL:従順 * 30)
ELSEIF ABL:従順 <= 5
	SOURCE:歓楽 += 600 + (ABL:従順 * 30)
ELSEIF ABL:従順 <= 8
	SOURCE:歓楽 += 800 + (ABL:従順 * 50)
ELSEIF ABL:従順 <= 11
	SOURCE:歓楽 += 1000 + (ABL:従順 * 70)
ELSE
	SOURCE:歓楽 += 1500 + (ABL:従順 * 40)
ENDIF

;好感度をみる
IF CFLAG:2 <= 500
	SOURCE:歓楽 += CFLAG:2
ELSEIF CFLAG:2 <= 5000
	SOURCE:歓楽 += 700 + (CFLAG:2 - 500) / 3
ELSE
	SOURCE:歓楽 += 2500 + (CFLAG:2 - 5000) / 5
ENDIF
SIF SOURCE:歓楽 < 0
	SOURCE:歓楽 = 0

SOURCE:受動 = 200 + 100 * ABL:従順
SOURCE:征服 = 200 + 100 * ABL:施虐属性

IF TFLAG:193 == -1
	TIMES SOURCE:歓楽 , 0.10
	TIMES SOURCE:征服 , 0.50
	TIMES SOURCE:受動 , 0.50
ELSEIF TFLAG:193 == 0
	TIMES SOURCE:歓楽 , 1.00
	TIMES SOURCE:征服 , 1.00
	TIMES SOURCE:受動 , 1.00
ELSE
	TIMES SOURCE:歓楽 , 2.00
	TIMES SOURCE:征服 , 2.00
	TIMES SOURCE:受動 , 2.00
ENDIF

;味による補正
味補正 = ALCOHOL_TASTE(TFLAG:194)
IF TALENT:TARGET:酒耐性 == -2 && ALCOHOL_TASTE(TFLAG:194) < 15
	IF CFLAG:TARGET:不會喝酒 < 3
		味補正 /= 2
		PRINTFORML %CALLNAME:TARGET%喝了一小口就停下了
	ELSEIF CFLAG:TARGET:不會喝酒 < 5
		味補正 = 味補正 / 3 * 2
		PRINTFORML %CALLNAME:TARGET%似乎不像以前那様抵触飲酒了
	ELSE
		PRINTFORML %CALLNAME:TARGET%漂亮地喝光了杯里的酒
	ENDIF
ENDIF

SOURCE:歓楽 = SOURCE:歓楽 * 味補正 / 10
SOURCE:征服 = SOURCE:征服 * 味補正 / 10
SOURCE:受動 = SOURCE:受動 * 味補正 / 10

;信頼
TFLAG:98 = ALCOHOL_TASTE(TFLAG:194) / 10

IF ALCOHOL_TASTE(TFLAG:194) < 10
	PRINTFORMW 似乎不对%CALLNAME:TARGET%的口味的样子…
	IF TALENT:TARGET:酒耐性 == -2
		CFLAG:TARGET:不會喝酒 --
		TFLAG:好感度减少 = 1
		TFLAG:98 = -1
	ENDIF
ELSEIF ALCOHOL_TASTE(TFLAG:194) >= 15
	SELECTCASE TFLAG:194
		CASE 513	;一夜奇稻田の特殊文本
			PRINTFORM %CALLNAME:TARGET%对%ITEMNAME_TR(TFLAG:194)%好像莫名很中意
			SELECTCASE TALENT:TARGET:酒耐性
				CASE 3
					PRINTFORMW ，直喝了个直抒胸臆酣畅淋漓…
				CASE 2
					PRINTFORMW ，不住地品尝着…
				CASE 1
					PRINTFORMW ，一口闷了下去…
				CASEELSE
					PRINTFORMW …
			ENDSELECT
		CASEELSE
			PRINTFORMW %CALLNAME:TARGET%对%ITEMNAME_TR(TFLAG:194)%很中意的样子…
	ENDSELECT
	SIF CFLAG:TARGET:不會喝酒 < 5
		CFLAG:TARGET:不會喝酒 ++
	CALL KIGEN_CHANGE(TARGET,40,1)
ELSE
	PRINTFORMW %CALLNAME:TARGET%选择一脸淡然地将%ITEMNAME_TR(TFLAG:194)%喝了下去…
ENDIF

@K43_TONGYONGHEJIU
IF BASE:43:酒気 > MAXBASE:43:酒気 * 13 / 20 && !TCVAR:43:烂醉
    IF TALENT:恋慕 || TALENT:恋人
	    PRINTFORML 「...没想到我还有即将被%CALLNAME:MASTER%灌醉的那一天呢。不过，比起我，%CALLNAME:MASTER%明显也快撑不住了吧。」
	    PRINTFORMW 「呵呵，我大概是知道的哦...想着把我灌醉，好让我无暇顾及你对我的肆意妄为？」
	    PRINTFORML 「当然我并不会拒绝呢，%CALLNAME:MASTER%...陪你推杯换盏到这个地步，觉悟之类的，我其实早就做好了哦。」
		IF TFLAG:24 == 13 || TFLAG:24 == 33
	  	  PRINTFORML 「将美酒浇淋到我的乳肉和腰肢，甚至于将我两条大腿间的缝隙当作极佳的酒樽肆意吸吮...」
	  	  PRINTFORMW 「这些只有亲密恋人间才能做的“小游戏”，%CALLNAME:MASTER%肯定已经是跃跃欲试了吧，嗯？」 
		ELSE
	  	  PRINTFORML 「毕竟趁着酒意未消进行些不顾其他的爱抚和交合，这也算是，恋人之间情趣的一部分吧？」
	  	  PRINTFORMW 「当然，如果%CALLNAME:MASTER%本来只是想找我拼酒，那我也不会过多在意...不过，如果%CALLNAME:MASTER%真的有心...」 		
		ENDIF   
    ELSE
	    PRINTFORML 「唔呃...这种醉醺醺的感觉多久没有经历了...明明只是这些酒的话完全不用想那些的...」
		PRINTFORML 「而且还是在和%CALLNAME:MASTER%你喝酒的情况下...你该不会，是想对我图谋不轨吧？」
		PRINTFORMDW 说罢，放下酒杯的华扇便缩起了身子，瞪向%CALLNAME:MASTER%的眼神迷离中仍不乏警惕...   
    ENDIF
ELSEIF ALCOHOL_TASTE(TFLAG:194) < 10
    IF TALENT:恋慕 || TALENT:恋人
		PRINTFORML 「果然这种酒还是不怎么合我的口味呢...啊，%CALLNAME:MASTER%，不是在责备你啦。」
		PRINTFORMW 「毕竟每个人的口味都不一样，大概%CALLNAME:MASTER%也只是碰巧撞上我这样喜欢喝酒的仙人了吧。」
		PRINTFORML 「不过，既然我们两人都已经是这样的关系了，%CALLNAME:MASTER%最好也要在意一下我的爱好呢。」
		PRINTFORMW 「可以的话，至少找一些清酒来吧，这样才会有对酌该有的样子呢。」    
    ELSE
		PRINTFORML 「风味倒是独特...除了没有酒的味道。」
	    PRINTFORMW 「如果说是想找我对饮的话，还是试试找点正经的酒来吧？」      
    ENDIF	
ELSEIF ALCOHOL_TASTE(TFLAG:194) >= 15
    IF TALENT:恋慕 || TALENT:恋人	
		PRINTFORML 「果然还是这种酒喝起来才够尽兴啊。%CALLNAME:MASTER%，你的眼光还真是准呢。」
		PRINTFORMW 「专门为爱好酒的我准备的吗？呵呵，我的“另类”喜好在%CALLNAME:MASTER%眼里已经是习以为常了吗。」		
		PRINTFORML 「...嘛，如果可以，回头让你尝尝我家酒虫酿的酒吧？虽说酿的都是专门给我自己喝的酒，但绝对是上品呢。」
		PRINTFORMW 「毕竟也是...我托“那个人”专门调教出来的酒虫呢。——不过话说回来，你那边...」	
    ELSE
		PRINTFORML 「你还真是动心思了，竟然连这种酒都可以搞到。」
		PRINTFORMW 「%CALLNAME:MASTER%也想喝点吗？自便吧。」
    ENDIF 
ELSE
    IF TALENT:恋慕 || TALENT:恋人	
		PRINTFORML 「还是不怎么觉得这酒有什么特别的地方...无论从什么角度都显得有些上不去下不来。」
		PRINTFORMW 「不过如果是%CALLNAME:MASTER%觉得好喝的话...嗯？%CALLNAME:MASTER%原来也没怎么试过吗。」
		PRINTFORML 「正好我觉得这种酒大概是适合%CALLNAME:MASTER%饮用的类型呢...如何，想来一杯吗？」
		PRINTFORMW 「呵呵，一沾到这个你倒是莫名的兴奋...来，干一个吧。」     
    ELSE
		PRINTFORML 「嗯...也就那样吧，不好也不坏。」
		PRINTFORMW 「就是总感觉还是缺了点酒的意思...」    
    ENDIF 
ENDIF