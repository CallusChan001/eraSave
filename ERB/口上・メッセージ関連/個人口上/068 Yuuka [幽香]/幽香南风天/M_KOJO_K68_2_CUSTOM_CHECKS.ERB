;-------------------------------------------------
;CHECKS系接口的模板
;更新日期 2025年7月9日
;受@KOJO_CHECK统一调用的剧本侧干涉函数
;CHECK在原版仅有一个判定接口，即委托限制接口，被放在事件系模板中。CHECKS系接口就是从这个接口发展而来的。
;参考：ERB\口上・メッセージ関連\COMMON_KOJO.ERB
;@KOJO_MESSAGE_SEND - ERB\口上・メッセージ関連\KOJO_MESSAGE.ERB
;-------------------------------------------------
;来自并译自AnonTW，因加入逆推接口而启用
;2025年7月7日 - 第一版编者：狂气刘俊海
;-------------------------------------------------

;-------------------------------------------------
;自定义陷落条件
;YEARNING-思慕 LOVE-恋慕 FUCK BUDDY-炮友 LUST-爱欲
;-------------------------------------------------
;覆写判定
;RETURN=1，以自定义条件覆盖原版条件 =0，自定义条件与原版条件需要同时满足 =-1 禁止转变为该陷落状态
;-------------------------------------------------
@M_KOJO_幽香南风天_CHECK_K68_FALL_STATE_OVERRIDE(ARGS,ARG,ARG:1)
SELECTCASE ARGS
	CASE "YEARNING"

	CASE "LOVE"

	CASE "FUCK BUDDY"

	CASE "LUST"

ENDSELECT
RETURN 0

;-------------------------------------------------
;为角色设置自定义陷落条件
;RETURN 自定义条件的数量
;RESULT(S) 存储每个条件的结果及其描述文本
;-------------------------------------------------
;自定义陷落条件
;YEARNING-思慕 LOVE-恋慕 FUCK BUDDY-炮友 LUST-爱欲
;-------------------------------------------------
;-------------------------------------------------
@M_KOJO_幽香南风天_CHECK_K68_FALL_STATE(ARGS,ARG,ARG:1)
SELECTCASE ARGS
	CASE "YEARNING"
		RESULTS:1 = 其他条件达成后一整天没有见面
		RESULT:1 = CFLAG:68:1401!=0
		RESULTS:2 = 幽香不再抵触你
		RESULT:2 = CFLAG:68:1001>=5
		;RESULTS:3 = 
		;RESULT: 3 =
		RETURN 2

	CASE "LOVE"
		RESULTS:1 = 幽香认可你作为花田的一份子
		RESULT:1 = CFLAG:68:1001>=10
		
		RETURN 1

	CASE "FUCK BUDDY"
		RESULTS:1 = 和幽香做过爱,且她允许你的变态想法
		RESULT:1 = CFLAG:68:1103>=2
		RESULTS:2 = 幽香不再抵触你
		RESULT:2 = CFLAG:68:1001>=5
		RETURN 2

	CASE "LUST"
		RESULTS:1 = 幽香认可你作为花田的一份子
		RESULT:1 = CFLAG:68:1001>=10
	
		RETURN 1

ENDSELECT
RETURN 0

;-------------------------------------------------
;自定义指令控制
;-------------------------------------------------
;返回每个可能的CCOM的修改后权重
;ARG是CCOM编号，ARG:1是原始权重
;返回0表示不改变，-1表示完全禁用
;-------------------------------------------------
@M_KOJO_幽香南风天_CHECK_K68_CCOM_ORDER(ARGS,ARG,ARG:1)
SELECTCASE ARG
	CASE 3
		RETURN ARG:1 * 3
ENDSELECT
RETURN 0
;-------------------------------------------------
;自定义自慰
;决定@ONABARE中的自慰是否限制玩弄哪个洞
;返回0表示使用原版判定，1指定阴道，2指定肛门
;-------------------------------------------------
@M_KOJO_幽香南风天_CHECK_K68_ONABARE_HOLE(ARGS,ARG,ARG:1)

RETURN 0
;-------------------------------------------------
;自定义逆推
;@诶嘿嘿中特殊事件 - ERB\イベント関連\EVENTCOMEND2.ERB
;来自于蛇版4.973-关于逆推的修改
;-------------------------------------------------
;ARGS=OVERRIDE 覆写判定
;RETURN =1 以自定义条件判定角色夺取主导成功 =0 采用原版的概率机制 =-1 以自定义条件判定禁止角色夺取主导
;ARGS=ABLE 在原版的概率机制上引入更多条件或者重写计算式
;作用有限，需要重写关于逆推可行性判定请使用覆写分支
;ARG=原本计算出的夺主导权概率 ※ARGS=OVERRIDE时不能获得该参数
;概率判定 格式为：1/概率 角色越强势概率越高→分母越小
;RETURN =正值 则返回新的夺主导权概率 若=0或负数 则采用原版的概率机制
;-------------------------------------------------
@M_KOJO_幽香南风天_CHECK_K68_OSHITAOSARE(ARGS,ARG,ARG:1)
#DIM 夺主导权概率
SELECTCASE ARGS
	CASE "OVERRIDE"
		IF CFLAG:积攒度 > 500&&CFLAG:68:1001>=5
			RETURN 1
		ELSEIF CFLAG:积攒度 > 700&&GET_TARGETNUM() == 1
			RETURN 1
		ELSE
			RETURN -1
		ENDIF
	CASE "ABLE"
		夺主导权概率 = ARG
		夺主导权概率 += ABL:MASTER:戦闘能力 - ABL:TARGET:戦闘能力
		夺主导权概率 += TALENT:MASTER:体型 - TALENT:TARGET:体型
		RETURN MAX(夺主导权概率,1)
ENDSELECT
;-------------------------------------------------
;自定义工作
;-------------------------------------------------
;完全遵循@仕事内容設定和@JOBMOVE两函数的结构
;@ERB\MOVEMENTS\JOB_仕事内容.ERB
;REUTRN 1以启用自定义内容
;-------------------------------------------------
@M_KOJO_幽香南风天_CHECK_K68_JOB(ARGS,ARG,ARG:1)
SELECTCASE ARGS
	CASE "SETUP"
		;工作的设定
		IF TIME:5 < 4 && DAY:3 % 7 == 0
			;天气好在花田
			MAXBASE:ARG:工作量 = 600 * 1000
			IF TIME:0<=690
				;11点半
				TCVAR:ARG:工作開始 = CLOCK_TO_TIME( 9, 0)
				TCVAR:ARG:工作結束 = CLOCK_TO_TIME(11, 0)
				IF once("上午场天气检测")
				ELSE
					IF TIME:5 >= 4
						TIME:5 = 0
						WIND_VELOCITY = 0
						IF CFLAG:MASTER:300 == CFLAG:ARG:300
							PRINTFORMW 令人担忧的乌云在太阳花田的太空附近游荡
							PRINTFORMDL 你看了看还在欢笑着的大家
							PRINTFORMDL （要不要提醒一下把宴会搬到梦幻馆里呢？若是下起大雨……）
							PRINTFORML 「别担心，花田可是我风见幽香的地盘」
							PRINTFORMDL 幽香给自己的茶杯沏满七分，慢悠悠地起身拿起阳伞，朝天空一指
							PRINTFORMDL 强烈的能量弹迸发而去在天穹爆烈，驱散了苍穹上的云
							PRINTFORML 「嗯…茶的温度正好呢」
							IF RAND:3==1 || FIRSTTIME("幽香解释")
								PRINTFORMDL 『既然能改变天气，为什么以前不用，还要改到梦幻馆里？』
								PRINTFORML 「一味地滥用只会扭曲人，若非中途出现，顺其自然不好吗？」
							ENDIF
							PRINTFORML 太阳花田的边缘亮了起来，攀延空中的魔法纹路在天穹形成一个半圆
							PRINTFORML 「后续就由魔法阵出手吧，作为花田，有温室也很正常吧」
							CALL yuka_AA("饮茶")
						ENDIF
					ENDIF
				ENDIF
			ELSE
				TCVAR:ARG:工作開始 = CLOCK_TO_TIME( 12, 0)
				TCVAR:ARG:工作結束 = CLOCK_TO_TIME(17, 0)
				IF once("下午场天气检测")
				ELSE
					IF TIME:5 >= 4
						TIME:5 = 0
						WIND_VELOCITY = 0
						IF CFLAG:MASTER:300 == CFLAG:ARG:300
							PRINTFORMW 令人担忧的乌云在太阳花田的太空附近游荡
							PRINTFORMDL 你看了看还在欢笑着的大家
							PRINTFORMDL （要不要提醒一下把宴会搬到梦幻馆里呢？若是下起大雨……）
							PRINTFORML 「别担心，花田可是我风见幽香的地盘」
							PRINTFORMDL 幽香给自己的茶杯沏满七分，慢悠悠地起身拿起阳伞，朝天空一指
							PRINTFORMDL 强烈的能量弹迸发而去在天穹爆烈，驱散了苍穹上的云
							PRINTFORML 「嗯…茶的温度正好呢」
							IF RAND:3==1 || FIRSTTIME("幽香解释")
								PRINTFORMDL 『既然能改变天气，为什么以前不用，还要改到梦幻馆里？』
								PRINTFORML 「一味地滥用只会扭曲人，若非中途出现，顺其自然不好吗？」
							ENDIF
							PRINTFORML 太阳花田的边缘亮了起来，攀延空中的魔法纹路在天穹形成一个半圆
							PRINTFORML 「后续就由魔法阵出手吧，作为花田，有温室也很正常吧」
						ENDIF
					ENDIF
				ENDIF
			ENDIF
			CFLAG:ARG:職場 = P438太陽花田
			SIF CFLAG:68:1001<=10
				TCVAR:ARG:沒法幫忙 = 1
			CFLAG:ARG:職種 = JOB_家事
			TCVAR:ARG:工资 = 0
		ELSEIF TIME:5 >= 4 && DAY:3 % 7 == 0
			;天气差在梦幻馆
			MAXBASE:ARG:工作量 = 600 * 1000
			IF TIME:0<=690
				;11点半
				TCVAR:ARG:工作開始 = CLOCK_TO_TIME( 9, 0)
				TCVAR:ARG:工作結束 = CLOCK_TO_TIME(11, 0)
			ELSE
				TCVAR:ARG:工作開始 = CLOCK_TO_TIME( 12, 0)
				TCVAR:ARG:工作結束 = CLOCK_TO_TIME(17, 0)
			ENDIF
			CFLAG:ARG:職場 = P465大堂
			SIF CFLAG:68:1001<=10
				TCVAR:ARG:沒法幫忙 = 1
			CFLAG:ARG:職種 = JOB_家事
			TCVAR:ARG:工资 = 0
		ELSE
			MAXBASE:ARG:工作量 = 600 * 4
			TCVAR:ARG:工作開始 = CLOCK_TO_TIME( 8, 0)
			TCVAR:ARG:工作結束 = CLOCK_TO_TIME(11, 0)
			CFLAG:ARG:職場 = P438太陽花田
			CFLAG:ARG:職種 = JOB_家事
			TCVAR:ARG:工资 = 2
		ENDIF
	CASE "MOVE"
		;工作的命名
		IF (DAY:3%7==0)
			CUSTOM_JOB_DESC:ARG:0 = 主持花田茶会
		ELSE
			CUSTOM_JOB_DESC:ARG:0 = 打理花田
		ENDIF
ENDSELECT
RETURN 1

;CFLAG:350 職種（40,清掃　41,会話　42,戦闘　43,教養　44,料理　45,音楽 46,玩耍 47,商売中（沒法幫忙） 48,宴会準備 49,宴会参加 50,宴会片づけ 51,宴会後の酔い 52,女子会
;TCVAR:沒法幫忙 =1 沒法幫忙 =2 手伝っても早くは終わらない
;-------------------------------------------------
;自定义移动倾向以及固有料理
;@ERB\キャラデータ\Chara_data_X_xxxxx.ERB
;-------------------------------------------------
;料理部分，请完全遵循CharaData的格式
;移动部分与CharaData有格式差异，请仔细参考样例
;-------------------------------------------------

@M_KOJO_幽香南风天_CHECK_K68_CHARADATA(ARGS,ARG,ARG:1)
SELECTCASE ARGS
	CASE "SPECIAL_MENU"
		DISH_NAME = 向日葵华夫饼
		RESULTS = 甜点
		CALL 材料設定("甜味料")
		DISH_TASTE = 洋食/卵/牛奶/甜/丰盛/濃厚/温暖/夏物/芸術的/松脆/夢幻風/
		DISH_COMMENT = 外表像向日葵一样的可爱华夫饼，松软可口，有着和设计者初衷一样的甜蜜\n幽香的茶会甜品位常客，常用来安抚玩闹归来内心不能平静的孩子们
		RETURN 1
	CASE "MOVE"
		SELECTCASE ARG
			CASE 1
				;MOVE-1依附移动:依赖某一角色的移动行为，并总是试图移动到与他们相同的位置
				;如果返回值一个有效的角色编号，将依附该角色
				;如果返回0，将使用原版的数值
				;如果返回-1，将忽略原版的数值
				;如果RESULT:1-3被设置，但未设计返回值/RESULT:0/RESULT，将开启对等连动
				;所谓的对等连动，本质上是一种特殊的依附移动；在三个可能的连动对象中，总是会试图选择[恋慕]状态列表中第一个找到的角色，再是[思慕]列表中的第一个，最后是编号顺序中第一个找到的角色
				RETURN 0
			CASE 3
				;move-3生活时间补正:增加非睡眠时间
				;如果返回1，将使用自定义数值）不然原版数值将覆盖赋值
				;如果返回0，将使用原版的数值
				;如果返回-1，则什么也不会发生
				
				RETURN 0
			CASE 4
				;move-4据点地图中的移动倾向：（±10 = 倾向去/不容易去, -100 = 绝对不会去）
				;细分为停留概率和移动概率两类，可以分别赋值，也可以按原版那样用同一个值处理
				;如果返回1，将覆盖原版数值，以RESULT:1/RESULT:2作为停留概率和移动概率，如果没有RESULT:2则用RESULT:1代替
				;如果返回0，将使用原版的数值
				;如果返回-1，将忽略原版的数值
				
				RETURN 0
			CASE 7
				;move-7小地图中的移动倾向：判定只有能否出现在该区域
				;如果返回1，则能出现在该区域
				;如果返回0，将使用该区域的原版数值
				;如果返回-1，将忽略该区域的原版数值
				
				RETURN 0
			CASE 8
				;move-8引力点：设置此值的角色将始终尝试移动到MAIN_MAP上的此位置
				;如果返回1，将使用自定义数值）不然原版数值将覆盖赋值
				;如果返回0，将使用原版的数值
				;如果返回-1，则什么也不会发生
				IF DAY:3 % 7 == 0 && TIME:5 < 4&&(660>=TIME:0&&TIME:0>=540)
					TCVAR:引力点 =P438太陽花田
				ELSEIF DAY:3 % 7 == 0 && TIME:5 < 4&&(1020>=TIME:0&&TIME:0>=720)
					TCVAR:引力点 =P438太陽花田
				ELSEIF DAY:3 % 7 == 0&& TIME:5>= 4&&(660>=TIME:0&&TIME:0>=540)
					;在秋月18号，将不惜一切代价尝试访问幽香卧室
					TCVAR:引力点 = P465大堂
				ELSEIF	DAY:3 % 7 == 0&& TIME:5>= 4&&(1020>=TIME:0&&TIME:0>=720)
					TCVAR:引力点 = P465大堂
				ENDIF
				RETURN 1 ;覆盖默认值
		ENDSELECT
ENDSELECT

