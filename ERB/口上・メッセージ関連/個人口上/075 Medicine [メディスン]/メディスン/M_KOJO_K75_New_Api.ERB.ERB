;确定环境为4.972，为匹配CHECK模板的更新而翻译自of_new_kojo_api.ERB
;================================
;这些函数可以由剧本进行设置，但 custom_button_name、custom_talent 等变量是角色变量，
;如果存在多个剧本，注意修改成自己的ID，请注意。

;SUCCESS的通用版
;注意，只有当COM对应的SUCCESS函数不存在，它才将被调用
;你可以用它在COM之前进行一些数据处理
;@M_KOJO_XXX_SUCCESS_KX_GENERAL

;EXTRASOURCE的通用版，同上
;@M_KOJO_XXX_EXTRASOURCE_SCOM_KX_GENERAL
;@M_KOJO_XXX_EXTRASOURCE_COM_KX_GENERAL

;================================
;自定义商店按钮
;y是按钮的ID，对应0~9
;使用时请移除SKIPSTART~SKIPEND。
;================================
[SKIPSTART]
;如果RETURN 1，按钮就会显示
@KOJO_XXX_CUSTOM_BUTTON_CONDITION_KX_Y
custom_button_name:XX:Y = 选项Y
RETURN 1

;如果按钮被点击
@KOJO_XXX_CUSTOM_BUTTON_KX_Y

RETURN 1
[SKIPEND]

;================================
;自定义素质
;使用时请移除SKIPSTART~SKIPEND。
;================================
[SKIPSTART]
@KOJO_XXX_CUSTOM_TALENT_SET_KX
;Z是素质ID，对应0~29
;如果此变量不为0则显示
CUSTOM_TALENT:XX:Z = 1
;素质名
CUSTOM_TALENT_NAME:XX:Z = 色情素质
;(省略可)自定义素质的显示颜色 示例是红色
CUSTOM_TALENT_COLOR:XX:Z = 0xFF0000
;(省略可)显示的类别 1/种族 2/性特征 3/身体特征 4/精神特征 5/技术特征 其他为“其他”
CUSTOM_TALENT_TYPE:XX:Z = 2
[SKIPEND]

;================================
;自定义指令，可设置0~29号
;使用时请移除SKIPSTART~SKIPEND。
;================================

;身体改造
@KOJO_COM_NAME_K75_0
#LOCALSIZE 1
#LOCALSSIZE 1
RESULTS = 身体改造

;指令使用条件，与通常的@COM_ABLE函数相同，如果RETURN 1则指令显示为可执行
@KOJO_COM_ABLE_K75_0
#LOCALSIZE 1
#LOCALSSIZE 1
;采用和换衣一模一样的可能性判定
SIF !TFLAG:100
	RETURN 0
;一括管理
SIF GLOBAL_COMABLE(429)
	RETURN RESULT
;私室設定
SIF (CFLAG:MASTER:現在位置 != CFLAG:MASTER:311) && (CFLAG:現在位置 != CFLAG:311)
	RETURN 0
SIF !GETBIT(CFLAG:TARGET:既成事實, 1) && TARGET
	RETURN 0
SIF CFLAG:诶嘿嘿
	RETURN 0
SIF CFLAG:1222 != 2
	RETURN 0
RETURN 1

;指令执行内容。描述经验值和参数的增减，与通常的@COM函数相同
;RETURN 1=执行指令 / RETURN 0=指令失败了（函数意义：跳过@SOURCE_CHECK的SOURCE计算阶段) / RETURN -1=指令不执行（函数意义：将直接结束@SOURCE_CHECK）
@KOJO_COM_K75_0
#LOCALSIZE 1
#LOCALSSIZE 1
DRAWLINE
IF BASE:MASTER:体力 >= MAXBASE:体力 / 2 && BASE:MASTER:気力 >= MAXBASE:気力 / 2 && BASE:MASTER:精力 >= MAXBASE:MASTER:精力 / 2
	PRINTFORMDL 要为梅蒂欣提供生命力来改造她的肉体吗？
	PRINTFORML （需要暂时消耗你的生命力，数值为梅蒂欣最大体力·气力的一半和你最大精力的一半）
	CALL ASK_M(@"改变%CALLNAME:TARGET%的肉体",1,"保持现状就可以了",1)
	IF !RESULT
		PRINTL
		PRINTFORMDL [0] 胸围变大
		PRINTFORMDL [1] 胸围缩小
		PRINTFORMDL [2] 改变小穴的湿润体质
		PRINTFORMDL [3] 长出兽耳
		PRINTFORMDL [4] 还是算了吧
		$INPUT_OPPAI_SIZE
		INPUT
		IF !RESULT
			IF TALENT:TARGET:胸圍  == 2
				PRINTFORMDL 不能变得更大了…
				GOTO INPUT_OPPAI_SIZE
			ELSE
				PRINTFORMDL 梅蒂欣的胸围尺寸上了一个台阶…
				IF TALENT:TARGET:胸圍  == 1
					TALENT:TARGET:胸圍  = 2
				ELSEIF TALENT:TARGET:胸圍  == 0
					TALENT:TARGET:胸圍  = 1
				ELSEIF TALENT:TARGET:胸圍  == -1
					TALENT:TARGET:胸圍  = 0
				ELSEIF TALENT:TARGET:胸圍  == -2
					TALENT:TARGET:胸圍  = -1
				ENDIF
			ENDIF
		ELSEIF RESULT == 1
			IF TALENT:TARGET:胸圍  == -2
				PRINTFORMDL 不能变得更小了…
				GOTO INPUT_OPPAI_SIZE
			ELSE
				PRINTFORMDL 梅蒂欣的胸围尺寸下了一个台阶…
				IF TALENT:TARGET:胸圍  == 2
					TALENT:TARGET:胸圍  = 1
				ELSEIF TALENT:TARGET:胸圍  == 1
					TALENT:TARGET:胸圍  = 0
				ELSEIF TALENT:TARGET:胸圍  == 0
					TALENT:TARGET:胸圍  = -1
				ELSEIF TALENT:TARGET:胸圍  == -1
					TALENT:TARGET:胸圍  = -2
				ENDIF
			ENDIF
		ELSEIF RESULT == 2
			PRINTFORMDL 将梅蒂欣的阴道…
			CALL ASK_M("变得很难湿", 1,"变得适度地容易湿", 1,"变得马上就能够濡湿", 1)
			IF TALENT:75:弄濕難易 == RESULT - 1
				PRINTFORMDL 保持原样了
				GOTO INPUT_OPPAI_SIZE
			ENDIF
			SELECTCASE RESULT
			CASE 0
				PRINTFORMDL 梅蒂欣的阴道变得很难湿…
			CASE 1
				PRINTFORMDL 梅蒂欣的阴道变得适度地容易湿…
			CASE 2
				PRINTFORMDL 梅蒂欣的阴道变得更容易弄湿…
			ENDSELECT
			TALENT:75:弄濕難易 = RESULT - 1
		ELSEIF RESULT == 3
			PRINTFORMDL 想要哪种兽耳？
			CALL ASK_M("兔耳", 1,"犬耳", 1,"猫耳", 1)
			SELECTCASE RESULT
			CASE 0
				PRINTFORMDL 梅蒂欣的头上长出了兔耳…
				TALENT:75:動物耳 = 2
			CASE 1
				PRINTFORMDL 梅蒂欣的头上长出了犬耳…
				TALENT:75:動物耳 = 3
			CASE 2
				PRINTFORMDL 梅蒂欣的头上长出了猫耳…
				TALENT:75:動物耳 = 4
			ENDSELECT
		ELSEIF RESULT == 4
			PRINTFORMDL 现在就先放弃吧…
			GOTO 放弃
		ELSE
			GOTO INPUT_OPPAI_SIZE
		ENDIF
		WAIT
		CALL D_LINE
		PRINTFORMDW 梅蒂欣顺从地将衣物全部脱下，露出犹如人偶一般完美，却有人偶无法比拟的柔软和温度的娇躯，紧紧地搂住%CALLNAME:MASTER%
		PRINTFORMDL 两人感受到的不仅是来自双方的体温，两人的生命力本就通过境界回路链接在一起
		PRINTFORMDW 现在更是赤裸的肌肤相亲，让生命力实实在在地流动交融，%CALLNAME:MASTER%感到一种生命调和的幸福感……
		PRINTFORMDL
		CALL BUFF_BASE(0,0,-MAXBASE:体力 / 2,1)
		CALL BUFF_BASE(0,1,-MAXBASE:気力 / 2,1)
		CALL BUFF_BASE(0,6,-MAXBASE:MASTER:精力 / 2,1)
		CALL COLORMESSAGE(@"通过转变生命力、%CALLNAME:MASTER%改变了梅蒂欣的身体构造…",C_YELLOW,2,1)
		TIME += 20
		TFLAG:193 = 1
	ELSE
		$放弃
		TFLAG:193 = 0
		RETURN 0
	ENDIF
ELSE
	PRINTFORMDL 精气神不足的情况下转化生命力太危险了…休息好了再来吧
	TFLAG:193 = 0
	RETURN 0
ENDIF

;固定で獲得するソース
SOURCE:歓楽 = 400
SOURCE:情愛 = 400
SOURCE:欲情 = 100
SOURCE:恭順 = 400
SOURCE:露出 = 40

;ABL:親密をみる
IF ABL:親密 <= 1
	SOURCE:情愛 += (ABL:親密 * 30)
ELSEIF ABL:親密 <= 3
	SOURCE:歓楽 += 100 + (ABL:親密 * 40)
	SOURCE:情愛 += 200 + (ABL:親密 * 30)
	SOURCE:恭順 += 200 + (ABL:親密 * 30)
	SOURCE:欲情 += 200 / 4 + (ABL:親密 * 30 / 4)
ELSEIF ABL:親密 <= 5
	SOURCE:歓楽 += 400 + (ABL:親密 * 50)
	SOURCE:情愛 += 400 + (ABL:親密 * 30)
	SOURCE:恭順 += 400 + (ABL:親密 * 30)
	SOURCE:欲情 += 400 / 4 + (ABL:親密 * 30 / 4)
ELSEIF ABL:親密 <= 8
	SOURCE:歓楽 += 700 + (ABL:親密 * 60)
	SOURCE:情愛 += 600 + (ABL:親密 * 40)
	SOURCE:恭順 += 600 + (ABL:親密 * 40)
	SOURCE:欲情 += 600 / 4 + (ABL:親密 * 40 / 4)
ELSEIF ABL:親密 <= 11
	SOURCE:歓楽 += 1200 + (ABL:親密 * 80)
	SOURCE:情愛 += 800 + (ABL:親密 * 40)
	SOURCE:恭順 += 800 + (ABL:親密 * 40)
	SOURCE:欲情 += 800 / 4 + (ABL:親密 * 40 / 4)
ELSE
	SOURCE:歓楽 += 2000 + (ABL:親密 * 50)
	SOURCE:情愛 += 1800 + (ABL:親密 * 20)
	SOURCE:恭順 += 1800 + (ABL:親密 * 20)
	SOURCE:欲情 += 1800 / 4 + (ABL:親密 * 20 / 4)
ENDIF

;好感度をみる
IF CFLAG:2 <= 500
	SOURCE:歓楽 += CFLAG:2
ELSEIF CFLAG:2 <= 5000
	SOURCE:歓楽 += 500 + (CFLAG:2 - 500) / 3
ELSE
	SOURCE:歓楽 += 2000 + (CFLAG:2 - 5000) / 5
ENDIF
SIF SOURCE:歓楽 < 0
	SOURCE:歓楽 = 0

LOCAL = 0
;親密が低いと好感度低下
IF ABL:親密 == 0
	LOCAL -= 3
ELSEIF ABL:親密 == 1
	LOCAL -= 2
ELSEIF ABL:親密 == 2
	LOCAL -= 1
ENDIF
;好感度が低いと好感度低下
IF CFLAG:2 <= 50
	LOCAL -= 3
ELSEIF CFLAG:2 <= 100
	LOCAL -= 2
ELSEIF CFLAG:2 <= 250
	LOCAL -= 1
ENDIF


SOURCE:受動 = 100 + 200 * ABL:従順

;好感度変化
TFLAG:97 += LOCAL

TFLAG:理性削り = 1
TFLAG:情緒BONUS = 400
CFLAG:溜まってる度 += 500
BASE:MASTER:勃起 = MAXBASE:MASTER:勃起

RETURN 1

;指令消息。描述指令的情景文本，
;W的值是(270 + Y)。SELECTCOM/PREVCOM会代入此值
@M_KOJO_MESSAGE_COM_K75_270
#LOCALSIZE 1
#LOCALSSIZE 1
IF TFLAG:193 == 0
	PRINTFORML 「%CALLNAME:TARGET%、不要太勉强哦，你的生命力就是人家的生命力呢」
	PRINTFORMW 「请永远陪在咱身边吧…」
ELSE
	PRINTFORML 「哈、哈…我感受到你在我的体内，又被你抱在怀里，好像被%CALLNAME:MASTER%包裹住、无比的安心」
	STRDATA LOCALS
		DATAFORM 「谢谢你%CALLNAME:MASTER%，我、爱你HPH」
		DATAFORM 「%CALLNAME:MASTER%，我、是你的HPH」
		DATAFORM 「%CALLNAME:MASTER%…HPH%CALLNAME:MASTER%%CALLNAME:MASTER%HPH」
	ENDDATA
	CALL HPH_PRINT,LOCALS,"L"
	IF RAND:2
		PRINTFORMDW 身体有些疲软的梅蒂欣在耳畔吐着甜蜜的喘息
	ELSE
		PRINTFORMDW 身体滚烫的梅蒂欣用充满爱意的眼神注视着%CALLNAME:MASTER%
	ENDIF
	CALL COLORMESSAGE(@"！肌肤接触令%CALLNAME:MASTER%和%CALLNAME:TARGET%都动情了！",C_YELLOW,2,1)
ENDIF
RETURN 1

@KOJO_COM_Counter不发_K75_0
#LOCALSIZE 1
#LOCALSSIZE 1
RETURN 1
[SKIPSTART]
;指令名
@KOJO_XXX_COM_NAME_KX_Y
	RESULTS = com_name

;指令使用条件，与通常的@COM_ABLE函数相同，如果RETURN 1则指令显示为可执行
@KOJO_XXX_COM_ABLE_KX_Y
	RETURN 1

;指令执行内容。描述经验值和参数的增减，与通常的@COM函数相同
;RETURN 1=执行指令 / RETURN 0=指令失败了（函数意义：跳过@SOURCE_CHECK的SOURCE计算阶段) / RETURN -1=指令不执行（函数意义：将直接结束@SOURCE_CHECK）
@KOJO_XXX_COM_KX_Y
	RETURN 1

;指令消息。描述指令的情景文本，
;W的值是(270 + Y)。SELECTCOM/PREVCOM会代入此值
@M_KOJO_XXX_MESSAGE_COM_KX_W
	RETURN 1

;指令能否执行的显性判定计算文本，与通常的@CAN_COM函数相同
;仅当您想为自定义诶嘿嘿指令添加成功/失败判断时才取消注释
;你也可以不写
;@KOJO_XXX_CAN_COM_KX_Y(skipFlag)
;	#DIM skipFlag
;	SKIPDISP skipFlag
;	SKIPDISP 0



;================================
;游戏加载时自动更新
;如果不通过版本管理口上更新，可以忽略
;================================
;@KOJO_XXX_VERSION_KX
	;返回当前口上的版本号
	; RETURN now_version

;当存档的CFLAG:kojo_version小于KOJO_XXX_VERSION_KX时加载更新
;@KOJO_XXX_VERSION_UPDATE_KX
	;
	; RETURN now_version
[SKIPEND]