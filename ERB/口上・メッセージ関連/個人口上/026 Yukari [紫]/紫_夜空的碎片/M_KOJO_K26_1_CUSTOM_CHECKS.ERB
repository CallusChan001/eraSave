;-------------------------------------------------
;CHECKS系接口的模板
;更新日期 2025年7月9日
;受@KOJO_CHECK统一调用的剧本侧干涉函数
;CHECK在原版仅有一个判定接口，即委托限制接口，被放在事件系模板中。CHECKS系接口就是从这个接口发展而来的。
;参考：ERB\口上・メッセージ関連\COMMON_KOJO.ERB
;@KOJO_MESSAGE_SEND - ERB\口上・メッセージ関連\KOJO_MESSAGE.ERB
;-------------------------------------------------
;来自并译自AnonTW，因加入逆推接口而启用
;2025年7月7日 - 第一版编者：狂气刘俊海
;-------------------------------------------------

;-------------------------------------------------
;自定义陷落条件
;YEARNING-思慕 LOVE-恋慕 FUCK BUDDY-炮友 LUST-爱欲
;-------------------------------------------------
;覆写判定
;RETURN=1，以自定义条件覆盖原版条件 =0，自定义条件与原版条件需要同时满足 =-1 禁止转变为该陷落状态
;-------------------------------------------------
@M_KOJO_自制_CHECK_K26_FALL_STATE_OVERRIDE(ARGS,ARG,ARG:1)
SELECTCASE ARGS
	CASE "YEARNING"
		RETURN 0
	CASE "LOVE"
		RETURN 1
	CASE "FUCK BUDDY"
		RETURN 1
	CASE "LUST"
		RETURN 1
ENDSELECT
RETURN 0
;-------------------------------------------------
;为角色设置自定义陷落条件
;RETURN 自定义条件的数量
;RESULT(S) 存储每个条件的结果及其描述文本
;-------------------------------------------------
@M_KOJO_自制_CHECK_K26_FALL_STATE(ARGS,ARG,ARG:1)
SELECTCASE ARGS
	CASE "YEARNING"
		RESULTS:1 = 放下戒备的心/好感度达到1000
		RESULT:1 = CFLAG:26:2 >= 1000
		RESULTS:2 = 日常接触感到轻松自在/你的教养达到3级
		RESULT:2 = ABL:MASTER:教養 > 2
		RESULTS:3 = 不会带来无聊与枯燥/你的聊天技巧达到3级
		RESULT:3 = ABL:MASTER:話術技能 > 2
		RETURN 3
	CASE "LOVE"
		RESULTS:1 = 愿意对你敞开心扉/信赖度达到800
		RESULT:1 = CFLAG:26:4 >= 800
		RESULTS:2 = 无法忘记你的存在/好感度达到5000
		RESULT:2 = CFLAG:26:2 >= 5000
		RESULTS:3 = 想要将你变成生命的一部分/献出初吻
		RESULT:3 = GETBIT(CFLAG:1, 0)
		RESULTS:4 = 我  爱  你/亲密达到10级
		RESULT:4 = ABL:26:9 >= 10
		RETURN 4
	CASE "FUCK BUDDY"
		RESULTS:1 = 通往这条时间线的方式已被境界抹除
		RESULT:1 = 0
		RETURN 1
	CASE "LUST"
		RESULTS:1 = 我们的关系 不应是这样
		RESULT:1 = 0
		RETURN 1
ENDSELECT
RETURN 0
[SKIPSTART]
;-------------------------------------------------
;自定义指令控制
;-------------------------------------------------
;返回每个可能的CCOM的修改后权重
;ARG是CCOM编号，ARG:1是原始权重
;返回0表示不改变，-1表示完全禁用
;-------------------------------------------------
@M_KOJO_XXX_CHECK_KX_CCOM_ORDER(ARGS,ARG,ARG:1)
SELECTCASE ARG
	CASE 3
		RETURN ARG:1 * 3
ENDSELECT
RETURN 0
;-------------------------------------------------
;自定义自慰
;决定@ONABARE中的自慰是否限制玩弄哪个洞
;返回0表示使用原版判定，1指定阴道，2指定肛门
;-------------------------------------------------
@M_KOJO_XXX_CHECK_KX_ONABARE_HOLE(ARGS,ARG,ARG:1)
SIF TALENT:処女
	RETURN 2

RETURN 0
;-------------------------------------------------
;自定义逆推
;@诶嘿嘿中特殊事件 - ERB\イベント関連\EVENTCOMEND2.ERB
;来自于蛇版4.973-关于逆推的修改
;-------------------------------------------------
;ARGS=OVERRIDE 覆写判定
;RETURN =1 以自定义条件判定角色夺取主导成功 =0 采用原版的概率机制 =-1 以自定义条件判定禁止角色夺取主导
;ARGS=ABLE 在原版的概率机制上引入更多条件或者重写计算式
;作用有限，需要重写关于逆推可行性判定请使用覆写分支
;ARG=原本计算出的夺主导权概率 ※ARGS=OVERRIDE时不能获得该参数
;概率判定 格式为：1/概率 角色越强势概率越高→分母越小
;RETURN =正值 则返回新的夺主导权概率 若=0或负数 则采用原版的概率机制
;-------------------------------------------------
@M_KOJO_XXX_CHECK_KX_OSHITAOSARE(ARGS,ARG,ARG:1)
#DIM 夺主导权概率
SELECTCASE ARGS
	CASE "OVERRIDE"
		IF CFLAG:积攒度 > 700
			RETURN 1
		ELSEIF CFLAG:积攒度 > 500
			RETURN 0
		ELSE
			RETURN -1
		ENDIF
	CASE "ABLE"
		夺主导权概率 = ARG
		夺主导权概率 += ABL:MASTER:戦闘能力 - ABL:TARGET:戦闘能力
		夺主导权概率 += TALENT:MASTER:体型 - TALENT:TARGET:体型
		RETURN MAX(夺主导权概率,1)
ENDSELECT
;-------------------------------------------------
;自定义工作
;-------------------------------------------------
;完全遵循@仕事内容設定和@JOBMOVE两函数的结构
;@ERB\MOVEMENTS\JOB_仕事内容.ERB
;REUTRN 1以启用自定义内容
;-------------------------------------------------
@M_KOJO_XXX_CHECK_KX_JOB(ARGS,ARG,ARG:1)
SELECTCASE ARGS
	CASE "SETUP"

	CASE "MOVE"

ENDSELECT
RETURN 0

;-------------------------------------------------
;自定义移动倾向以及固有料理
;@ERB\キャラデータ\Chara_data_X_xxxxx.ERB
;-------------------------------------------------
;料理部分，请完全遵循CharaData的格式
;移动部分与CharaData有格式差异，请仔细参考样例
;-------------------------------------------------

@M_KOJO_XXX_CHECK_KX_CHARADATA(ARGS,ARG,ARG:1)
SELECTCASE ARGS
	CASE "SPECIAL_MENU"
		DISH_NAME = 红白馒头
		RESULTS = 甜点
		CALL 材料設定("甜味料")
		DISH_TASTE = 和食/饅頭/甜/上品/芸術的/软糯的/祝福/
		DISH_COMMENT = 庆祝喜事时食用的喜庆馒头。具有[祝福]的效果。
		RETURN 1
	CASE "MOVE"
		SELECTCASE ARG
			CASE 1
				;MOVE-1依附移动:依赖某一角色的移动行为，并总是试图移动到与他们相同的位置
				;如果返回值一个有效的角色编号，将依附该角色
				;如果返回0，将使用原版的数值
				;如果返回-1，将忽略原版的数值
				;如果RESULT:1-3被设置，但未设计返回值/RESULT:0/RESULT，将开启对等连动
				;所谓的对等连动，本质上是一种特殊的依附移动；在三个可能的连动对象中，总是会试图选择[恋慕]状态列表中第一个找到的角色，再是[思慕]列表中的第一个，最后是编号顺序中第一个找到的角色
				IF DAY:2 == 1 ;在春天依附到这些角色中的一个
					RESULT:1 = [[霊夢]]
					RESULT:2 = [[る～こと]]
					RESULT:3 = [[カナ]]
				ELSEIF DAY:2 == 2 ;在夏天依附到妖梦
					RETURN [[妖夢]]
				ELSEIF DAY:2 == 3 ;在秋天不依附任何人，并忽略原版数据
					RETURN -1
				ELSE ;不依附任何人，但如果原版数据可用，则使用原版数据
					RETURN 0
				ENDIF
			CASE 3
				;move-3生活时间补正:增加非睡眠时间
				;如果返回1，将使用自定义数值）不然原版数值将覆盖赋值
				;如果返回0，将使用原版的数值
				;如果返回-1，则什么也不会发生
				IF DAY:2 == 3
					CFLAG:生活時間補正 = -120
				ELSEIF DAY:2 == 4
					CFLAG:生活時間補正 = 60
				ELSE
					CFLAG:生活時間補正 = 0
				ENDIF
				RETURN 1
			CASE 4
				;move-4据点地图中的移动倾向：（±10 = 倾向去/不容易去, -100 = 绝对不会去）
				;细分为停留概率和移动概率两类，可以分别赋值，也可以按原版那样用同一个值处理
				;如果返回1，将覆盖原版数值，以RESULT:1/RESULT:2作为停留概率和移动概率，如果没有RESULT:2则用RESULT:1代替
				;如果返回0，将使用原版的数值
				;如果返回-1，将忽略原版的数值
				SELECTCASE ARG:1
					;不去永远亭
					CASE P401永遠亭入口 TO P430地下室
						RESULT:1 = -100
					;很愿意探索梦幻馆
					CASE P450玄関 TO P466庭
						RESULT:1 = 10
					;不会赖在地图入口不动
					CASE P447竹林入口
						RESULT:1 = -5
				ENDSELECT
				RETURN 1
			CASE 7
				;move-7小地图中的移动倾向：判定只有能否出现在该区域
				;如果返回1，则能出现在该区域
				;如果返回0，将使用该区域的原版数值
				;如果返回-1，将忽略该区域的原版数值
				SELECTCASE ARG:1
					CASE 桃林～砂浜, 静かの海
						RETURN 1
					CASE 白玉楼庭, 白玉楼
						RETURN 1
					CASEELSE
					;要完全覆盖原版设定，就必须避免出现返回0的情况。因此在CASEELSE分枝返回-1必不可少
						RETURN -1
				ENDSELECT
				RETURN 0
			CASE 8
				;move-8引力点：设置此值的角色将始终尝试移动到MAIN_MAP上的此位置
				;如果返回1，将使用自定义数值）不然原版数值将覆盖赋值
				;如果返回0，将使用原版的数值
				;如果返回-1，则什么也不会发生
				SIF DAY:3 == 18 ;在秋月18号，将不惜一切代价尝试访问幽香卧室
					TCVAR:引力点 = P463幽香私室
				RETURN 1 ;覆盖默认值
		ENDSELECT
ENDSELECT
[SKIPEND]
