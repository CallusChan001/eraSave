;-----------------------------------------------------------
;地点の接続設定
;ARG    基準の地点
;ARG:1  対象の地点
;RETURNF 0=移動できない,見えない
;        1=移動できる,見えない
;        2=移動できない,見える
;        3=移動できる,見える（直通）
;-----------------------------------------------------------
@CAN_MOVE_2(ARG, ARG:1)
#LOCALSIZE 1
#LOCALSSIZE 1
#FUNCTION
IF GMF_GETBIT("人里地图优化")
	SELECTCASE ARG
		CASE P201人里的門
			SIF ARG:1 == MAXROOM
				RETURNF 2
			SIF GROUPMATCH(ARG:1, P203南大街)
				RETURNF 3
		;增加咖啡馆和集会所的可达
		CASE P202中央広場
			SIF GROUPMATCH(ARG:1, P212咖啡館, P215花屋, P216食料品店, P219集会所, P220瞭望樓, P227八百屋, P280警察署)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P203南大街, P204東大街, P205北大街, P206西大街, P207龍神像)
				RETURNF 3
		CASE P203南大街
			SIF GROUPMATCH(ARG:1, P204東大街, P211酒屋, P212咖啡館, P214長屋前, P216食料品店, P218小料理屋)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P201人里的門, P202中央広場)
				RETURNF 3
		CASE P204東大街
			SIF GROUPMATCH(ARG:1, P203南大街, P205北大街, P213鈴奈庵, P217甜品店, P219集会所, P222寺子屋, P223銭湯, P224慧音宅, P227八百屋)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P202中央広場)
				RETURNF 3
		;去除集会所的可达
		CASE P205北大街
			SIF GROUPMATCH(ARG:1, P204東大街, P206西大街, P221稗田邸, P222寺子屋, P224慧音宅, P280警察署, P281小兎姫私室)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P202中央広場, P207龍神像)
				RETURNF 3
		;增加公用厕所的可达和公用水井的直达
		CASE P206西大街
			SIF GROUPMATCH(ARG:1, P205北大街, P214長屋前, P215花屋, P220瞭望樓, P221稗田邸, P225情人用宿屋, P236公用廁所, P238鯢呑亭, P281小兎姫私室)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P202中央広場, P237公用水井)
				RETURNF 3
		CASE P207龍神像
			SIF GROUPMATCH(ARG:1, P202中央広場, P205北大街)
				RETURNF 3
		;酒屋和咖啡馆区分开
		CASE P211酒屋
			SIF GROUPMATCH(ARG:1, P203南大街)
				RETURNF 1
		;酒屋和咖啡馆区分开，咖啡馆可达广场
		CASE P212咖啡館
			SIF GROUPMATCH(ARG:1, P202中央広場, P203南大街)
				RETURNF 1
		CASE P213鈴奈庵
			SIF GROUPMATCH(ARG:1, P204東大街, P226小鈴私室)
				RETURNF 1
		;修改分类，区分住房与基础设施，区分两组排屋
		CASE P214長屋前
			SIF GROUPMATCH(ARG:1, P203南大街, P206西大街, P236公用廁所, P237公用水井)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P243空的部屋, P208雷鼓的房間, P209八橋的房間, P210弁弁的房間, P234雪的房間, P235​​舞​的房間)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P242麟的房间, P241空的部屋, P230空的部屋, P231蛮奇的房間, P232蓮子的房間, P233梅莉的房間)
				RETURNF 1
		CASE P215花屋
			SIF GROUPMATCH(ARG:1, P202中央広場, P206西大街)
				RETURNF 1
		CASE P216食料品店
			SIF GROUPMATCH(ARG:1, P202中央広場, P203南大街)
				RETURNF 1
		CASE P217甜品店
			SIF GROUPMATCH(ARG:1, P204東大街)
				RETURNF 1
		CASE P218小料理屋
			SIF GROUPMATCH(ARG:1, P203南大街)
				RETURNF 1
		;去除北大街的可达，增加广场的可达
		CASE P219集会所
			SIF GROUPMATCH(ARG:1, P202中央広場, P204東大街)
				RETURNF 1
		;修改西大街和广场为可见的直达
		CASE P220瞭望樓
			SIF GROUPMATCH(ARG:1, P202中央広場, P206西大街)
				RETURNF 3
			SIF GROUPMATCH(ARG:1, P201人里的門, P203南大街, P204東大街, P205北大街, P207龍神像)
				RETURNF 2
		CASE P221稗田邸
			SIF GROUPMATCH(ARG:1, P205北大街, P206西大街, P229阿求私室)
				RETURNF 1
		CASE P222寺子屋
			SIF GROUPMATCH(ARG:1, P204東大街, P205北大街, P224慧音宅)
				RETURNF 1
		CASE P223銭湯
			SIF GROUPMATCH(ARG:1, P204東大街, P228貸切浴場)
				RETURNF 1
		CASE P224慧音宅
			SIF GROUPMATCH(ARG:1, P204東大街, P205北大街, P222寺子屋)
				RETURNF 1
		CASE P225情人用宿屋
			SIF GROUPMATCH(ARG:1, P206西大街)
				RETURNF 1
		CASE P226小鈴私室
			SIF GROUPMATCH(ARG:1, P213鈴奈庵)
				RETURNF 1
		CASE P227八百屋
			SIF GROUPMATCH(ARG:1, P202中央広場, P204東大街)
				RETURNF 1
		CASE P228貸切浴場
			SIF GROUPMATCH(ARG:1, P223銭湯)
				RETURNF 1
		CASE P229阿求私室
			SIF GROUPMATCH(ARG:1, P221稗田邸)
				RETURNF 1
		;区分住房与设施
		CASE P230空的部屋, P231蛮奇的房間, P241空的部屋, P242麟的房间, P243空的部屋
			SIF GROUPMATCH(ARG:1, P214長屋前)
				RETURNF 1
		;区分住房与设施，水井和厕所增加西大街和​鲵​吞​亭的可达
		CASE P236公用廁所
			SIF GROUPMATCH(ARG:1, P206西大街, P214長屋前, P238鯢呑亭, P237公用水井)
				RETURNF 1
		CASE P237公用水井
			SIF GROUPMATCH(ARG:1, P206西大街, P214長屋前, P238鯢呑亭, P236公用廁所)
				RETURNF 1
		;一些奇怪的原版排屋互达
		CASE P232蓮子的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P233梅莉的房間)
				RETURNF 1
		CASE P233梅莉的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P232蓮子的房間)
				RETURNF 1
		CASE P234雪的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P235​​舞​的房間)
				RETURNF 1
		CASE P235​​舞​的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P234雪的房間)
				RETURNF 1
		CASE P208雷鼓的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P209八橋的房間, P210弁弁的房間)
				RETURNF 1
		CASE P209八橋的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P208雷鼓的房間, P210弁弁的房間)
				RETURNF 1
		CASE P210弁弁的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P209八橋的房間, P208雷鼓的房間)
				RETURNF 1
		;增加水井和厕所的可达
		CASE P238鯢呑亭
			SIF GROUPMATCH(ARG:1, P206西大街, P236公用廁所, P237公用水井, P239美宵的房間)
				RETURNF 1
		CASE P239美宵的房間
			SIF GROUPMATCH(ARG:1, P238鯢呑亭)
				RETURNF 1
		CASE P280警察署
			SIF GROUPMATCH(ARG:1, P202中央広場, P205北大街, P281小兎姫私室)
				RETURNF 1
		CASE P281小兎姫私室
			SIF GROUPMATCH(ARG:1, P205北大街, P206西大街, P280警察署)
				RETURNF 1
		CASE MAXROOM
			SIF ARG:1 == P201人里的門
				RETURNF 1
	ENDSELECT
ELSE
	;原版
	SELECTCASE ARG
		CASE P201人里的門
			SIF ARG:1 == MAXROOM
				RETURNF 2
			SIF GROUPMATCH(ARG:1, P203南大街)
				RETURNF 3
		CASE P202中央広場
			SIF GROUPMATCH(ARG:1, P215花屋, P216食料品店, P220瞭望樓, P227八百屋, P280警察署)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P203南大街, P204東大街, P205北大街, P206西大街, P207龍神像)
				RETURNF 3
		CASE P203南大街
			SIF GROUPMATCH(ARG:1, P204東大街, P211酒屋, P212咖啡館, P214長屋前, P216食料品店, P218小料理屋)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P201人里的門, P202中央広場)
				RETURNF 3
		CASE P204東大街
			SIF GROUPMATCH(ARG:1, P203南大街, P205北大街, P213鈴奈庵, P217甜品店, P219集会所, P222寺子屋, P223銭湯, P224慧音宅, P227八百屋)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P202中央広場)
				RETURNF 3
		CASE P205北大街
			SIF GROUPMATCH(ARG:1, P204東大街, P206西大街, P219集会所, P221稗田邸, P222寺子屋, P224慧音宅, P280警察署, P281小兎姫私室)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P202中央広場, P207龍神像)
				RETURNF 3
		CASE P206西大街
			SIF GROUPMATCH(ARG:1, P205北大街, P214長屋前, P215花屋, P220瞭望樓, P221稗田邸, P225情人用宿屋, P238鯢呑亭, P281小兎姫私室)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P202中央広場)
				RETURNF 3
		CASE P207龍神像
			SIF GROUPMATCH(ARG:1, P202中央広場, P205北大街)
				RETURNF 3
		CASE P211酒屋, P212咖啡館
			SIF GROUPMATCH(ARG:1, P203南大街)
				RETURNF 1
		CASE P213鈴奈庵
			SIF GROUPMATCH(ARG:1, P204東大街, P226小鈴私室)
				RETURNF 1
		CASE P214長屋前
			SIF GROUPMATCH(ARG:1, P203南大街, P206西大街)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P230空的部屋, P231蛮奇的房間, P232蓮子的房間, P233梅莉的房間, P234雪的房間, P235​​舞​的房間)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P208雷鼓的房間, P209八橋的房間, P210弁弁的房間, P241空的部屋, P242麟的房间, P243空的部屋, P236公用廁所, P237公用水井)
				RETURNF 1
		CASE P215花屋
			SIF GROUPMATCH(ARG:1, P202中央広場, P206西大街)
				RETURNF 1
		CASE P216食料品店
			SIF GROUPMATCH(ARG:1, P202中央広場, P203南大街)
				RETURNF 1
		CASE P217甜品店
			SIF GROUPMATCH(ARG:1, P204東大街)
				RETURNF 1
		CASE P218小料理屋
			SIF GROUPMATCH(ARG:1, P203南大街)
				RETURNF 1
		CASE P219集会所
			SIF GROUPMATCH(ARG:1, P204東大街, P205北大街)
				RETURNF 1
		CASE P220瞭望樓
			SIF GROUPMATCH(ARG:1, P202中央広場, P206西大街)
				RETURNF 1
			SIF GROUPMATCH(ARG:1, P201人里的門, P203南大街, P204東大街, P205北大街, P207龍神像)
				RETURNF 2
		CASE P221稗田邸
			SIF GROUPMATCH(ARG:1, P205北大街, P206西大街, P229阿求私室)
				RETURNF 1
		CASE P222寺子屋
			SIF GROUPMATCH(ARG:1, P204東大街, P205北大街, P224慧音宅)
				RETURNF 1
		CASE P223銭湯
			SIF GROUPMATCH(ARG:1, P204東大街, P228貸切浴場)
				RETURNF 1
		CASE P224慧音宅
			SIF GROUPMATCH(ARG:1, P204東大街, P205北大街, P222寺子屋)
				RETURNF 1
		CASE P225情人用宿屋
			SIF GROUPMATCH(ARG:1, P206西大街)
				RETURNF 1
		CASE P226小鈴私室
			SIF GROUPMATCH(ARG:1, P213鈴奈庵)
				RETURNF 1
		CASE P227八百屋
			SIF GROUPMATCH(ARG:1, P202中央広場, P204東大街)
				RETURNF 1
		CASE P228貸切浴場
			SIF GROUPMATCH(ARG:1, P223銭湯)
				RETURNF 1
		CASE P229阿求私室
			SIF GROUPMATCH(ARG:1, P221稗田邸)
				RETURNF 1
		CASE P230空的部屋, P231蛮奇的房間, P241空的部屋, P242麟的房间, P243空的部屋, P236公用廁所, P237公用水井
			SIF GROUPMATCH(ARG:1, P214長屋前)
				RETURNF 1
		CASE P232蓮子的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P233梅莉的房間)
				RETURNF 1
		CASE P233梅莉的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P232蓮子的房間)
				RETURNF 1
		CASE P234雪的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P235​​舞​的房間)
				RETURNF 1
		CASE P235​​舞​的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P234雪的房間)
				RETURNF 1
		CASE P208雷鼓的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P209八橋的房間, P210弁弁的房間)
				RETURNF 1
		CASE P209八橋的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P208雷鼓的房間, P210弁弁的房間)
				RETURNF 1
		CASE P210弁弁的房間
			SIF GROUPMATCH(ARG:1, P214長屋前, P209八橋的房間, P208雷鼓的房間)
				RETURNF 1
		CASE P238鯢呑亭
			SIF GROUPMATCH(ARG:1, P206西大街, P239美宵的房間)
				RETURNF 1
		CASE P239美宵的房間
			SIF GROUPMATCH(ARG:1, P238鯢呑亭)
				RETURNF 1
		CASE P280警察署
			SIF GROUPMATCH(ARG:1, P202中央広場, P205北大街, P281小兎姫私室)
				RETURNF 1
		CASE P281小兎姫私室
			SIF GROUPMATCH(ARG:1, P205北大街, P206西大街, P280警察署)
				RETURNF 1
		CASE MAXROOM
			SIF ARG:1 == P201人里的門
				RETURNF 1
	ENDSELECT
ENDIF
RETURNF 0
