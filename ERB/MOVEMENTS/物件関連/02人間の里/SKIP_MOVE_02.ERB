;-----------------------------------------------------------
;遠距離移動の設定
;ARG     目的地
;ARG:1   現在地
;RETURN  次の目的地
;-----------------------------------------------------------
@SKIP_MOVE_2(ARG, ARG:1)
#DIM 現在的位置
;現在位置取得
IF ARG:1
	現在的位置 = ARG:1
ELSE
	現在的位置 = CFLAG:MASTER:現在位置
ENDIF

;目的地に直接移動できる場合そこに移動
SIF CAN_MOVE(現在的位置, ARG) & 1
	RETURN ARG

;袋小路から行ける場所は固定なので、そこを目指す
IF GMF_GETBIT("人里地图优化")
	SELECTCASE 現在的位置
		;咖啡馆现在可达广场
		CASE P201人里的門, P211酒屋, P218小料理屋
			RETURN P203南大街
		CASE P213鈴奈庵, P217甜品店, P223銭湯
			RETURN P204東大街
		CASE P225情人用宿屋, P238鯢呑亭
			RETURN P206西大街
		CASE P226小鈴私室
			RETURN P213鈴奈庵
		CASE P229阿求私室
			RETURN P221稗田邸
		CASE P228貸切浴場
			RETURN P223銭湯
		;水井和厕所现在可达西大街和​鲵​吞​亭
		CASE P230空的部屋 TO P235​​舞​的房間, P208雷鼓的房間 TO P210弁弁的房間, P241空的部屋 TO P243空的部屋
			RETURN P214長屋前
		CASE P239美宵的房間
			RETURN P238鯢呑亭
		;小兎姫私室的选择也挺多，所以以上这些就下掉了
	ENDSELECT
ELSE
	SELECTCASE 現在的位置
		CASE P201人里的門
			RETURN P203南大街
		CASE P211酒屋, P212咖啡館, P218小料理屋
			RETURN P203南大街
		CASE P217甜品店
			RETURN P204東大街
		CASE P225情人用宿屋
			RETURN P206西大街
		CASE P226小鈴私室
			RETURN P213鈴奈庵
		CASE P229阿求私室
			RETURN P221稗田邸
		CASE P228貸切浴場
			RETURN P223銭湯
		CASE P230空的部屋 TO P237公用水井, P208雷鼓的房間 TO P210弁弁的房間, P241空的部屋 TO P243空的部屋
			RETURN P214長屋前
		CASE P239美宵的房間
			RETURN P238鯢呑亭
		CASE P281小兎姫私室
			RETURN P280警察署
	ENDSELECT
ENDIF

;直接移動できない場合、1つ近い位置を暫定目的地に設定し直してループ
;基本的に最短で行けるコースを設定する
;現在地によってコースが変わることも考慮して対応する
IF GMF_GETBIT("人里地图优化")
	SELECTCASE ARG
		;以广场为中心，以目的地为导向来规划路线是没错的
		;可以先把上面那些死胡同及其延伸逆向了再考虑多选的情况
		CASE P201人里的門, P211酒屋, P218小料理屋
			RETURN P203南大街
		CASE P213鈴奈庵, P217甜品店, P223銭湯
			RETURN P204東大街
		CASE P225情人用宿屋, P238鯢呑亭
			RETURN P206西大街
		CASE P226小鈴私室
			RETURN P213鈴奈庵
		CASE P229阿求私室
			RETURN P221稗田邸
		CASE P228貸切浴場
			RETURN P223銭湯
		CASE P230空的部屋 TO P235​​舞​的房間, P208雷鼓的房間 TO P210弁弁的房間, P241空的部屋 TO P243空的部屋
			RETURN P214長屋前
		CASE P239美宵的房間
			RETURN P238鯢呑亭

		;接下来考虑设施和商店的规划，这里优先考虑大门方向（按街道来看）
		;广场+北街
		CASE P207龍神像, P280警察署
			SELECTCASE 現在的位置
				;北大街系，注意阿求私室是死胡同已经不需要判定，但慧音宅不是。互相不用算入走广场就好。记得小兎姫私室走龙神的路
				CASE P221稗田邸, P222寺子屋, P224慧音宅, P281小兎姫私室
					RETURN P205北大街
				CASEELSE
					RETURN P202中央広場
			ENDSELECT
		;广场+西街
		CASE P215花屋, P220瞭望樓
			SELECTCASE 現在的位置
				;西大街系，注意情人用宿屋和鯢呑亭也是死胡同，还有长屋的其他房间
				CASE P214長屋前, P221稗田邸, P236公用廁所, P237公用水井
					RETURN P206西大街
				CASEELSE
					RETURN P202中央広場
			ENDSELECT
		;广场+南街
		CASE P212咖啡館, P216食料品店
			SELECTCASE 現在的位置
				;由于其他南大街系全部是死胡同因此只剩长屋系
				CASE P214長屋前
					RETURN P203南大街
				CASEELSE
					RETURN P202中央広場
			ENDSELECT
		;广场+东街
		CASE P219集会所, P227八百屋
			SELECTCASE 現在的位置
				;东大街系，注意甜品店銭湯和鈴奈庵也是死胡同不再判定
				CASE P222寺子屋, P224慧音宅
					RETURN P204東大街
				CASEELSE
					RETURN P202中央広場
			ENDSELECT
		;北街+东街
		CASE P222寺子屋, P224慧音宅
			SELECTCASE 現在的位置
				;北大街系，注意西大街可以直达北大街因此也算入这边，但广场的除外
				CASE P206西大街, P207龍神像, P214長屋前, P221稗田邸, P236公用廁所, P237公用水井, P280警察署, P281小兎姫私室
					RETURN P205北大街
				CASEELSE
					RETURN P204東大街
			ENDSELECT
		;北街+西街
		CASE P221稗田邸, P281小兎姫私室
			SELECTCASE 現在的位置
				;北大街系，注意东大街可以直达北大街因此也算入这边，记得警察署走稗田邸的路
				CASE P204東大街, P207龍神像, P222寺子屋, P224慧音宅, P280警察署
					RETURN P205北大街
				CASEELSE
					RETURN P206西大街
			ENDSELECT
		;长屋前
		CASE P214長屋前
			SELECTCASE 現在的位置
				;除了东大街其他基本都走西大街就行
				CASE P204東大街
					RETURN P203南大街
				CASEELSE
					RETURN P206西大街
			ENDSELECT
		;水井和厕所，人有三急确实要搞快点
		CASE P236公用廁所, P237公用水井
			SELECTCASE 現在的位置
				;除了南大街其他基本都走西大街就行，虽然怪怪的
				CASE P203南大街
					RETURN P214長屋前
				CASEELSE
					RETURN P206西大街
			ENDSELECT

		;最后就是大街和广场
		CASE P205北大街
			SELECTCASE 現在的位置
				;除了西大街直达其他基本都走广场就行
				CASE P214長屋前, P236公用廁所, P237公用水井
					RETURN P206西大街
				CASEELSE
					RETURN P202中央広場
			ENDSELECT
		CASE P206西大街
			SELECTCASE 現在的位置
				;除了北大街直达其他基本都走广场就行
				CASE P222寺子屋, P224慧音宅
					RETURN P205北大街
				CASEELSE
					RETURN P202中央広場
			ENDSELECT
		CASE P204東大街
			SELECTCASE 現在的位置
				;除了南北大街直达其他基本都走广场就行
				CASE P221稗田邸, P281小兎姫私室
					RETURN P205北大街
				CASE P214長屋前
					RETURN P203南大街
				CASEELSE
					RETURN P202中央広場
			ENDSELECT
		CASE P203南大街
			SELECTCASE 現在的位置
				;除了东大街直达其他基本都走广场就行
				CASE P222寺子屋, P224慧音宅
					RETURN P204東大街
				CASEELSE
					RETURN P202中央広場
			ENDSELECT
		CASE P202中央広場
			SELECTCASE 現在的位置
				;分大街吧，这个只能看地图怎么走最近了，主要是看方位
				CASE P214長屋前, P221稗田邸, P236公用廁所, P237公用水井, P281小兎姫私室
					RETURN P206西大街
				CASE P222寺子屋, P224慧音宅
					RETURN P204東大街
				CASEELSE
					RETURN P203南大街
			ENDSELECT

		;说起来真的还会有ELSE吗，还是说其实是外出的意思？
		CASEELSE
			RETURN P201人里的門
	ENDSELECT
ELSE
	;原版
	SELECTCASE ARG
		CASE P201人里的門, P211酒屋, P212咖啡館, P218小料理屋
			RETURN P203南大街
		CASE P202中央広場
			SELECTCASE 現在的位置
			CASE P213鈴奈庵, P217甜品店, P223銭湯
				RETURN P204東大街
			CASE P219集会所, P222寺子屋, P224慧音宅
				RETURN P205北大街
			CASE P214長屋前, P221稗田邸, P229阿求私室, P225情人用宿屋, P238鯢呑亭, P281小兎姫私室
				RETURN P206西大街
			CASEELSE
				RETURN P203南大街
			ENDSELECT
		CASE P203南大街
			SELECTCASE 現在的位置
			CASE P219集会所, P222寺子屋, P224慧音宅
				RETURN P204東大街
			CASEELSE
				RETURN P202中央広場
			ENDSELECT
		CASE P204東大街
			SELECTCASE 現在的位置
			CASE P214長屋前
				RETURN P203南大街
			CASE P221稗田邸, P229阿求私室
				RETURN P205北大街
			CASEELSE
				RETURN P202中央広場
			ENDSELECT
		CASE P205北大街
			RETURN P202中央広場
		CASE P206西大街
			SELECTCASE 現在的位置
			CASE P219集会所, P222寺子屋, P224慧音宅
				RETURN P205北大街
			CASEELSE
				RETURN P202中央広場
			ENDSELECT
		CASE P207龍神像
			SELECTCASE 現在的位置
			CASE P219集会所, P221稗田邸, P229阿求私室, P222寺子屋, P224慧音宅
				RETURN P205北大街
			CASEELSE
				RETURN P202中央広場
			ENDSELECT
		CASE P213鈴奈庵, P217甜品店, P223銭湯
			RETURN P204東大街
		CASE P214長屋前
			SELECTCASE 現在的位置
			CASE P204東大街
				RETURN P203南大街
			CASEELSE
				RETURN P206西大街
			ENDSELECT
		CASE P215花屋, P216食料品店, P220瞭望樓
			RETURN P202中央広場
		CASE P219集会所, P222寺子屋, P224慧音宅
			SELECTCASE 現在的位置
			CASE P206西大街, P207龍神像, P221稗田邸, P229阿求私室, P281小兎姫私室, P280警察署
				RETURN P205北大街
			CASEELSE
				RETURN P204東大街
			ENDSELECT
		CASE P221稗田邸
			SELECTCASE 現在的位置
			CASE P207龍神像, P219集会所, P222寺子屋, P224慧音宅
				RETURN P205北大街
			CASEELSE
				RETURN P206西大街
			ENDSELECT
		CASE P225情人用宿屋, P238鯢呑亭
			RETURN P206西大街
		CASE P226小鈴私室
			RETURN P213鈴奈庵
		CASE P229阿求私室
			RETURN P221稗田邸
		CASE P227八百屋
			SELECTCASE 現在的位置
			CASE P219集会所, P222寺子屋, P224慧音宅
				RETURN P204東大街
			CASEELSE
				RETURN P202中央広場
			ENDSELECT
		CASE P228貸切浴場
			RETURN P223銭湯
		CASE P230空的部屋 TO P237公用水井, P208雷鼓的房間 TO P210弁弁的房間, P241空的部屋 TO P243空的部屋
			RETURN P214長屋前
		CASE P239美宵的房間
			RETURN P238鯢呑亭
		CASE P280警察署
			SELECTCASE 現在的位置
			CASE P207龍神像, P219集会所, P221稗田邸, P229阿求私室, P222寺子屋, P224慧音宅
				RETURN P205北大街
			CASEELSE
				RETURN P202中央広場
			ENDSELECT
		CASE P281小兎姫私室
			SELECTCASE 現在的位置
			CASE P214長屋前, P221稗田邸, P229阿求私室, P225情人用宿屋, P238鯢呑亭
				RETURN P205北大街
			CASEELSE
				RETURN P280警察署
			ENDSELECT
		CASEELSE
			RETURN P201人里的門
	ENDSELECT
ENDIF
