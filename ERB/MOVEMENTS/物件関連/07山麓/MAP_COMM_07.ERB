;--------------------------------------------------
;地点名変更関数
;--------------------------------------------------
@MAP_PLACENAME_7(ARG,ARG:1)
#FUNCTIONS
IF GET_MAPID(ARG) == MAIN_MAP
	SELECTCASE ARG
		CASE P734小屋
			IF CFLAG:MASTER:初期位置 == ARG
				RETURNF CALLNAME:MASTER + "的小屋"
			ELSE
				RETURNF "空的小屋"
			ENDIF
		CASE P754空房间
			IF CFLAG:MASTER:初期位置 == ARG
				RETURNF CALLNAME:MASTER + "的房间"
			ELSE
				RETURNF "空房间"
			ENDIF
		CASE SUMIKOMI_ROOM
			;※このMapでは未実装
			IF FLAG:住宿人物
				RETURNF CALLNAME:(FLAG:住宿人物) + "的房间"
			ELSE
				RETURNF "空房间"
			ENDIF
		CASE MINROOM() TO (MAXROOM - 1)
			RETURNF ARG:1 ? STR:(ARG + 8000) # STR_TR(ARG + 8000) ;custom code
		CASE OMANEKIBEYA()
			RETURNF OMANEKI_PLACE()
		CASE SUKIMA()
			RETURNF "隙间空间"
		CASE MAXROOM
			RETURNF "道路的另一边"
		CASEELSE
			RETURNF "不明"
	ENDSELECT
ELSE
	RETURNF "山外"
ENDIF

;--------------------------------------------------
;場所ARGがどのエリアにあるか
;表示するMapの番号と連動（TFLAG:地圖切換）
;ARG     場所ID
;--------------------------------------------------
@MAP_AREASELECT_7(ARG)
#FUNCTION
SELECTCASE ARG
	;秋姉妹的家
	CASE P715秋姉妹的家・畑 TO P719秋姉妹的家・座敷
		RETURNF 2
	;仙人的宅邸・１階～２階
	CASE P720仙人的宅邸・廚房 TO P725仙人的宅邸・大鷲的房間, P729仙人的宅邸・玄関, P730仙人的宅邸・庭
		RETURNF 3
	;仙人的宅邸・２階～３階
	CASE P726仙人的宅邸・居間, P727仙人的宅邸・華扇私室, P728仙人的宅邸・空的部屋
		RETURNF 4
	;圣域
	CASE P741猿猴通路 TO P750驯子的小屋
		RETURNF 5
	;净秽山
	CASE P751浅间净秽山 TO P762空房间
		RETURNF 6
	;妖怪之山・山麓
	CASEELSE
		RETURNF 1
ENDSELECT

;--------------------------------------------------
;内部構造がある場所の内部の判定
;TFLAG:地圖切換  内部察知が必要なMap番号
;                P_ID  表示ボタンの場所ID
;                Q_ID  判定する内部の場所ID,必ずP_IDと一致した数値も含める
;--------------------------------------------------
@GETMAP_BUILDING_7(P_ID, Q_ID)
#FUNCTION
#DIM P_ID
#DIM Q_ID
IF TFLAG:地圖切換 == 1
	SELECTCASE P_ID
		;秋姉妹的家
		CASE P716秋姉妹的家・土間
			SELECTCASE Q_ID
			CASE P716秋姉妹的家・土間 TO P719秋姉妹的家・座敷
				RETURNF 1
			ENDSELECT
		;仙人的宅邸
		CASE P729仙人的宅邸・玄関
			SELECTCASE Q_ID
			CASE P720仙人的宅邸・廚房 TO P729仙人的宅邸・玄関
				RETURNF 1
			ENDSELECT
		;圣域
		CASE P743圣域林道
			SELECTCASE Q_ID
				CASE P741猿猴通路 TO P762空房间
					RETURNF 1
			ENDSELECT
	ENDSELECT
ELSEIF TFLAG:地圖切換 == 5
	SELECTCASE P_ID
		;净秽山
		CASE P751浅间净秽山
			SELECTCASE Q_ID
				CASE P751浅间净秽山 TO P762空房间
					RETURNF 1
			ENDSELECT
	ENDSELECT
ENDIF
RETURNF 0

;--------------------------------------------------
;移動制限設定
;ARG    場所ID
;CHARA  移動する角色ID
;RETURNF 1=移動できる,0=移動できない
;TFLAG:移動不能メッセージ   ↓の@MAP_CANNOT_WORD用の設定
;--------------------------------------------------
@MAP_CAN_MOVE_7(ARG, CHARA)
#FUNCTION
#DIM CHARA
SELECTCASE ARG
	;華扇ハウス
	CASE P720仙人的宅邸・廚房 TO P730仙人的宅邸・庭
		;本人は除外
		SIF CHARA == [[華扇]]
			RETURNF 1
		;中からは動ける
		SIF INRANGE(CFLAG:CHARA:現在位置, P720仙人的宅邸・廚房, P730仙人的宅邸・庭)
			RETURNF 1
		;恋慕か住宿
		IF CHARA == MASTER && (INRANGE(CFLAG:MASTER:初期位置, P720仙人的宅邸・廚房, P730仙人的宅邸・庭) || TALENT:[[華扇]]:恋慕)
			RETURNF 1
		;约会的对象が天子か自分が天子
		ELSEIF FLAG:约会的对象 == [[天子]] || CHARA == [[天子]]
			RETURNF 1
		;教養が足りないとたどり着けない
		ELSEIF ABL:CHARA:教養 < 3
			TFLAG:移動不能メッセージ = 1
			RETURNF 0
			;戦闘力3以上必要
		ELSEIF ABL:CHARA:戦闘能力 < 3 && !FLAG:時間停止
			TFLAG:移動不能メッセージ = 2
			RETURNF 0
		ENDIF
	CASE P733正邪的隠匿処
		;你は恋慕が那个ば入れてもらえる
		IF TALENT:[[正邪]]:恋慕 && CHARA == MASTER
			RETURNF 1
		;本人は入れる
		ELSEIF CHARA == [[正邪]]
			RETURNF 1
		ELSE
			TFLAG:移動不能メッセージ = 3
			RETURNF 0
		ENDIF
	CASE P741猿猴通路 TO P762空房间
		;在内部或者住在内部，必须能回去
		SIF INRANGE(CFLAG:CHARA:現在位置, P741猿猴通路, P762空房间) || INRANGE(CFLAG:CHARA:初期位置, P741猿猴通路, P762空房间)
			RETURNF 1
		IF CHARA == MASTER && ABL:[[合欢乃]]:亲密 < 5 && ABL:[[美天]]:亲密 < 5
			TFLAG:移動不能メッセージ = 3
			RETURNF 0
		;月都人
		ELSEIF GROUPMATCH(GET_MAPID(CFLAG:LOCAL:自宅位置), 10)
			RETURNF 1
		;其他额外得到许可的角色
		ELSEIF GROUPMATCH(CHARA, [[正邪]], [[美天]])
			RETURNF 1
		ELSEIF ABL:CHARA:教養 < 3
			TFLAG:移動不能メッセージ = 3
			RETURNF 0
		ENDIF
ENDSELECT
RETURNF 1

;--------------------------------------------------
;移動不能時に表示されるメッセージ
;--------------------------------------------------
@MAP_CANNOT_WORD_7(ARG)
SELECTCASE TFLAG:移動不能メッセージ
	CASE 1
		PRINTFORML 从刚才开始和屋子的距离就完全没有减少……
		PRINTFORMW 好像在同一个地方一直转着圈
		CLEARLINE 3
		TIME += 10
	CASE 2
		PRINTFORML 有危险的老虎蹲在在庭院中、看到%CALLNAME:MASTER%的样子后提高了呜呜的吼声
		PRINTFORMW 看来不要靠近比较好
		CLEARLINE 3
		TIME += 5
	CASE 3
		PRINTFORMW 完全找不到路……
		CLEARLINE 2
ENDSELECT
REUSELASTLINE

;-----------------------------------------
;拠点専用の情景描写
;WAITはかけないように
;-----------------------------------------
@MAP_UNIQUEMESSAGE_7
SELECTCASE CFLAG:MASTER:現在位置
	CASE P703玄武之澤
		IF DAY:2 == 2 && TALENT:MASTER:形状 == 4 && GROUPMATCH(TIME:2, 5, 6, 7)
			PRINTFORML 被股间的光所吸引的萤火虫们、在%CALLNAME:MASTER%的四周飞来飞去
			PRINTFORML 真是幻想中的光景……
		ENDIF
ENDSELECT

;-----------------------------------------
;拠点の場所IDをお出かけMap上の場所IDに置換する関数
;ARG      対象の場所ID（拠点Map）
;RETURNF  差し替え場所ID（お出かけMap）
;-----------------------------------------
@MAP_SEARCH_REPLACEMENT_7(ARG)
#FUNCTION
SELECTCASE ARG
	CASE P703玄武之澤, P704河童の宣傳站, P735游泳場
		RETURNF 玄武之澤
	CASE P708大蛤蟆之池
		RETURNF 大蛤蟆之池
	CASE P733正邪的隠匿処
		RETURNF 正邪的隠匿処前
	CASE P720仙人的宅邸・廚房 TO P730仙人的宅邸・庭
		RETURNF 仙人的宅邸
	CASE P712間欠泉地下中樞
		RETURNF 間欠泉地下中樞
	CASE P738森の深奥 TO P740山童の宣傳站
		RETURNF 森の深奥
	CASE P741猿猴通路 TO P750驯子的小屋
		RETURNF 圣域
	CASE P751浅间净秽山 TO P762空房间
		RETURNF 浅间净秽山
	CASEELSE
		RETURNF 山麓樹海
ENDSELECT
RETURNF 0

;--------------------------------------------------
;Mapの紹介文
;--------------------------------------------------
@Map紹介_7
;とりあえず5行
PRINTFORML 有很多的采集点和2个钓鱼点、是山中冒险者所垂涎的据点。
PRINTFORML 可以从间歇泉地下中枢直通灼热地狱遗迹、也有去山顶的近路。
PRINTFORML 正邪的家和华扇的家不满足特定的条件无法进入。
PRINTFORML 在秘天崖开设了赌场，无名的妖怪们每天都沉迷于赌博。
PRINTFORML 由于同时拥有锯木厂和伐木点，只要在锯木厂的营业时间内，就能高效地进行伐木→锯木→伐木……

