;※※※※※※※※※※※※※※※※※※※※※※※※※※※※
;弹幕胜负口上模板
;经过eraTheWorld 4.972 环境测试
;※※※※※※※※※※※※※※※※※※※※※※※※※※※※
;==================================================
; ※ABL:戰鬥能力 == 0 的角色初始是无法进行弹幕胜负的※
; ※角色技能发动的口上接口只有【乾坤一掷】【怪力乱神】【残忍酷薄】这三个
;==================================================
;整体流程与时点：
;（无→跳转则全部顺下，序号仅做跳转标识，并非实际顺序）
;==================================================
; 决斗前   		① 调用 COM480 决定是否进行决斗
; 					☇ **调用 “戰鬥前” 的口上内容**
; 开始决斗	      ② 调用 DANMAKU_BATTLE 运行决斗过程
; 			    ③ 决斗循环
; 					☇ ⑥ 处理骰子数值（如果启用了 胖次决斗 的DLC，还会调用 PANNOQIKALA_BATTLE 进行胖次的处理，进一步增减双方数值）
; 						☇ **调用 "ハンデ" 的口上内容**
; 					   ⑦ 掷骰子，生成第一次的骰子值让玩家做出选择
; 						☇ ⑨ 选择专心回避，如果HP归零 → ⑮
; 						   ⑩ 选择一决胜负
; 							☇ 双方发动技能【乾坤一掷】
; 								☇ **调用 “乾坤一擲” 的口上内容**
; 							   ⑪ 拼点，TARGET骰子值更大 → ⑫，MASTER更大 → ⑬，相等 → ⑭
; 								☇ ⑫ TARGET攻击
; 									☇ MASTER发动技能【怪力乱神】/使用BOMB进行防御 → ⑭
; 									   ⑮ MASTER被弹
; 										☇ **调用 “击破” 的口上内容**
; 										符合条件时TARGET发动技能【残忍酷薄】
; 											☇  **调用 “残忍酷薄” 的口上内容** → ⑧
; 								   ⑬ MASTER攻击
; 									☇ TARGET发动技能【怪力乱神】进行防御
; 										☇ **调用 “怪力乱神” 的口上内容** → ⑭
; 									   TARGET被弹
; 										☇ **调用 “被弹” 的口上内容** → ⑧
; 								   ⑭ 平手
; 					   ⑧ 一方残归零 → ④ ，否则 → ③
; 决斗结束	      ④ 宣布败犬/人生的胜利者，处理乐谱
; 决斗后		⑤ **调用 "戦闘後" 的口上内容**， 进行各种决斗后的数据处理
;==================================================
@M_KOJO_XXX_MESSAGE_COM_KX_DANMAKU(ARGS, 对手残机, 自机残机)
#DIM 对手残机	;残机值除了“戰鬥前”没有意义以外，其余时点都能生效
#DIM 自机残机
;--------------------------------------------------
;启用（0，不显示以下内容；1，显示以下内容）
LOCAL = 1
;--------------------------------------------------
IF LOCAL
	SIF FLAG:1031
		TRYCALLFORM M_KOJO_XXX_COLOR_KX
	;-------------------------------------------------
	;允许口上侧进行的对 MASTER的 战斗力补正
	;-------------------------------------------------
	; HANDICAP_FIXED 是直接对 MASTER 骰子修正值的补正，而 HANDICAP_RAND 则是以 RAND:HANDICAP_RAND 的形式进行的补正
	; 因为算式是 修正值 -= HANDICAP ，所以数值越高 MASTER 的骰子修正值就越低，如果输入负数，则变成增加 MASTER  的修正值
	; （虽然代码写的是给 MASTER 的补正，但是口上文本写成对 TARGET 的补正也是可以的）

	; （要注意的是，HANDICAP_RAND 的算式是：修正値 -= RAND:(HANDICAP_RAND + TFLAG:GipsLV（大角虫装甲负荷等级） * ABL:MASTER:戦闘能力 + 1)
	; 这样的写法导致了如果 HANDICAP_RAND 是较大的负值而令最终计算值也为负的话就会报错。想要大幅度增强 MASTER 稳妥起见请用 HANDICAP_FIXED）

	; HANDICAP 的补正无关 TARGET 本身的战斗能力，所以你甚至可以做到让1级的⑨暴打6级的MASTER（⑨是最强的）

	; HANDICAP 值是每回合都重新计算一遍的，所以你可以整一点越战越勇之类的花活
	; BTW,就这样写在这里的话就是全时点每次调用时都为 HANDICAP 赋值一遍，所以 HANDICAP = XX 之类的直接赋值建议还是做好条件限制。
	; 或者干脆把这里删掉，在时点内给 HANDICAP 赋值。（"戰鬥前"生效一次，决斗循环中的生效顺序见上方 整体流程与时点 ，"戰鬥後"不生效）

	HANDICAP_FIXED = 0
	HANDICAP_RAND = 0
	;-------------------------------------------------
	;决斗前
	;-------------------------------------------------
	IF ARGS == "戦闘前"

		; PRINTFORML 

		; 在这里返回-1的话可以口上强制中止决斗
		RETURN 0
	ENDIF
	;-------------------------------------------------
	; HANDICAP 用口上
	; 如果 HANDICAP_FIXED 和 HANDICAP_RAND 都为假那么就不会显示这个
	; 你可以写文本，也可以写数值的更改。这个时点是刚好卡在计算骰子值的前一步。
	;-------------------------------------------------
	IF ARGS == "ハンデ"

		; PRINTFORML 
		RETURN 0
	ENDIF
	;-------------------------------------------------
	;决斗中 MASTER 被弹时口上（4960新增接口）
	;-------------------------------------------------
	IF ARGS == "击破" 
		;此处可填写通用文本

		; MASTER获得残机的手段较多，基础是3，技能【洽览深识】+1，TALENT:0:大角虫+1，道具【命之卡片】+1
		; 不启用 胖次决斗DLC 的话最高6残，是先减少残机再调用的“击破”和“被弹”的口上内容
		SELECTCASE 自机残机
			CASE 5

				; PRINTFORML 
			CASE 4

				; PRINTFORML 
			CASE 3

				; PRINTFORML 
			CASE 2
			
				; PRINTFORML 
			CASE 1
			
				; PRINTFORML 
			CASE 0
			
				; PRINTFORML 
		ENDSELECT
	ENDIF
	;-------------------------------------------------
	;决斗中 TARGET 被弹时口上
	;-------------------------------------------------
	IF ARGS == "被弾" 
		;此处可填写通用文本

		SELECTCASE 对手残机
			;拥有【洽览深识】时，会存在残机3的情况
			CASE 3

				; PRINTFORML 
			CASE 2
			
				; PRINTFORML 
			CASE 1
			
				; PRINTFORML 
			CASE 0
			
				; PRINTFORML 
		ENDSELECT
	ENDIF
	;-------------------------------------------------
	;决斗中 TARGET 的技能【残忍酷薄】发动
	; 【残忍酷薄】效果：MASTER从被弹中恢复时BOMB数-1
	; 50%的概率会被道具 三滴之天粒 无效化
	;-------------------------------------------------
	IF ARGS == "残忍酷薄"
		
		; PRINTFORML 
	ENDIF
	;-------------------------------------------------
	;决斗中 TARGET 的技能【乾坤一掷】发动
	; 如果开启DLC 胖次决斗 ，这里也会成为技能【蓝！白！碗！】【调教时间！】【透明人间】发动时 的内容。时点先于普通决斗时的【乾坤一掷】
	; 【乾坤一掷】效果：使TARGET的骰子值提升
	;-------------------------------------------------
	IF ARGS == "乾坤一擲"

		; PRINTFORML 	
	ENDIF
	;-------------------------------------------------
	;决斗中 TARGET 的技能【怪力乱神】发动
	; 【怪力乱神】效果：如果两方骰子差小于一定值，就能够化解MASTER的攻击，避免掉残
	; 地文：MASTER放出的弹幕，在击中TARGET的瞬间之前消散了！
	;-------------------------------------------------
	IF ARGS == "怪力乱神"
		
		; PRINTFORML 
	ENDIF
	;-------------------------------------------------
	;战斗后
	; 如果是 MASTER 第一次击败 TARGET （此处用 !CFLAG:弾幕勝負勝利 && 相手残機 == 0 进行表示），
	; 或者是 ABL:MASTER:戰鬥能力 < ABL:TARGET:戰鬥能力 ，COMF中都会有数值的BONUS
	; 委托12【想要制裁某人！】也会调用这里的内容
	;-------------------------------------------------
	IF ARGS == "戦闘後" 

		;拥有技能【洽览深识】会导致残机为4的情况
		;残机剩余1以上就是 MASTER挑战失败，剩余0则为挑战成功
		SELECTCASE 对手残机
			CASE 4

				; PRINTFORML 
			CASE 3
			
				; PRINTFORML 
			CASE 2
			
				; PRINTFORML 
			CASE 1
			
				; PRINTFORML 
			CASE 0
			
				; PRINTFORML 
		ENDSELECT
	ENDIF
	RESETCOLOR
ENDIF
RETURN 1

